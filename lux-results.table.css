/* lux-results.table.css */
/* Word/Phoneme results table + column collapse + hover + previews */

/* ============================================================
   Collapsible Score & Error columns
   ============================================================ */
#prettyResult table { transition: width 0.35s ease; }

#scoreHeader, #errorHeader {
  width: 34px;
  text-align: center;
  position: relative;
  cursor: pointer;
  user-select: none;
}

.toggle-col { cursor: pointer; user-select: none; transition: color 0.2s; }
.toggle-col:hover { color: #0078d7; }
.toggle-col::after { content: "â–¸"; display: inline-block; transition: transform 0.35s ease; }

table:not(.collapsed-score) #scoreHeader::after,
table:not(.collapsed-error) #errorHeader::after { transform: rotate(90deg); }
table:not(.collapsed-score) th#scoreHeader::after,
table:not(.collapsed-error) th#errorHeader::after { content: "â—‚"; }

/* Collapsed States: keep ONLY the headers as the skinny clickable handles */
#prettyResult table.collapsed-score th#scoreHeader,
#prettyResult table.collapsed-error th#errorHeader {
  width: 26px !important;
  min-width: 26px !important;
  max-width: 26px !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  opacity: 0.2;
  pointer-events: auto !important;
  cursor: pointer;

  /* critical: stop the â€œS C O R Eâ€ vertical stacking */
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: clip !important;
}

/* ============================================================
   Score + Error collapse (CLASS-BASED = robust after new columns)
   ============================================================ */

/* Prevent that â€œvertical letter stackingâ€ look */
#prettyResult td.score-cell,
#prettyResult td.error-cell,
#prettyResult th#scoreHeader,
#prettyResult th#errorHeader{
  white-space: nowrap !important;
}

/* COLLAPSED: hide the body cells */
#prettyResult table.collapsed-score td.score-cell,
#prettyResult table.collapsed-error td.error-cell{
  width: 0 !important;
  min-width: 0 !important;
  max-width: 0 !important;
  padding: 0 !important;
  opacity: 0 !important;
  pointer-events: none !important;
  font-size: 0 !important;
  border-left: none;
  border-right: none;
}

/* OPEN: restore the body cells */
#prettyResult table:not(.collapsed-score) td.score-cell,
#prettyResult table:not(.collapsed-score) th#scoreHeader{
  width: 110px !important;
  min-width: 85px !important;
  max-width: 140px !important;
  padding: 10px !important;
  opacity: 1 !important;
  font-size: 1em !important;
}

#prettyResult table:not(.collapsed-error) td.error-cell,
#prettyResult table:not(.collapsed-error) th#errorHeader{
  width: 170px !important;
  min-width: 140px !important;
  max-width: 220px !important;
  padding: 10px !important;
  opacity: 1 !important;
  font-size: 1em !important;
}

#prettyResult .score-table td.score-cell,
#prettyResult .score-table td.error-cell { cursor: pointer; }

/* ============================================================
   Collapsible Word & Phoneme columns (NEW)
   - Triggered ONLY by the dedicated header buttons (.lux-col-toggle)
   - Does not change Score/Error collapse behavior
   ============================================================ */

#prettyResult .lux-col-toggle {
  position: absolute;
  top: 6px;
  right: 6px;
  width: 18px;
  height: 18px;
  border-radius: 4px;
  border: 1px solid #cbd5e1;
  background: #fff;
  color: #334155;
  font-size: 12px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
  z-index: 6; /* above chips/tooltips */
  user-select: none;

  /* base transform so rotation doesnâ€™t fight other rules */
  transform: rotate(0deg);
}

#prettyResult .lux-col-toggle:hover { background: #e2e8f0; }
#prettyResult .lux-col-toggle:focus-visible { outline: 2px solid #1976d2; outline-offset: 2px; }

/* Optional â€œdirectionâ€ cue: rotate when expanded */
#prettyResult table:not(.collapsed-word) th#wordHeader .lux-col-toggle[data-col="word"],
#prettyResult table:not(.collapsed-phoneme) th#phonemeHeader .lux-col-toggle[data-col="phoneme"],
#prettyResult table:not(.collapsed-syllable) th#syllableHeader .lux-col-toggle[data-col="syllable"] {
  transform: rotate(180deg);
}

/* Collapsed header width (keep thin so button remains clickable) */
#prettyResult table.collapsed-word th#wordHeader,
#prettyResult table.collapsed-phoneme th#phonemeHeader {
  width: 30px !important;
  min-width: 30px !important;
  max-width: 30px !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

/* Collapse the body cells */
#prettyResult table.collapsed-word td:nth-child(1),
#prettyResult table.collapsed-phoneme td:nth-child(5) {
  width: 0 !important;
  min-width: 0 !important;
  max-width: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  overflow: hidden !important;
  opacity: 0.15;
  pointer-events: none;
}

/* Hide header content when collapsed (leave the button visible) */
#prettyResult table.collapsed-word th#wordHeader .word-chip { display: none !important; }

#prettyResult table.collapsed-phoneme th#phonemeHeader .phoneme-chip,
#prettyResult table.collapsed-phoneme th#phonemeHeader .tooltip { display: none !important; }


/* ============================================================
   Header cells and pills (Word / Phoneme)
   ============================================================ */
.lux-col-toggle {
  position: absolute;
  top: 6px;
  width: 18px;
  height: 18px;
  border-radius: 4px;
  border: 1px solid #cbd5e1;
  background: #e2e8f0;
  color: #475569;
  font-size: 12px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
  z-index: 2;
  transition: transform 0.3s ease, background 0.15s ease;
}
.lux-col-toggle:hover { background: #d8e2ef; }
.lux-col-toggle:focus-visible { outline: 2px solid #1976d2; outline-offset: 2px; }

#prettyResult th#wordHeader .lux-col-toggle { left: 6px; right: auto; }

/* Phoneme open: on exterior RIGHT but points inward (rotate 180) */
#prettyResult th#phonemeHeader .lux-col-toggle { right: 6px; left: auto; transform: rotate(180deg); }

/* Word collapsed: move to interior RIGHT edge and point outward (rotate 180) */
#prettyResult table.collapsed-word th#wordHeader .lux-col-toggle {
  right: 6px;
  left: auto;
  transform: rotate(180deg);
}

/* Phoneme collapsed: move to interior LEFT edge and point outward (no rotate) */
#prettyResult table.collapsed-phoneme th#phonemeHeader .lux-col-toggle {
  left: 6px;
  right: auto;
  transform: rotate(0deg);
}

/* SAFE TABLE VERSION: keep headers as proper table-cells */
#wordHeader, #syllableHeader, #phonemeHeader{
  background: #f3f7fa;
  border: 1px solid #bbb;
  padding: 18px 0;
  position: relative;
  overflow: visible !important;
  z-index: 5;

  /* IMPORTANT: keep table-cell behavior */
  text-align: center;
  vertical-align: middle;
}

#prettyResult .score-table th {
  color: #223; text-align: center; font-weight: 700; vertical-align: middle;
  font-size: 1.14em; padding: 14px 0 12px 0;
  transition: background 0.16s, box-shadow 0.18s, transform 0.14s;
}

/* ============================================================
   Syllable column (expected stress glow)
   ============================================================ */

#syllableHeader{
  background: #f3f7fa;
  border: 1px solid #bbb;
  padding: 18px 0;
  position: relative;
  overflow: visible !important;
  z-index: 5;

  text-align: center;
  vertical-align: middle;
}

.word-chip.syllable-chip{
  background: #eef7fb;
  color: #205080;
  box-shadow: 0 2px 8px rgba(40, 120, 255, 0.13);
}

/* Column sizing */
#prettyResult th#syllableHeader,
#prettyResult td.syllable-cell{
  width: 240px;
  min-width: 170px;
  max-width: 340px;
}

/* ============================================================
   Collapsible Syllable column (NEW)
   ============================================================ */

#prettyResult table.collapsed-syllable th#syllableHeader{
  width: 30px !important;
  min-width: 30px !important;
  max-width: 30px !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

#prettyResult table.collapsed-syllable td:nth-child(2){
  width: 0 !important;
  min-width: 0 !important;
  max-width: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  overflow: hidden !important;
  opacity: 0.12;
  pointer-events: none;
}

#prettyResult table.collapsed-syllable th#syllableHeader .word-chip{ display:none !important; }

/* Syllable chips */
#prettyResult .lux-sylStrip{
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 6px;
}

#prettyResult .lux-syl{
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;

  font-weight: 900;
  font-size: 0.95em;
  padding: 3px 8px;
  border-radius: 999px;

  background: rgba(15, 23, 42, 0.05);
  color: #0f172a;
}

/* Expected-stress glow */
#prettyResult .lux-syl.is-stress{
  background: rgba(245, 158, 11, 0.20);
  box-shadow:
    0 0 0 1px rgba(245, 158, 11, 0.60),
    0 10px 26px rgba(245, 158, 11, 0.18);
}

/* Secondary stress: subtle emphasis (lighter than primary) */
#prettyResult .lux-syl.is-secondary{
  background: rgba(37, 99, 235, 0.10);
  box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
}

/* Tiny â€œaltsâ€ button (only shown when CMU has multiple pronunciations) */
#prettyResult .lux-sylAlt{
  border: 1px solid rgba(15, 23, 42, 0.16);
  background: rgba(15, 23, 42, 0.04);
  color: rgba(15, 23, 42, 0.75);
  border-radius: 999px;
  padding: 2px 8px;
  font-size: 0.78em;
  font-weight: 800;
  cursor: pointer;
}
#prettyResult .lux-sylAlt:hover{
  background: rgba(15, 23, 42, 0.08);
}

/* Clickable Header Backgrounds */
#wordHeader.clickable { cursor: pointer; box-shadow: 0 1.5px 5px rgba(40, 120, 255, 0.08); position: relative; z-index: 1; }
#wordHeader.clickable:hover,
#wordHeader.clickable:focus {
  background: #e0f2fd; color: #1662b0;
  box-shadow: 0 5px 24px rgba(20, 90, 220, 0.14), 0 1.5px 5px rgba(40, 120, 255, 0.08);
  transform: scale(1.05);
}

#wordHeader .word-chip:focus-visible { outline: 2.5px solid #1976d2; outline-offset: 2px; }
#wordHeader .word-chip { display: inline-block; }

/* Stop scaling the whole tooltip box on header hover */
#prettyResult th#wordHeader:hover,
#prettyResult th#phonemeHeader:hover { transform: none !important; filter: none !important; }

/* Tooltip phoneme chip: match header-pill contract (lift+shadow hover, press active) */
#prettyResult .tooltip .phoneme-chip {
  display: inline-block;
  transition: transform 0.18s ease, box-shadow 0.18s ease;
}
#prettyResult .tooltip:hover .phoneme-chip {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.28);
}
#prettyResult .tooltip:active .phoneme-chip {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* Row phoneme chips: match header-pill contract (NO scale/brightness) */
#prettyResult tbody .phoneme-chip[data-hydrated],
#resultBody .phoneme-chip[data-hydrated] {
  display: inline-block;
  transition: transform 0.18s ease, box-shadow 0.18s ease;
}
#prettyResult tbody .phoneme-chip[data-hydrated]:hover,
#resultBody .phoneme-chip[data-hydrated]:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.28);
}
#prettyResult tbody .phoneme-chip[data-hydrated]:active,
#resultBody .phoneme-chip[data-hydrated]:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* Row word pills: lift + shadow only (NO darken) */
#prettyResult tbody a {
  transition: transform 140ms ease, box-shadow 140ms ease;
}
#prettyResult tbody a:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.28);
}
#prettyResult tbody a:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.20);
}

/* ============================================================
   Previews & Popovers
   ============================================================ */
#ygPreview, #phPreview {
  position: fixed; width: 560px; height: 390px; display: none; z-index: 9999;
  border: 1px solid #ccc; border-radius: 6px; background: #000;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.25); overflow: hidden;
}
#phPreview > video {
  width: 100% !important; height: 100% !important; object-fit: contain !important;
  background: #000; transform: scale(0.96); transform-origin: center center;
}

.word-chip.phoneme-chip {
  display: inline-flex !important; align-items: center; gap: 4px;
  white-space: nowrap; overflow: visible !important; min-width: 0; padding: 4px 12px;
}
#phonemeHeader { max-width: none; min-width: 150px; }

/* ============================================================
   UNIFIED "GHOST EMOJI" LOGIC (Word + Phoneme)
   ============================================================ */

#wordHeader .word-chip,
#phonemeHeader .phoneme-chip {
  position: relative !important;
}

/* Collapsible Word/Phoneme columns */
#prettyResult table.collapsed-word th#wordHeader,
#prettyResult table.collapsed-phoneme th#phonemeHeader {
  width: 30px !important; min-width: 30px !important; max-width: 30px !important;
  padding-left: 0 !important; padding-right: 0 !important;
  transform: none !important;
}
#prettyResult table.collapsed-word td:nth-child(1),
#prettyResult table.collapsed-phoneme td:nth-child(5) {
  width: 0 !important; min-width: 0 !important; max-width: 0 !important;
  padding: 0 !important;
  overflow: hidden; opacity: 0.15; pointer-events: none;
  transform: none !important;
}
#prettyResult table.collapsed-word #wordHeader .word-chip,
#prettyResult table.collapsed-phoneme #phonemeHeader .phoneme-chip,
#prettyResult table.collapsed-phoneme #phonemeHeader .tooltip {
  display: none;
}

#wordHeader > .audio-hint,
#phonemeHeader .audio-hint {
  display: none !important;
}

#wordHeader .word-chip::after,
#phonemeHeader .phoneme-chip::after {
  content: "ðŸ”Š";
  position: absolute;
  left: 50%;
  top: -14px;
  transform: translateX(-50%) scale(1);
  font-size: 1.1em;
  color: #205080;
  opacity: 0; /* Hidden by default */
  pointer-events: none;
  transition: opacity 0.18s, transform 0.25s;
}

#wordHeader .word-chip:hover::after,
#wordHeader .word-chip:focus-visible::after,
#phonemeHeader .phoneme-chip:hover::after,
#phonemeHeader .phoneme-chip:focus-visible::after {
  opacity: 1;
  animation:
    wordAudioNudge 0.7s ease-in-out 1,
    wordAudioPulse 1.2s ease-in-out 0.7s infinite alternate;
}

#wordHeader .word-chip.is-playing::after,
#phonemeHeader .phoneme-chip.is-playing::after {
  opacity: 1;
  filter: drop-shadow(0 0 2px #ffd54f) brightness(1.3);
  animation: wordAudioPulse 1.2s ease-in-out 0s infinite alternate;
}

@keyframes wordAudioPulse {
  from { transform: translateX(-50%) scale(1); }
  to { transform: translateX(-50%) scale(1.17) translateY(-1px); }
}
@keyframes wordAudioNudge {
  0% { transform: translateX(-50%) scale(1) rotate(0deg); }
  25% { transform: translateX(-50%) scale(1.25) rotate(-10deg); }
  50% { transform: translateX(-50%) scale(1) rotate(0deg); }
  75% { transform: translateX(-50%) scale(1.2) rotate(8deg); }
  100% { transform: translateX(-50%) scale(1.05) rotate(0deg); }
}

/* Tooltip playing state: NO brightness/scale; pulse box-shadow only */
#prettyResult .tooltip.is-playing {
  animation: pulseGlow 1s ease-in-out infinite alternate;
}
@keyframes pulseGlow {
  from { box-shadow: 0 0 0 rgba(30, 144, 255, 0.0); }
  to   { box-shadow: 0 0 12px rgba(30, 144, 255, 0.55); }
}
