{"version":3,"file":"player-ui-C04Xddjs.js","sources":["../../features/features/tts/player-core.js","../../features/features/tts/player-dom.js","../../features/features/tts/player-ui.js"],"sourcesContent":["// features/features/tts/player-core.js\r\n// Core: networking, constants, voice caps (no DOM writes)\r\nexport const TTS_URL = \"https://luxury-language-api.vercel.app/api/tts\";\r\n\r\nexport const VOICES = [\r\n  { id: \"en-US-AriaNeural\", label: \"US ‚Äî Aria\" },\r\n  { id: \"en-US-AvaNeural\", label: \"US ‚Äî Ava\" },\r\n  { id: \"en-US-JennyNeural\", label: \"US ‚Äî Jenny\" },\r\n  { id: \"en-US-GuyNeural\", label: \"US ‚Äî Guy\" },\r\n  { id: \"en-US-DavisNeural\", label: \"US ‚Äî Davis\" },\r\n  { id: \"en-US-SaraNeural\", label: \"US ‚Äî Sara\" },\r\n  { id: \"en-US-NancyNeural\", label: \"US ‚Äî Nancy\" },\r\n  { id: \"en-US-MichelleNeural\", label: \"US ‚Äî Michelle\" },\r\n  { id: \"en-US-ChristopherNeural\", label: \"US ‚Äî Christopher\" },\r\n  { id: \"en-US-TonyNeural\", label: \"US ‚Äî Tony\" },\r\n  { id: \"en-US-JennyMultilingualNeural\", label: \"US ‚Äî Jenny (Multilingual)\" },\r\n  { id: \"en-US-EmmaMultilingualNeural\", label: \"US ‚Äî Emma (Multilingual)\" },\r\n];\r\n\r\nexport const DEFAULT_SPEED = 1.0;\r\nexport const DEFAULT_PITCH_ST = 0;\r\n\r\n// ---- Voice capabilities (US-only) ----\r\nexport async function getVoiceCaps() {\r\n  try {\r\n    const res = await fetch(`${TTS_URL}?voices=1`);\r\n    if (!res.ok) return {};\r\n    const data = await res.json();\r\n    const out = {};\r\n    for (const v of data.voices || []) {\r\n      if (!String(v.ShortName).startsWith(\"en-US-\")) continue;\r\n      out[v.ShortName] = {\r\n        styles: Array.isArray(v.StyleList) ? v.StyleList : [],\r\n      };\r\n    }\r\n    return out;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n// ---- TTS synthesis (returns Blob with _meta) ----\r\nexport async function synthesize(payload) {\r\n  const res = await fetch(TTS_URL, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  const hdr = (k) => res.headers.get(k) || \"\";\r\n  const meta = {\r\n    styleUsed: hdr(\"X-Style-Used\"),\r\n    styleRequested: hdr(\"X-Style-Requested\"),\r\n    fallback: hdr(\"X-Style-Fallback\"),\r\n    message: hdr(\"X-Style-Message\"),\r\n    region: hdr(\"X-Azure-Region\"),\r\n  };\r\n  if (!res.ok) {\r\n    let detail = \"\";\r\n    try {\r\n      detail = await res.text();\r\n    } catch {}\r\n    const err = new Error(`TTS ${res.status}: ${detail || \"synthesis failed\"}`);\r\n    err.meta = meta;\r\n    throw err;\r\n  }\r\n  const blob = await res.blob();\r\n  blob._meta = meta;\r\n  return blob;\r\n}","// features/features/tts/player-dom.js\r\n// Pure DOM: HTML templates and element selection helpers.\r\n\r\nimport { VOICES, DEFAULT_SPEED, DEFAULT_PITCH_ST } from \"./player-core.js\";\r\n\r\n// Helper: Scoped query selector\r\nexport const $ = (root, sel) => root.querySelector(sel);\r\n\r\n// Helper: Get text from input or selection\r\nexport function getCurrentText() {\r\n  const el =\r\n    document.querySelector(\"#referenceText\") ||\r\n    document.querySelector(\"#free-input\") ||\r\n    document.querySelector(\"#reference-text\") ||\r\n    document.querySelector(\"textarea\");\r\n  const typed = el?.value?.trim();\r\n  const sel = window.getSelection()?.toString()?.trim();\r\n  return (typed || sel || \"\").trim();\r\n}\r\n\r\nexport function populateStyles(styleSel, caps, voiceId) {\r\n  if (!styleSel) return;\r\n  const styles = caps?.[voiceId]?.styles || [];\r\n  const keep = styleSel.value;\r\n  styleSel.innerHTML =\r\n    `<option value=\"\">(neutral)</option>` +\r\n    styles.map((s) => `<option value=\"${s}\">${s}</option>`).join(\"\");\r\n  if (keep && styles.includes(keep)) styleSel.value = keep;\r\n}\r\n\r\nexport function renderControls(mount) {\r\n  const voiceOptions = VOICES.map(\r\n    (v) => `<option value=\"${v.id}\">${v.label}</option>`\r\n  ).join(\"\");\r\n\r\n  mount.innerHTML = `\r\n      <div id=\"tts-wrap\">\r\n        <div class=\"tts-box tts-compact\" style=\"padding: 10px 12px;\">\r\n          <div class=\"tts-head\">\r\n            <div id=\"tts-note\" class=\"tts-note\" aria-live=\"polite\" style=\"text-align:center; min-height:0;\"></div>\r\n          </div>\r\n  \r\n          <label class=\"tts-voice\" style=\"width:100%; display:flex !important; flex-direction:column !important; align-items:center !important; margin-bottom:4px;\">\r\n            <span style=\"font-weight:700; margin-bottom:2px; font-size:1.05em; color:#333;\">Voice</span>\r\n            <select id=\"tts-voice\" style=\"width:98%; padding:4px; margin:0 auto; display:block;\">${voiceOptions}</select>\r\n          </label>\r\n  \r\n          <label class=\"tts-speed\" style=\"margin-bottom:4px; width:98%;\">\r\n            <span style=\"font-size:0.9em; font-weight:600; color:#444;\">Speed</span>\r\n            <input id=\"tts-speed\" type=\"range\" min=\"0.7\" max=\"1.3\" step=\"0.05\" value=\"${DEFAULT_SPEED}\">\r\n            <span id=\"tts-speed-out\" style=\"font-size:0.9em;\">${DEFAULT_SPEED.toFixed(2)}√ó</span>\r\n          </label>\r\n  \r\n          <label class=\"tts-style-label\" style=\"width:100%; display:flex !important; flex-direction:column !important; align-items:center !important; margin: 2px 0 6px 0;\">\r\n             <span style=\"font-weight:600; margin-bottom:2px; font-size:0.95em;\">Speaking Style</span>\r\n             <select id=\"tts-style\" style=\"width:98%; padding:4px;\"><option value=\"\">(neutral)</option></select>\r\n          </label>\r\n\r\n          <div class=\"tts-mixed-row\" style=\"width:98%; display:flex !important; justify-content:space-between !important; align-items:end; gap:8px; margin-bottom:8px;\">\r\n             \r\n             <label class=\"tts-pitch-col\" style=\"flex:1; display:flex; flex-direction:column; gap:2px;\">\r\n                <div style=\"display:flex; justify-content:space-between; font-size:0.85rem; font-weight:600; color:#444;\">\r\n                   <span>Pitch</span>\r\n                   <span id=\"tts-pitch-out\" style=\"color:#0078d7;\">${DEFAULT_PITCH_ST}</span>\r\n                </div>\r\n                <input id=\"tts-pitch\" type=\"range\" min=\"-12\" max=\"12\" step=\"1\" value=\"${DEFAULT_PITCH_ST}\" style=\"width:100%; cursor:pointer;\">\r\n             </label>\r\n\r\n             <label class=\"tts-degree-col\" style=\"width:70px; display:flex; flex-direction:column; gap:2px;\">\r\n                <span style=\"font-size:0.85rem; font-weight:600; color:#444; text-align:center;\">Degree</span>\r\n                <input id=\"tts-styledegree\" type=\"number\" min=\"0.1\" max=\"2.5\" step=\"0.1\" value=\"2.5\" style=\"width:100%; padding:3px; text-align:center; border:1px solid #ccc; border-radius:6px;\">\r\n             </label>\r\n\r\n          </div>\r\n  \r\n          <button id=\"tts-main\" class=\"tts-btn tts-btn--primary\"\r\n            title=\"Click: play/pause ‚Ä¢ Double-click: restart & play\" style=\"width:98%; margin-bottom:8px; padding: 8px;\">üîä Generate & Play</button>\r\n  \r\n          <div class=\"tts-skip\" style=\"display:flex; justify-content:center; gap:10px; align-items:center;\">\r\n            <button id=\"tts-back\" class=\"tts-btn tts-btn--sm\" title=\"Back 2 seconds\">‚Ü∫ 2s</button>\r\n            \r\n            <a id=\"tts-download\" class=\"tts-link\" href=\"#\" download=\"lux_tts.mp3\" title=\"Download audio\" style=\"font-size:1.4rem; line-height:1; text-decoration:none;\">‚¨áÔ∏è</a>\r\n            \r\n            <button id=\"tts-fwd\"  class=\"tts-btn tts-btn--sm\" title=\"Forward 2 seconds\">‚Üª 2s</button>\r\n          </div>\r\n  \r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n  // Apply layout styles immediately\r\n  const box = mount.querySelector(\".tts-compact\");\r\n  if (box)\r\n    Object.assign(box.style, {\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      alignItems: \"center\",\r\n    });\r\n}","// features/features/tts/player-ui.js\r\n// Logic: Event wiring, audio state management, and API orchestration.\r\n// UPDATED: simplified Waveform handoff (passes Blob directly to WaveSurfer).\r\n\r\nimport {\r\n  VOICES,\r\n  DEFAULT_SPEED,\r\n  getVoiceCaps,\r\n  synthesize,\r\n} from \"./player-core.js\";\r\n\r\nimport {\r\n  $,\r\n  getCurrentText,\r\n  renderControls,\r\n  populateStyles,\r\n} from \"./player-dom.js\";\r\n\r\n// NEW IMPORT: simplified blob loader\r\nimport { loadReferenceBlob } from \"../selfpb/waveform-logic.js\";\r\n\r\nconst isPlaying = (audio) =>\r\n  !audio.paused && !audio.ended && audio.currentTime > 0;\r\n\r\n/* --- ALWAYS-MOVES PATCH: progress render loop --- */\r\nfunction wireTtsProgress(audioEl, fillEl) {\r\n  if (!audioEl || !fillEl) return () => {};\r\n\r\n  let raf = 0;\r\n\r\n  const clamp01 = (n) => Math.max(0, Math.min(1, n));\r\n\r\n  function paint(pct) {\r\n    // Width-based bar fill (matches most simple progress-fill CSS)\r\n    fillEl.style.width = `${clamp01(pct) * 100}%`;\r\n  }\r\n\r\n  function render() {\r\n    const dur = audioEl.duration || 0;\r\n    const t = audioEl.currentTime || 0;\r\n    const pct = dur > 0 ? t / dur : 0;\r\n    paint(pct);\r\n    raf = requestAnimationFrame(render);\r\n  }\r\n\r\n  function start() {\r\n    cancelAnimationFrame(raf);\r\n    raf = requestAnimationFrame(render);\r\n  }\r\n\r\n  function stop() {\r\n    cancelAnimationFrame(raf);\r\n    raf = 0;\r\n  }\r\n\r\n  // Keep it ‚Äúalways moves while playing‚Äù via RAF\r\n  audioEl.addEventListener(\"play\", start);\r\n  audioEl.addEventListener(\"pause\", stop);\r\n  audioEl.addEventListener(\"ended\", () => {\r\n    stop();\r\n    paint(1);\r\n  });\r\n\r\n  // Also update on timeupdate as a fallback\r\n  audioEl.addEventListener(\"timeupdate\", () => {\r\n    const dur = audioEl.duration || 0;\r\n    const t = audioEl.currentTime || 0;\r\n    const pct = dur > 0 ? t / dur : 0;\r\n    paint(pct);\r\n  });\r\n\r\n  // Initial state\r\n  paint(0);\r\n\r\n  // Return a tiny cleanup function in case you ever need it later\r\n  return () => stop();\r\n}\r\n\r\nexport async function mountTTSPlayer(hostEl) {\r\n  const host = hostEl || document.getElementById(\"tts-controls\");\r\n  if (!host) return;\r\n\r\n  // --- NUCLEAR FIX START (Visibility Guards) ---\r\n  const guard = document.getElementById(\"lux-tts-guard-style\");\r\n  if (guard) guard.remove();\r\n\r\n  host.dataset.luxHidden = \"0\";\r\n  host.removeAttribute(\"data-luxHidden\");\r\n  host.style.display = \"flex\";\r\n  host.style.visibility = \"visible\";\r\n  host.style.opacity = \"1\";\r\n  // --- NUCLEAR FIX END ---\r\n\r\n  // 1. Render the HTML Template\r\n  renderControls(host);\r\n\r\n  // 2. Select Elements\r\n  const voiceSel = $(host, \"#tts-voice\");\r\n  const speedEl = $(host, \"#tts-speed\");\r\n  const speedOut = $(host, \"#tts-speed-out\");\r\n  const mainBtn = $(host, \"#tts-main\");\r\n  const backBtn = $(host, \"#tts-back\");\r\n  const fwdBtn = $(host, \"#tts-fwd\");\r\n  const dl = $(host, \"#tts-download\");\r\n  const note = $(host, \"#tts-note\");\r\n  const pitchEl = $(host, \"#tts-pitch\");\r\n  const pitchOut = $(host, \"#tts-pitch-out\");\r\n  const styleSel = $(host, \"#tts-style\");\r\n  const degreeEl = $(host, \"#tts-styledegree\");\r\n\r\n  // Progress fill (safe: only wires if found)\r\n  const progressFill =\r\n    host.querySelector(\"#tts-progress-fill\") ||\r\n    host.querySelector(\".tts-progress-fill\") ||\r\n    host.querySelector(\".tts-progress__fill\") ||\r\n    host.querySelector(\"[data-tts-progress-fill]\");\r\n\r\n  // 3. Initialize Audio\r\n  const audio = new Audio();\r\n  audio.preload = \"auto\";\r\n  audio.playbackRate = DEFAULT_SPEED;\r\n\r\n  // Expose audio for other panels (like Self Playback sync)\r\n  window.luxTTS = Object.assign(window.luxTTS || {}, { audioEl: audio });\r\n\r\n  // Wire progress (always moves while playing)\r\n  // (No-op if progressFill not found)\r\n  const stopProgress = wireTtsProgress(audio, progressFill);\r\n\r\n  // 4. Load Capabilities (Async)\r\n  let caps = await getVoiceCaps();\r\n  populateStyles(styleSel, caps, voiceSel.value);\r\n\r\n  voiceSel.addEventListener(\"change\", () =>\r\n    populateStyles(styleSel, caps, voiceSel.value)\r\n  );\r\n\r\n  // 5. Wire Inputs\r\n  const updateSpeedOut = () => {\r\n    const v = Number(speedEl.value) || 1;\r\n    speedOut.textContent = v.toFixed(2) + \"√ó\";\r\n    audio.playbackRate = v;\r\n    if (window.LuxSelfPB?.setRefRate) window.LuxSelfPB.setRefRate(v);\r\n  };\r\n\r\n  const updatePitchOut = () => {\r\n    const p = Number(pitchEl.value) || 0;\r\n    pitchOut.textContent = String(p);\r\n  };\r\n\r\n  updateSpeedOut();\r\n  updatePitchOut();\r\n\r\n  speedEl.addEventListener(\"input\", updateSpeedOut);\r\n  pitchEl.addEventListener(\"input\", updatePitchOut);\r\n\r\n  // 6. Audio Controls (UPDATED to 2 seconds)\r\n  backBtn.addEventListener(\"click\", () => {\r\n    audio.currentTime = Math.max(0, audio.currentTime - 2);\r\n  });\r\n\r\n  fwdBtn.addEventListener(\"click\", () => {\r\n    audio.currentTime = Math.min(audio.duration || Infinity, audio.currentTime + 2);\r\n  });\r\n\r\n  // 7. Playback Logic\r\n  function setMainLabel(playing) {\r\n    mainBtn.textContent = playing\r\n      ? \"‚è∏Ô∏è Pause (dbl-click = Restart)\"\r\n      : \"üîä Generate & Play\";\r\n  }\r\n\r\n  function uiNote(msg, tone = \"info\") {\r\n    if (!note) return;\r\n    note.textContent = msg || \"\";\r\n    note.className = `tts-note ${tone === \"warn\" ? \"tts-note--warn\" : \"\"}`;\r\n  }\r\n\r\n  let blobUrl = null;\r\n  let lastKey = null;\r\n  let clickPending = false;\r\n  let dblTriggered = false;\r\n\r\n  async function ensureAudioReadyAndPlay() {\r\n    const text = getCurrentText();\r\n    if (!text) return alert(\"Type or select some text first.\");\r\n\r\n    const voice = voiceSel?.value || VOICES[0].id;\r\n    const speedMult = Number(speedEl.value) || 1;\r\n    const ratePct = Math.round((speedMult - 1) * 100);\r\n    const style = styleSel?.value || \"\";\r\n    const styledegree = parseFloat(degreeEl?.value || \"1\");\r\n    const pitchSt = Number(pitchEl.value) || 0;\r\n\r\n    const key = `${voice}|${text}|style:${style}|deg:${styledegree}|rate:${ratePct}|pitch:${pitchSt}`;\r\n\r\n    // Reuse existing blob if params match\r\n    if (key === lastKey && audio.src) {\r\n      if (window.LuxSelfPB?.setReference) {\r\n        window.LuxSelfPB.setReference({\r\n          audioEl: audio,\r\n          meta: { voice, style, styledegree, rate: speedMult, ratePct, pitchSt },\r\n        });\r\n      }\r\n      try {\r\n        await audio.play();\r\n        setMainLabel(true);\r\n      } catch {}\r\n      return;\r\n    }\r\n\r\n    // Generate New\r\n    try {\r\n      const blob = await synthesize({\r\n        text,\r\n        voice,\r\n        ratePct,\r\n        pitchSt,\r\n        style,\r\n        styledegree,\r\n      });\r\n\r\n      if (blob._meta) {\r\n        const { styleUsed, styleRequested, fallback, message } = blob._meta;\r\n        if (message) uiNote(message, fallback ? \"warn\" : \"info\");\r\n        else if (fallback)\r\n          uiNote(`Style '${styleRequested}' unsupported. Playing neutral.`, \"warn\");\r\n        else if (styleUsed && styleUsed !== \"neutral\")\r\n          uiNote(`Playing ${voice} in '${styleUsed}'.`);\r\n        else uiNote(\"\");\r\n      }\r\n\r\n      // Reset progress UI on new audio (optional but nice)\r\n      if (progressFill) progressFill.style.width = \"0%\";\r\n\r\n      if (blobUrl) URL.revokeObjectURL(blobUrl);\r\n      blobUrl = URL.createObjectURL(blob);\r\n      audio.src = blobUrl;\r\n      audio.playbackRate = speedMult;\r\n      lastKey = key;\r\n\r\n      if (dl) {\r\n        dl.href = blobUrl;\r\n        dl.download = \"lux_tts.mp3\";\r\n      }\r\n\r\n      // --- WAVEFORM HANDOFF (Simplified) ---\r\n      if (blob) {\r\n        loadReferenceBlob(blob);\r\n      }\r\n      // ------------------------------------\r\n\r\n      // Sync with Self Playback\r\n      if (window.LuxSelfPB?.setReference) {\r\n        window.LuxSelfPB.setReference({\r\n          audioEl: audio,\r\n          meta: { voice, style, styledegree, rate: speedMult, ratePct, pitchSt },\r\n        });\r\n      }\r\n\r\n      await audio.play();\r\n      setMainLabel(true);\r\n    } catch (e) {\r\n      console.error(e);\r\n      uiNote(e.meta?.message || \"Synthesis failed.\", \"warn\");\r\n      alert(e.message || \"Text-to-speech failed\");\r\n    }\r\n  }\r\n\r\n  // Double-click to Restart\r\n  mainBtn.addEventListener(\"dblclick\", async (e) => {\r\n    e.preventDefault();\r\n    dblTriggered = true;\r\n    audio.currentTime = 0;\r\n    if (audio.src) {\r\n      try {\r\n        await audio.play();\r\n        setMainLabel(true);\r\n      } catch {}\r\n    } else {\r\n      await ensureAudioReadyAndPlay();\r\n    }\r\n  });\r\n\r\n  // Single-click to Toggle\r\n  mainBtn.addEventListener(\"click\", async (e) => {\r\n    e.preventDefault();\r\n    if (clickPending) return;\r\n    clickPending = true;\r\n\r\n    setTimeout(async () => {\r\n      if (!dblTriggered) {\r\n        if (!audio.src || audio.ended) await ensureAudioReadyAndPlay();\r\n        else if (isPlaying(audio)) {\r\n          audio.pause();\r\n          setMainLabel(false);\r\n        } else {\r\n          try {\r\n            await audio.play();\r\n            setMainLabel(true);\r\n          } catch {}\r\n        }\r\n      }\r\n      clickPending = false;\r\n      dblTriggered = false;\r\n    }, 230);\r\n  });\r\n\r\n  audio.addEventListener(\"ended\", () => setMainLabel(false));\r\n\r\n  // If Lux ever remounts the player, stop any old RAF loop (defensive)\r\n  // (Right now mount only happens once, but this keeps it safe)\r\n  window.luxTTS = Object.assign(window.luxTTS || {}, { stopProgress });\r\n\r\n  (window.luxTTS?.nudge || (() => {}))();\r\n  console.info(\"[tts-player] azure controls mounted\");\r\n}\r\n"],"names":["TTS_URL","VOICES","DEFAULT_SPEED","DEFAULT_PITCH_ST","getVoiceCaps","res","data","out","v","synthesize","payload","hdr","k","meta","detail","err","blob","$","root","sel","getCurrentText","el","typed","_a","_c","_b","populateStyles","styleSel","caps","voiceId","styles","keep","s","renderControls","mount","voiceOptions","box","isPlaying","audio","wireTtsProgress","audioEl","fillEl","raf","clamp01","n","paint","pct","render","dur","t","start","stop","mountTTSPlayer","hostEl","host","guard","voiceSel","speedEl","speedOut","mainBtn","backBtn","fwdBtn","dl","note","pitchEl","pitchOut","degreeEl","progressFill","stopProgress","updateSpeedOut","updatePitchOut","p","setMainLabel","playing","uiNote","msg","tone","blobUrl","lastKey","clickPending","dblTriggered","ensureAudioReadyAndPlay","text","voice","speedMult","ratePct","style","styledegree","pitchSt","key","styleUsed","styleRequested","fallback","message","loadReferenceBlob","e"],"mappings":"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"}