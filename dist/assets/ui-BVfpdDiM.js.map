{"version":3,"file":"ui-BVfpdDiM.js","sources":["../../features/features/selfpb/core.js","../../features/features/selfpb/ui.js"],"sourcesContent":["// features/features/selfpb/core.js\r\n// Core: audio engine, AB loop, rate persistence, reference handling, public API\r\n\r\nif (window.LuxSelfPB?.__mounted) {\r\n  console.warn(\"[self-pb] already mounted, aborting second mount\");\r\n  throw new Error(\"self-pb double mount\");\r\n}\r\nwindow.LuxSelfPB = Object.assign(window.LuxSelfPB || {}, { __mounted: true });\r\n\r\nconst LS_RATE = \"selfpb_rate_v1\";\r\nconst clamp = (n, a, b) => Math.max(a, Math.min(b, n));\r\nconst fmt = (t) => {\r\n  if (!isFinite(t) || t < 0) t = 0;\r\n  const m = Math.floor(t / 60);\r\n  const s = Math.floor(t % 60)\r\n    .toString()\r\n    .padStart(2, \"0\");\r\n  return `${m}:${s}`;\r\n};\r\n\r\nfunction ensureLearnerAudioEl() {\r\n  let audio = document.getElementById(\"playbackAudio\");\r\n  if (!audio) {\r\n    audio = document.createElement(\"audio\");\r\n    audio.id = \"playbackAudio\";\r\n    audio.hidden = true;\r\n    document.body.appendChild(audio);\r\n  }\r\n  return audio;\r\n}\r\n\r\nexport function initSelfPBCore() {\r\n  // learner audio (controls the actual playback used across the app)\r\n  const audio = ensureLearnerAudioEl();\r\n\r\n  // reference audio (from TTS)\r\n  const refAudio = new Audio();\r\n  refAudio.preload = \"auto\";\r\n  let refMeta = null;\r\n\r\n  // state\r\n  const st = {\r\n    a: null,\r\n    b: null,\r\n    looping: false,\r\n    playing: false,\r\n    scrubbing: false, // UI toggles this while dragging\r\n  };\r\n\r\n  // init rate from storage\r\n  const savedRate = Number(localStorage.getItem(LS_RATE) || \"1\") || 1;\r\n  audio.playbackRate = clamp(savedRate, 0.5, 1.5);\r\n\r\n  // AB loop enforcement on timeupdate\r\n  function onTimeUpdate() {\r\n    if (st.looping && st.a != null && st.b != null && st.b > st.a) {\r\n      if (audio.currentTime >= st.b) {\r\n        audio.currentTime = Math.max(st.a, st.a + 0.01);\r\n        if (audio.paused) audio.play().catch(() => {});\r\n      }\r\n    }\r\n  }\r\n  audio.addEventListener(\"timeupdate\", onTimeUpdate);\r\n\r\n  // Public API (DOM-free)\r\n  const api = {\r\n    // UI calls this while dragging → prevents programmatic scrub from fighting slider\r\n    _setScrubbingOn() {\r\n      st.scrubbing = true;\r\n    },\r\n    _setScrubbingOff() {\r\n      st.scrubbing = false;\r\n    },\r\n    getState() {\r\n      return st;\r\n    },\r\n    getAudio() {\r\n      return audio;\r\n    },\r\n    getRefAudio() {\r\n      return refAudio;\r\n    },\r\n    getRefMeta() {\r\n      return refMeta;\r\n    },\r\n\r\n    setAB(a, b) {\r\n      st.a = a;\r\n      st.b = b;\r\n    },\r\n    clearAB() {\r\n      st.a = st.b = null;\r\n      st.looping = false;\r\n    },\r\n    setRate(v) {\r\n      audio.playbackRate = clamp(v, 0.5, 1.5);\r\n      localStorage.setItem(LS_RATE, String(audio.playbackRate));\r\n    },\r\n    setRefRate(v) {\r\n      refAudio.playbackRate = clamp(Number(v) || 1, 0.5, 1.5);\r\n      if (window.LuxSelfPB_REF)\r\n        window.LuxSelfPB_REF.playbackRate = refAudio.playbackRate;\r\n    },\r\n    setReference({ url, audioEl, meta } = {}) {\r\n      try {\r\n        if (audioEl instanceof HTMLAudioElement) {\r\n          refAudio.srcObject = null;\r\n          refAudio.src = audioEl.src || \"\";\r\n          refAudio.playbackRate = audioEl.playbackRate || 1;\r\n        } else if (typeof url === \"string\" && url) {\r\n          refAudio.srcObject = null;\r\n          refAudio.src = url;\r\n        }\r\n        refMeta = meta || null;\r\n        window.LuxSelfPB_REF = {\r\n          url: refAudio.src || null,\r\n          meta: refMeta,\r\n          playbackRate: refAudio.playbackRate || 1,\r\n        };\r\n      } catch (e) {\r\n        console.warn(\"[selfpb] setReference failed:\", e);\r\n      }\r\n    },\r\n    \r\n    // ✅ CRITICAL FIX: BREAK THE LOOP & FIX MEMORY LEAK\r\n    async setLearnerArrayBuffer(arrBuf) {\r\n      try {\r\n        // 1. Cleanup old memory if we tracked it\r\n        if (window.LuxSelfPB_LastUrl) {\r\n            URL.revokeObjectURL(window.LuxSelfPB_LastUrl);\r\n        }\r\n\r\n        // 2. STOP THE LOOP:\r\n        // We do NOT set audio.src here. The main recorder logic (recording.js/index.html) \r\n        // has already set the source. Setting it again causes the 'loadeddata' event \r\n        // to fire again, which calls this function again -> Infinite Loop.\r\n        \r\n        console.log(\"[selfpb] Learner buffer received (Loop guarded).\");\r\n        \r\n        // We just ensure the audio is ready to play if needed, \r\n        // but we trust the existing src.\r\n        if (!audio.src) {\r\n             const blob = new Blob([arrBuf], { type: \"audio/mpeg\" });\r\n             const url = URL.createObjectURL(blob);\r\n             window.LuxSelfPB_LastUrl = url;\r\n             audio.src = url;\r\n             await audio.load?.();\r\n        }\r\n        \r\n      } catch (e) {\r\n        console.warn(\"[selfpb] setLearnerArrayBuffer failed:\", e);\r\n      }\r\n    },\r\n    \r\n    async play() {\r\n      try {\r\n        await audio.play();\r\n      } catch {}\r\n      st.playing = !audio.paused;\r\n    },\r\n    pause() {\r\n      try {\r\n        audio.pause();\r\n      } catch {}\r\n      st.playing = false;\r\n    },\r\n\r\n    // helpers for UI\r\n    fmt,\r\n    clamp,\r\n    persistRate(v) {\r\n      localStorage.setItem(LS_RATE, String(clamp(v, 0.5, 1.5)));\r\n    },\r\n  };\r\n\r\n  // expose API (back-compat)\r\n  window.LuxSelfPB = Object.assign(window.LuxSelfPB || {}, api);\r\n\r\n  return { api, audio, refAudio, st };\r\n}","// features/features/selfpb/ui.js\r\n// FINAL PIVOT: Using WaveSurfer.js for reliable waveforms.\r\n\r\nimport { initSelfPBCore } from \"./core.js\";\r\nimport { initWaveSurfer, loadLearnerBlob } from \"./waveform-logic.js\"; \r\n\r\nfunction ensureStyles() {\r\n  const STYLE_ID = \"selfpb-lite-style\";\r\n  if (document.getElementById(STYLE_ID)) return;\r\n  const s = document.createElement(\"style\");\r\n  s.id = STYLE_ID;\r\n  s.textContent = `\r\n    /* Light Theme + Layout Styles */\r\n    #selfpb-lite{position:fixed;top:12px;left:12px;z-index:9999;border-radius:14px;padding:10px 12px;font:600 14px system-ui,-apple-system,Segoe UI,Roboto,sans-serif;box-shadow:0 6px 18px rgba(0,0,0,.25)}\r\n    #selfpb-lite .row{display:flex;align-items:center;gap:8px}\r\n    #selfpb-lite .btn{padding:6px 10px;border-radius:8px;border:0;background:#2d6cdf;color:#fff;cursor:pointer;transition:background 0.15s, transform 0.1s;}\r\n    #selfpb-lite .btn:hover{filter:brightness(1.1);}\r\n    #selfpb-lite .btn:active{transform:scale(0.96);}\r\n    #selfpb-lite .btn[disabled]{opacity:.5;cursor:not-allowed}\r\n    #selfpb-lite .pill{border-radius:999px;padding:6px 10px}\r\n    #selfpb-lite .meta{opacity:.85}\r\n    #selfpb-lite input[type=\"range\"]{accent-color:#2d6cdf}\r\n    #selfpb-lite .ab{display:flex;gap:6px;position:relative;} \r\n    #selfpb-lite .tiny{font-weight:700;opacity:.8}\r\n    \r\n    /* Layout Fixes */\r\n    #selfpb-lite .scrub{flex:1;min-width:150px} \r\n    #selfpb-lite .spacer{flex:1}\r\n    #spb-main { width: 110px; font-weight: 800; font-size: 1.05em; flex-shrink: 0; }\r\n    #spb-loop-action { min-width: 100px; background: #e0e7ff; color: #3730a3; border: 1px solid #c7d2fe; }\r\n    #spb-loop-action.active { background: #4338ca; color: #fff; border-color: #312e81; }\r\n\r\n    /* Floating \"Coach Mark\" Bubble */\r\n    .spb-bubble {\r\n        position: absolute; top: -38px; left: 0;\r\n        background: rgba(0,0,0,0.85); color: #fff;\r\n        padding: 4px 8px; border-radius: 6px; font-size: 11px;\r\n        white-space: nowrap; pointer-events: none;\r\n        opacity: 0; transition: opacity 0.4s;\r\n    }\r\n    .spb-bubble.visible { opacity: 1; }\r\n    .spb-bubble::after {\r\n        content: ''; position: absolute; bottom: -4px; left: 16px;\r\n        border-left: 4px solid transparent; border-right: 4px solid transparent;\r\n        border-top: 4px solid rgba(0,0,0,0.85);\r\n    }\r\n  `;\r\n  document.head.appendChild(s);\r\n}\r\n\r\nfunction buildUI() {\r\n  const host = document.createElement(\"div\");\r\n  host.id = \"selfpb-lite\";\r\n  host.innerHTML = `\r\n    <div class=\"row\" style=\"margin-bottom:6px; position:relative;\">\r\n      <span id=\"spb-toast\" class=\"pill tiny\" style=\"display:none; position:absolute; right:0; top:0; background:#ef4444; border-color:#b91c1c; color:#fff; z-index:10; box-shadow: 0 2px 10px rgba(0,0,0,0.5);\"></span>\r\n      <div class=\"spacer\"></div> \r\n      <span class=\"pill tiny\" id=\"spb-ref\">Ref: —</span>\r\n      <span class=\"pill tiny\" id=\"spb-time\">0:00 / 0:00</span>\r\n    </div>\r\n\r\n    <div id=\"spb-waveform-container\" style=\"margin-bottom: 6px; padding: 4px 0;\">\r\n       <div id=\"spb-wave-learner\" style=\"height: 50px; width: 100%;\"></div>\r\n       <div id=\"spb-wave-ref\" style=\"height: 50px; width: 100%; border-top: 1px solid #eee;\"></div>\r\n    </div>\r\n\r\n    <div class=\"row\" style=\"margin-bottom:6px\">\r\n      <button class=\"btn\" id=\"spb-back\">−2s</button>\r\n      <input id=\"spb-scrub\" class=\"scrub\" type=\"range\" min=\"0\" max=\"1000\" step=\"1\" value=\"0\" title=\"Seek\">\r\n      <button class=\"btn\" id=\"spb-fwd\">+2s</button>\r\n    </div>\r\n\r\n    <div class=\"row\" style=\"margin-bottom:8px\">\r\n      <button class=\"btn\" id=\"spb-main\">▶ Play</button>\r\n      <div class=\"pill\" title=\"Playback speed\" style=\"flex:1; display:flex; align-items:center; justify-content:center; padding: 6px 4px;\">\r\n        <span class=\"tiny\" style=\"margin-right:4px\">Speed</span>\r\n        <input id=\"spb-rate\" type=\"range\" min=\"0.5\" max=\"1.5\" step=\"0.05\" value=\"1\" style=\"width:90px; margin:0 6px\">\r\n        <span class=\"tiny\" id=\"spb-rate-val\">1.00×</span>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"row\">\r\n      <div class=\"pill ab\" style=\"flex:1;\">\r\n        <div id=\"spb-loop-tip\" class=\"spb-bubble\">Tap <b>A</b> then <b>B</b> to loop.</div>\r\n        <button class=\"btn\" id=\"spb-loop-action\">⟳ Set Loop A</button>\r\n        <span class=\"tiny\" id=\"spb-ab-label\" style=\"margin-left:12px; color:#666;\">Loop: Off</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n  document.body.appendChild(host);\r\n  return {\r\n    host,\r\n    toast: host.querySelector(\"#spb-toast\"),\r\n    mainBtn: host.querySelector(\"#spb-main\"),\r\n    backBtn: host.querySelector(\"#spb-back\"),\r\n    fwdBtn: host.querySelector(\"#spb-fwd\"),\r\n    scrub: host.querySelector(\"#spb-scrub\"),\r\n    rate: host.querySelector(\"#spb-rate\"),\r\n    rateVal: host.querySelector(\"#spb-rate-val\"),\r\n    timeLab: host.querySelector(\"#spb-time\"),\r\n    loopAction: host.querySelector(\"#spb-loop-action\"),\r\n    loopTip: host.querySelector(\"#spb-loop-tip\"),\r\n    abLabel: host.querySelector(\"#spb-ab-label\"),\r\n    refLabel: host.querySelector(\"#spb-ref\"),\r\n    // Containers\r\n    waveLearner: host.querySelector(\"#spb-wave-learner\"),\r\n    waveRef: host.querySelector(\"#spb-wave-ref\"),\r\n  };\r\n}\r\n\r\nexport function mountSelfPlaybackLite() {\r\n  const { api, audio, refAudio, st } = initSelfPBCore();\r\n  ensureStyles();\r\n  const ui = buildUI();\r\n  \r\n  // Initialize WaveSurfer\r\n  initWaveSurfer({\r\n    learnerContainer: ui.waveLearner,\r\n    refContainer: ui.waveRef,\r\n    masterAudio: audio \r\n  });\r\n\r\n  // --- Logic helpers ---\r\n  const showToast = (msg, duration = 2000) => {\r\n    ui.toast.textContent = msg;\r\n    ui.toast.style.display = \"inline-block\";\r\n    ui.host.animate([{ transform: 'translateX(0)' }, { transform: 'translateX(-4px)' }, { transform: 'translateX(4px)' }, { transform: 'translateX(0)' }], { duration: 200 });\r\n    setTimeout(() => { ui.toast.style.display = \"none\"; }, duration);\r\n  };\r\n  const showLoopHint = () => {\r\n    if (localStorage.getItem(\"spb-hint-seen\") !== \"true\") {\r\n      ui.loopTip.classList.add(\"visible\");\r\n      setTimeout(() => { ui.loopTip.classList.remove(\"visible\"); localStorage.setItem(\"spb-hint-seen\", \"true\"); }, 4000);\r\n    }\r\n  };\r\n  const syncButtons = () => {\r\n    ui.mainBtn.textContent = st.playing ? \"⏸ Pause\" : \"▶ Play\";\r\n    if (st.a == null) { ui.loopAction.textContent = \"⟳ Set Loop A\"; ui.loopAction.classList.remove(\"active\"); ui.abLabel.textContent = \"Loop: Off\"; } \r\n    else if (st.b == null) { ui.loopAction.textContent = \"⟳ Set Loop B\"; ui.loopAction.classList.add(\"active\"); ui.abLabel.textContent = `A: ${api.fmt(st.a)} …`; } \r\n    else { ui.loopAction.textContent = \"× Clear Loop\"; ui.loopAction.classList.remove(\"active\"); ui.abLabel.textContent = `A: ${api.fmt(st.a)}  B: ${api.fmt(st.b)}`; }\r\n  };\r\n  const syncTime = () => { ui.timeLab.textContent = `${api.fmt(audio.currentTime || 0)} / ${api.fmt(audio.duration || 0)}`; };\r\n  const syncScrub = () => {\r\n    if (!st.scrubbing) { const dur = audio.duration || 0; const p = dur ? Math.floor((audio.currentTime / dur) * 1000) : 0; ui.scrub.value = String(api.clamp(p, 0, 1000)); }\r\n  };\r\n  const syncRateUI = () => { ui.rateVal.textContent = `${Number(audio.playbackRate).toFixed(2)}×`; ui.rate.value = String(audio.playbackRate || 1); };\r\n  const syncRefUI = () => {\r\n    const ready = !!refAudio.src; const r = refAudio.playbackRate || 1; const d = isFinite(refAudio.duration) ? api.fmt(refAudio.duration) : \"—:—\";\r\n    const meta = api.getRefMeta(); const v = meta && (meta.voice || meta.style) ? ` ${meta.voice || \"\"}` : \"\";\r\n    ui.refLabel.textContent = ready ? `Ref: ${r.toFixed(2)}× · ${d}${v}` : \"Ref: —\";\r\n  };\r\n\r\n  const handlePlayAction = async (isRestart = false) => {\r\n    if (!audio.currentSrc && !audio.src) { showToast(\"No recording yet!\"); return; }\r\n    if (audio.duration === 0 || isNaN(audio.duration)) { showToast(\"Audio empty/loading...\"); return; }\r\n    try {\r\n      if (isRestart) { audio.currentTime = (st.looping && st.a != null) ? st.a : 0; if (!st.playing) await api.play(); } \r\n      else { if (st.playing) api.pause(); else { if (st.looping && st.a != null && st.b != null && st.b > st.a) { if (audio.currentTime < st.a || audio.currentTime > st.b) audio.currentTime = st.a; } await api.play(); } }\r\n    } catch (err) { console.warn(\"[selfpb] Play failed\", err); showToast(\"Playback failed\"); } finally { syncButtons(); }\r\n  };\r\n  \r\n  const handleLoopClick = () => {\r\n    if (!audio.duration) { showToast(\"No audio to loop!\"); return; }\r\n    if (st.a == null) { st.a = audio.currentTime || 0; st.looping = false; showLoopHint(); } \r\n    else if (st.b == null) { st.b = audio.currentTime || 0; if (st.b < st.a) { const t = st.a; st.a = st.b; st.b = t; } st.looping = true; audio.currentTime = st.a; if (!st.playing) api.play(); } \r\n    else { api.clearAB(); } syncButtons();\r\n  };\r\n\r\n  ui.mainBtn.addEventListener(\"click\", (e) => { if (e.detail !== 2) handlePlayAction(false); });\r\n  ui.mainBtn.addEventListener(\"dblclick\", (e) => { e.preventDefault(); handlePlayAction(true); });\r\n  \r\n  // CHANGED: 2.0 seconds skip\r\n  ui.backBtn.addEventListener(\"click\", () => { audio.currentTime = api.clamp((audio.currentTime || 0) - 2.0, 0, audio.duration || 0); syncTime(); syncScrub(); });\r\n  ui.fwdBtn.addEventListener(\"click\", () => { audio.currentTime = api.clamp((audio.currentTime || 0) + 2.0, 0, audio.duration || 0); syncTime(); syncScrub(); });\r\n  \r\n  ui.scrub.addEventListener(\"input\", () => { api._setScrubbingOn(); const p = Number(ui.scrub.value) / 1000; audio.currentTime = api.clamp(p * (audio.duration || 0), 0, audio.duration || 0); syncTime(); });\r\n  ui.scrub.addEventListener(\"change\", () => api._setScrubbingOff());\r\n  ui.rate.addEventListener(\"input\", () => { const v = api.clamp(Number(ui.rate.value) || 1, 0.5, 1.5); api.setRate(v); syncRateUI(); });\r\n  \r\n  ui.loopAction.addEventListener(\"click\", handleLoopClick);\r\n  // REMOVED: Double-click clear listener\r\n\r\n  audio.addEventListener(\"timeupdate\", () => { syncTime(); syncScrub(); });\r\n  audio.addEventListener(\"play\", () => { st.playing = true; syncButtons(); });\r\n  audio.addEventListener(\"pause\", () => { st.playing = false; syncButtons(); });\r\n  audio.addEventListener(\"loadedmetadata\", () => { syncTime(); syncScrub(); });\r\n  audio.addEventListener(\"ratechange\", syncRateUI);\r\n  audio.addEventListener(\"ended\", () => { st.playing = false; syncButtons(); });\r\n  refAudio.addEventListener(\"loadedmetadata\", syncRefUI);\r\n  refAudio.addEventListener(\"ratechange\", syncRefUI);\r\n\r\n  // Shortcuts logic (unchanged)\r\n  window.addEventListener(\"keydown\", (e) => {\r\n    if (e.target.tagName === \"INPUT\" || e.target.tagName === \"TEXTAREA\" || e.target.isContentEditable) return;\r\n    if (e.code === \"Space\") { e.preventDefault(); ui.mainBtn.click(); }\r\n    else if (e.key === \",\") { e.preventDefault(); ui.backBtn.click(); }\r\n    else if (e.key === \".\") { e.preventDefault(); ui.fwdBtn.click(); }\r\n    else if (e.key === \"[\") { e.preventDefault(); api.setRate(api.clamp((audio.playbackRate || 1) - 0.05, 0.5, 1.5)); syncRateUI(); }\r\n    else if (e.key === \"]\") { e.preventDefault(); api.setRate(api.clamp((audio.playbackRate || 1) + 0.05, 0.5, 1.5)); syncRateUI(); }\r\n    else if (e.key.toLowerCase() === \"l\") { e.preventDefault(); ui.loopAction.click(); }\r\n  }, { passive: false });\r\n\r\n  initialSync();\r\n  window.LuxSelfPB = Object.assign(window.LuxSelfPB || {}, { el: ui.host });\r\n  console.info(\"[self-pb] WaveSurfer UI Mounted\");\r\n  function initialSync() { syncTime(); syncScrub(); syncButtons(); syncRefUI(); }\r\n}\r\n\r\nexport { mountSelfPlaybackLite as default };"],"names":["_a","LS_RATE","clamp","n","a","b","fmt","t","m","ensureLearnerAudioEl","audio","initSelfPBCore","refAudio","refMeta","st","savedRate","onTimeUpdate","api","v","url","audioEl","meta","e","arrBuf","blob","ensureStyles","STYLE_ID","s","buildUI","host","mountSelfPlaybackLite","ui","initWaveSurfer","showToast","msg","duration","showLoopHint","syncButtons","syncTime","syncScrub","dur","syncRateUI","syncRefUI","ready","r","d","handlePlayAction","isRestart","err","handleLoopClick","p","initialSync"],"mappings":"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"}