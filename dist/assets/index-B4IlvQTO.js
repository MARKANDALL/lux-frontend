function Ca(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();const Ia=["When the sunlight strikes raindrops in the air,","they act like a prism and form a rainbow.","The rainbow is a division of white light into many beautiful colors.","These take the shape of a long, round arch,","with its path high above, and its two ends apparently beyond the horizon.","There is, according to legend, a boiling pot of gold at one end.","People look, but no one ever finds it.","When a man looks for something beyond his reach, his friends say he is looking for the pot of gold at the end of the rainbow.","Others have tried to explain the phenomenon physically.","Aristotle thought that the rainbow was caused by reflection of the sun's rays by the rain.","Since then, physicists have found that it is not reflection, but refraction by the raindrops,","which causes the rainbows."],$a=["You wish to know all about my grandfather.","Well, he is nearly ninety-three years old, yet he still thinks as swiftly as ever.","He dresses himself in an old black frock coat, usually with several buttons missing.","A long beard clings to his chin, giving those who observe him a pronounced feeling of respect.","When he speaks, his voice is just a bit cracked and quivers a trifle.","Twice each day, he plays skillfully and with zest upon a small organ.","Except in the winter, when the snow or ice prevents, he slowly takes a short walk in the open air each day.","We have often urged him to walk more and smoke less, but he always answers, No, you see, I am quite well.","He likes to eat simple, wholesome food.","He enjoys his pipe and his daily walks.","Grandfather is a wonderful man."],ja=["light","right","glass","grass","collect","correct"],La=["sheep","ship","beat","bit","leave","live"],Na=["cap","cup","bat","but","bag","bug"],Ba=["three","think","this","street","spring","milk","world","advice","leaves","buzz"],Ua=["Larry rarely reads really large red books.","Three thin thieves thought they thrilled the throne.","Sue saw six slippery snakes sliding south."],Da=["Last Friday, Larry and Ruth went to a little park.","They saw three red birds, six green frogs, and a group of small sheep.","Larry thought the birds were really pretty, but Ruth liked the frogs best.","They laughed and talked until it got dark."],Xe={rainbow:{name:"Rainbow Passage",parts:Ia,youtubeId:"2Sf3vDdV2Ps",startAt:0},grandfather:{name:"Grandfather Passage",parts:$a,youtubeId:"vAMGh1YLgAE",startAt:0},minLR:{name:"Phoneme Test: L vs R",parts:ja},minEEIH:{name:"Phoneme Test: EE vs IH",parts:La},minAUAH:{name:"Phoneme Test: A vs U",parts:Na},wordList:{name:"Challenging Word List",parts:Ba},sentences:{name:"Challenging Sentences",parts:Ua},shortStory:{name:"Short Story Practice",parts:Da}},Ma={iy:"i",ih:"…™",eh:"…õ",ae:"√¶",aa:"…ë",ao:"…î",ah:" å",ax:"…ô",axr:"…ö",er:"…ù",uw:"u",uh:" ä",ey:"e…™",ay:"a…™",aw:"a ä",ow:"o ä",oy:"…î…™",schwa:"…ô",u_short:" ä",p:"p",b:"b",t:"t",d:"d",k:"k",g:"g",f:"f",v:"v",th:"Œ∏",dh:"√∞",s:"s",z:"z",sh:" É",zh:" í",h:"h",hh:"h",m:"m",n:"n",ng:"≈ã",l:"l",r:"…π",w:"w",y:"j",ch:"t É",jh:"d í",dx:"…æ",wh:" ç",q:" î",tÕ° É:"t É",dÕ° í:"d í", ß:"t É", §:"d í",≈ã:"≈ã",…π:"…π",…æ:"…æ", î:" î", ç:" ç",Œ∏:"Œ∏",√∞:"√∞", É:" É", í:" í",t É:"t É",d í:"d í",…≥:"…≥"},qa=/[\u0361\u035C\u200D\u034F]/g,is={ ß:"t É", §:"d í"};function Ue(t){if(!t)return t;let e=String(t).normalize("NFC").trim();return e&&(/^[A-Za-z0-9_-]+$/.test(e)&&(e=e.toLowerCase()),is[e]&&(e=is[e]),e=e.replace(/t[\u0361\u035C]? É/g,"t É").replace(/d[\u0361\u035C]? í/g,"d í"),e=e.replace(qa,""),Ma[e]||e)}const xt={r:{ipa:"…π",video:"https://video.wixstatic.com/video/0d5d6f_7d727f4cc0d54acfb98e40c828905f0b/720p/mp4/file.mp4"},dh:{ipa:"√∞",video:"https://video.wixstatic.com/video/0d5d6f_c0087bc4d2844ee78d209b004b9ac87d/720p/mp4/file.mp4"},th:{ipa:"Œ∏",video:"https://video.wixstatic.com/video/0d5d6f_a84f54cbcdc043dabb5677dd27293e0e/720p/mp4/file.mp4"},l:{ipa:"l",video:"https://video.wixstatic.com/video/0d5d6f_368f7009129f4458bb8093e43c710463/720p/mp4/file.mp4"},sh:{ipa:" É",video:"https://video.wixstatic.com/video/0d5d6f_4a4ea5cc1c7548739da1b6d8b0c11970/720p/mp4/file.mp4"},ae:{ipa:"√¶",video:"https://video.wixstatic.com/video/0d5d6f_86dfe7364dcf4c6aaea6418f245b203f/480p/mp4/file.mp4"},v:{ipa:"v",video:"https://video.wixstatic.com/video/0d5d6f_f2e53f03b6eb4f05b9c24aa3302b6a51/720p/mp4/file.mp4"},zh:{ipa:" í",video:"https://video.wixstatic.com/video/0d5d6f_b7941cad4a9f4ca985bb9e79cfa7c0ea/720p/mp4/file.mp4"},z:{ipa:"z",video:"https://video.wixstatic.com/video/0d5d6f_98738905164b417da9305818c866ccdf/720p/mp4/file.mp4"},…≥:{ipa:"…≥",video:"https://video.wixstatic.com/video/0d5d6f_fd6d5d0b30a14f5b8156276908f071d6/720p/mp4/file.mp4"},u_short:{ipa:" ä",video:"https://video.wixstatic.com/video/0d5d6f_d1f044e5eb254a858505df8cdc38cc6b/144p/mp4/file.mp4"},p:{ipa:"p",video:"https://video.wixstatic.com/video/0d5d6f_cd77a253e2044a2f97ae82820c2e7db1/720p/mp4/file.mp4"},b:{ipa:"b",video:"https://video.wixstatic.com/video/0d5d6f_427b1facf4f94387b044e38e24573fbb/720p/mp4/file.mp4"},t:{ipa:"t",video:"https://video.wixstatic.com/video/0d5d6f_1c0eedc2840f46faba1a7c81cb6ec2b3/720p/mp4/file.mp4"},d:{ipa:"d",video:"https://video.wixstatic.com/video/0d5d6f_18f272949b024ed8bb09c9f82571ca4f/720p/mp4/file.mp4"},k:{ipa:"k",video:"https://video.wixstatic.com/video/0d5d6f_6e534b826f76438b8849303a93e058be/720p/mp4/file.mp4"},g:{ipa:"g",video:"https://video.wixstatic.com/video/0d5d6f_7ddce2d0d737482fa021d4a5e08e6c83/720p/mp4/file.mp4"}, î:{ipa:" î",video:"https://video.wixstatic.com/video/0d5d6f_0738fc5a714b44528439e1ab67887525/720p/mp4/file.mp4"},i:{ipa:"i",video:"https://video.wixstatic.com/video/0d5d6f_7bfbbe6277e04dc9bf6b4c25b7085fc6/144p/mp4/file.mp4"},ih:{ipa:"…™",video:"https://video.wixstatic.com/video/0d5d6f_bcfcacac0c8341caa2131bade4621ee5/144p/mp4/file.mp4"},e:{ipa:"e",video:"https://video.wixstatic.com/video/0d5d6f_6fe00ec89935410d8ce645528186046c/144p/mp4/file.mp4"},schwa:{ipa:"…ô",video:"https://video.wixstatic.com/video/0d5d6f_b29663890f8e4d1aa96005c8e46bf497/144p/mp4/file.mp4"},eh:{ipa:"…õ",video:"https://video.wixstatic.com/video/0d5d6f_5753dd7d338b472a9c5e0b4009a90a44/144p/mp4/file.mp4"},uh:{ipa:" å",video:"https://video.wixstatic.com/video/0d5d6f_1602100a59d8495098039185c8fe09e6/144p/mp4/file.mp4"},u:{ipa:"u",video:"https://video.wixstatic.com/video/0d5d6f_a8aa8854bb3e4fccbc1e70a9e847d9b8/144p/mp4/file.mp4"},ah:{ipa:"…ë",video:"https://video.wixstatic.com/video/0d5d6f_16ba279a5bed4aa4a3ae915a0c708e98/144p/mp4/file.mp4"},aw:{ipa:"…î",video:"https://video.wixstatic.com/video/0d5d6f_dca89bb4ab2b409fad8e4b9fc97edd27/144p/mp4/file.mp4"},o:{ipa:"o",video:"https://video.wixstatic.com/video/0d5d6f_70ffa1aa7b914a1484fc27ff65180012/144p/mp4/file.mp4"},er:{ipa:"…ù",video:"https://video.wixstatic.com/video/0d5d6f_a4fd7aac7c27437fa0c9f70b243d0824/480p/mp4/file.mp4"},axr:{ipa:"…ö",video:"https://video.wixstatic.com/video/0d5d6f_4686a9b0407d4546b1c4fa746ade7392/480p/mp4/file.mp4"},e…™:{ipa:"e…™",video:"https://video.wixstatic.com/video/0d5d6f_c2d47dad0b3f470aa51768cd8f4dea74/480p/mp4/file.mp4"},a…™:{ipa:"a…™",video:"https://video.wixstatic.com/video/0d5d6f_dedfc9cb295c4ebb972acb13cfebdd1d/480p/mp4/file.mp4"},…î…™:{ipa:"…î…™",video:"https://video.wixstatic.com/video/0d5d6f_afc6389fce44476a921b4eee252726fa/480p/mp4/file.mp4"},a ä:{ipa:"a ä",video:"https://video.wixstatic.com/video/0d5d6f_a4ed3fe3131e4d658be6bf6fad23ea4d/480p/mp4/file.mp4"},o ä:{ipa:"o ä",video:"https://video.wixstatic.com/video/0d5d6f_7ccc4f3663c84a409f4b9ec41324e9ac/480p/mp4/file.mp4"},m:{ipa:"m",video:"https://video.wixstatic.com/video/0d5d6f_7ee24079934f49c99418747c7fb9b291/720p/mp4/file.mp4"},n:{ipa:"n",video:"https://video.wixstatic.com/video/0d5d6f_cc606e7ffbd94b45b34f086802771210/720p/mp4/file.mp4"},≈ã:{ipa:"≈ã",video:"https://video.wixstatic.com/video/0d5d6f_3a8df55492824f7abfaf245c40bf9982/720p/mp4/file.mp4"},f:{ipa:"f",video:"https://video.wixstatic.com/video/0d5d6f_c14cb7ce09204f4b9e3476e1bb39e0b6/720p/mp4/file.mp4"},s:{ipa:"s",video:"https://video.wixstatic.com/video/0d5d6f_1a60932597874db19eda4c5c69191826/720p/mp4/file.mp4"},h:{ipa:"h",video:"https://video.wixstatic.com/video/0d5d6f_eec4d7bd4500484a857a1ffeaeb2ab5b/720p/mp4/file.mp4"},t É:{ipa:"t É",video:"https://video.wixstatic.com/video/0d5d6f_ad3b6fb26e7d46fab857862c3de1d752/720p/mp4/file.mp4"},d í:{ipa:"d í",video:"https://video.wixstatic.com/video/0d5d6f_805a57c5fdbc48eab56188314951b385/720p/mp4/file.mp4"},w:{ipa:"w",video:"https://video.wixstatic.com/video/0d5d6f_9532587ba76245ae86301b2734b632dd/720p/mp4/file.mp4"},j:{ipa:"j",video:"https://video.wixstatic.com/video/0d5d6f_9e45cb00760e4d4d8b8236ea8b61b1c9/720p/mp4/file.mp4"}, ç:{ipa:" ç",video:"https://video.wixstatic.com/video/0d5d6f_5e09d71fb68e494480d5122d722a0e02/720p/mp4/file.mp4"},…æ:{ipa:"…æ",video:"https://video.wixstatic.com/video/0d5d6f_2e1b9a5fd9e14b40975a59ce641c6925/720p/mp4/file.mp4"}};function J(t,e){!xt[t]&&xt[e]&&(xt[t]=xt[e])}J("iy","i");J("ax","schwa");J("uw","u");J("aa","ah");J("ao","aw");J("ey","e…™");J("ay","a…™");J("oy","…î…™");J("ow","o ä");J("ng","≈ã");J("ch","t É");J("jh","d í");J("dx","…æ");J("wh"," ç");J("q"," î");J("y","j");J("…π","r");J("Œ∏","th");J("√∞","dh");const Ge=Object.create(null);Object.values(xt).forEach(t=>{if(!(t!=null&&t.ipa)||!(t!=null&&t.video))return;const e=Ue(t.ipa);Ge[e]||(Ge[e]={ipa:e,video:t.video})});var yi;!Ge.…ö&&((yi=Ge.…π)!=null&&yi.video)&&(Ge.…ö={ipa:"…ö",video:Ge.…π.video});function _i(t){return Ge[Ue(t)]||null}const P={p:{label:"P (no voice) ‚Äî lips stop, then pop open",example:"pie",tip:"Close your lips tightly, build a small puff of air, then release. Keep your throat quiet (no buzzing)."},b:{label:"B (voice on) ‚Äî lips stop, then pop open",example:"buy",tip:"Close your lips, turn your voice on (feel a gentle throat buzz), then release the lips."},t:{label:"T (no voice) ‚Äî tongue tap behind top teeth",example:"tea",tip:"Touch the tip of your tongue to the gum ridge just behind your upper front teeth. Hold air briefly, then release with no throat buzz."},d:{label:"D (voice on) ‚Äî tongue tap behind top teeth",example:"do",tip:"Touch the tongue tip to the gum ridge behind your upper front teeth, keep your voice on (throat buzz), then release."},k:{label:"K (no voice) ‚Äî back of tongue blocks, then releases",example:"cat",tip:"Lift the back of your tongue to touch the soft palate (back of the roof of your mouth). Release with a clean burst of air and no throat buzz."},g:{label:"G (voice on) ‚Äî back of tongue blocks, then releases",example:"go",tip:"Lift the back of your tongue to the soft palate, keep your voice on (throat buzz), then release."},m:{label:"M (voice on) ‚Äî lips closed, air through nose",example:"me",tip:"Close your lips and let the sound come out through your nose. Keep your voice on (gentle throat buzz)."},n:{label:"N (voice on) ‚Äî tongue behind top teeth, air through nose",example:"no",tip:"Touch the tongue tip to the gum ridge behind your upper front teeth and let air flow through your nose while voicing."},≈ã:{label:"NG (voice on) ‚Äî back of tongue, air through nose",example:"sing",tip:"Raise the back of your tongue (as for /k/ or /g/) and let the sound come out through your nose. Keep voicing on."},f:{label:"F (no voice) ‚Äî teeth on lip, steady air",example:"fine",tip:"Rest your top teeth gently on your bottom lip and blow air steadily. No throat buzz."},v:{label:"V (voice on) ‚Äî teeth on lip, steady air",example:"vine",tip:"Top teeth lightly on bottom lip, blow air steadily, and keep your voice on (throat buzz)."},Œ∏:{label:"TH (no voice) ‚Äî tongue lightly at the teeth",example:"think",tip:"Place your tongue tip lightly between your teeth (or just behind the top teeth) and let air hiss through. No throat buzz."},√∞:{label:"TH (voice on) ‚Äî tongue lightly at the teeth",example:"this",tip:"Place your tongue tip lightly between your teeth (or just behind the top teeth), let air pass through, and keep your voice on (throat buzz)."},s:{label:"S (no voice) ‚Äî narrow air stream at the front",example:"see",tip:"Keep your tongue close to the front roof of your mouth (behind upper teeth) and blow a thin stream of air through the middle. No throat buzz."},z:{label:"Z (voice on) ‚Äî narrow air stream at the front",example:"zoo",tip:"Make the same narrow air stream as /s/, but keep your voice on (throat buzz)."}, É:{label:"SH (no voice) ‚Äî rounded lips, air over a slightly back tongue",example:"shoe",tip:"Round your lips slightly and pull your tongue a little farther back than /s/. Let air flow steadily with no throat buzz."}, í:{label:"ZH (voice on) ‚Äî like ‚Äúmeasure‚Äù sound",example:"measure",tip:"Shape your mouth like / É/ (slight lip rounding, tongue a bit back) but keep your voice on (throat buzz)."},h:{label:"H (no voice) ‚Äî open mouth breath sound",example:"he",tip:"Open your mouth and breathe out smoothly, as if fogging a window‚Äîno tongue or lip contact needed."},t É:{label:"CH (no voice) ‚Äî stop + quick ‚Äúsh‚Äù release",example:"chair",tip:"Make a quick tongue stop behind the upper teeth, then immediately release into a ‚Äúsh‚Äù-like airflow, all as one sound. No throat buzz."},d í:{label:"J (voice on) ‚Äî stop + quick ‚Äúzh‚Äù release",example:"judge",tip:"Make a quick tongue stop behind the upper teeth, then release into the ‚Äúmeasure‚Äù ( í) type airflow while keeping your voice on."},…π:{label:"R (voice on) ‚Äî tongue lifted but not touching",example:"red",tip:"Lift and bunch your tongue slightly back in the mouth without touching the roof. Keep your voice on and avoid friction."},l:{label:"L (voice on) ‚Äî tongue tip up, air flows around sides",example:"let",tip:"Touch your tongue tip to the gum ridge behind the upper teeth. Keep voicing on and let air escape around the sides of the tongue."},w:{label:"W (voice on) ‚Äî rounded lips, quick glide",example:"we",tip:"Round your lips and move quickly into the next vowel while keeping your voice on."},j:{label:"Y (voice on) ‚Äî quick ‚Äúee‚Äù-like glide",example:"yes",tip:"Lift the front of your tongue toward the hard palate (like the start of ‚Äúee‚Äù) and glide into the next vowel with voicing on."},…æ:{label:"Fast T/D tap (voice on) ‚Äî quick tongue flick",example:"water (American)",tip:"Keep voicing on and flick the tongue tip quickly against the gum ridge behind the upper teeth. It‚Äôs a very fast, light contact."}, î:{label:"Throat stop ‚Äî tiny pause in airflow",example:"uh-oh",tip:"Briefly close your vocal folds to stop the air for a moment, then release. It feels like a tiny catch in your throat."}, ç:{label:"Breathy W (no voice) ‚Äî ‚Äúwhich‚Äù (for some speakers)",example:"which",tip:"Round your lips like /w/, but keep your voice off and push air through. It‚Äôs a breathy, whispered W."},…≥:{label:"N with tongue curled back (not common in English)",example:"‚Äî",tip:"Curl the tongue tip slightly back (a retroflex shape) and let the sound come out through the nose while voicing. This sound is mainly used in some languages other than English."},i:{label:"EE vowel ‚Äî steady, smile-like",example:"see",tip:"Spread your lips slightly (like a small smile) and raise the front of your tongue high. Hold the vowel steady."},…™:{label:"IH vowel ‚Äî relaxed, shorter",example:"sit",tip:"Keep the tongue high-front but a little lower and more relaxed than /i/. Lips relaxed; vowel is usually shorter."},e:{label:"AY start vowel ‚Äî the start of ‚Äúday‚Äù",example:"day (start)",tip:"Raise the front of your tongue to a mid-high position. Lips neutral. (In many accents, this vowel quickly glides into /…™/.)"},…õ:{label:"EH vowel ‚Äî open-mid front",example:"bed",tip:"Open your mouth a bit more and keep the tongue mid-front. Lips neutral."},√¶:{label:"A vowel ‚Äî wide mouth, low-front",example:"cat",tip:"Drop your jaw and keep the tongue low and forward. Lips neutral to slightly spread."},…ë:{label:"AH vowel ‚Äî open, back",example:"father",tip:"Open the mouth wide. Keep the tongue low and back. Lips relaxed (not rounded)."},…î:{label:"AW vowel ‚Äî back + rounded lips",example:"thought",tip:"Round your lips and keep the tongue back with a medium-open jaw. (Some speakers merge this with /…ë/.)"},o:{label:"OH start vowel ‚Äî the start of ‚Äúgo‚Äù",example:"go (start)",tip:"Round your lips and keep the tongue mid-back. (In many accents, this vowel quickly glides toward / ä/.)"}, ä:{label:"Short OO vowel ‚Äî like ‚Äúbook‚Äù",example:"book",tip:"Loosely round your lips and keep the tongue high-back but relaxed. Keep it short."},u:{label:"OO vowel ‚Äî like ‚Äúfood‚Äù",example:"food",tip:"Round your lips more firmly and raise the tongue high-back. Hold the vowel steady."}, å:{label:"UH vowel ‚Äî like ‚Äúcup‚Äù",example:"cup",tip:"Keep lips relaxed and the tongue in a central-to-back, mid position. Jaw moderately open."},…ô:{label:"Schwa ‚Äî quick, relaxed ‚Äúuh‚Äù in unstressed syllables",example:"about (first ‚Äúa‚Äù)",tip:"Relax your mouth and tongue. Make a very short, neutral ‚Äúuh‚Äù sound‚Äîusually only in unstressed syllables."},…ù:{label:"Stressed ER ‚Äî like ‚Äúbird‚Äù",example:"bird",tip:"Keep your tongue in an R-shaped position (bunched or slightly curled back) while voicing the vowel. Hold it steady."},…ö:{label:"Unstressed ER ‚Äî like the end of ‚Äúteacher‚Äù",example:"teacher (end)",tip:"Use the same R-shaped tongue as /…ù/, but make it shorter and unstressed."},e…™:{label:"AY diphthong ‚Äî ‚Äúday‚Äù",example:"day",tip:"Start with the ‚Äúday-start‚Äù vowel and glide upward toward a short /…™/. The movement is smooth and quick."},a…™:{label:"I diphthong ‚Äî ‚Äúmy‚Äù",example:"my",tip:"Start with an open mouth and then glide up toward /…™/ as the mouth narrows slightly."},…î…™:{label:"OY diphthong ‚Äî ‚Äúboy‚Äù",example:"boy",tip:"Start with rounded lips and a back vowel feeling, then glide to /…™/ as the lips spread a bit."},a ä:{label:"OW diphthong ‚Äî ‚Äúnow‚Äù",example:"now",tip:"Start open and unrounded, then glide toward / ä/ with more lip rounding near the end."},o ä:{label:"OH diphthong ‚Äî ‚Äúgo‚Äù",example:"go",tip:"Start with rounded ‚Äúgo-start‚Äù vowel and glide toward / ä/. Keep the motion smooth."}};(()=>{const t=P;[["tÕ° É","t É"],["dÕ° í","d í"],[" ß","t É"],[" §","d í"]].forEach(([e,r])=>{t[e]&&!t[r]&&(t[r]=t[e]),t[r]&&!t[e]&&(t[e]=t[r])})})();const Fa={p:{tip:P.p.tip,mistake:"Often loses the little puff and sounds too soft.",ipa:"/p/ (pie)"},b:{tip:P.b.tip,mistake:"Often loses voicing and sounds like /p/.",ipa:"/b/ (buy)"},t:{tip:P.t.tip,mistake:"May sound too weak or turn into a tap in casual speech.",ipa:"/t/ (tea)"},d:{tip:P.d.tip,mistake:"May lose voicing and sound like /t/.",ipa:"/d/ (do)"},k:{tip:P.k.tip,mistake:"May be too far forward and sound like /t/.",ipa:"/k/ (cat)"},g:{tip:P.g.tip,mistake:"May lose voicing and sound like /k/.",ipa:"/g/ (go)"},m:{tip:P.m.tip,mistake:"Nasal airflow gets blocked (turns into /b/).",ipa:"/m/ (me)"},n:{tip:P.n.tip,mistake:"Tongue placement drifts and it becomes /≈ã/ in the wrong places.",ipa:"/n/ (no)"},≈ã:{tip:P.≈ã.tip,mistake:"Added extra /g/ sound (‚Äúsing-guh‚Äù).",ipa:"/≈ã/ (sing)"},f:{tip:P.f.tip,mistake:"Airflow too weak; turns into /p/ or /h/.",ipa:"/f/ (fine)"},v:{tip:P.v.tip,mistake:"Loses voicing and becomes /f/.",ipa:"/v/ (vine)"},Œ∏:{tip:P.Œ∏.tip,mistake:"Tongue stays inside; it becomes /t/ or /s/.",ipa:"/Œ∏/ (think)"},√∞:{tip:P.√∞.tip,mistake:"Tongue stays inside; it becomes /d/ or /z/.",ipa:"/√∞/ (this)"},s:{tip:P.s.tip,mistake:"Becomes voiced /z/ when it should be unvoiced.",ipa:"/s/ (see)"},z:{tip:P.z.tip,mistake:"Loses voicing and becomes /s/.",ipa:"/z/ (zoo)"}, É:{tip:P. É.tip,mistake:"Tongue too far forward; sounds like /s/.",ipa:"/ É/ (shoe)"}, í:{tip:P. í.tip,mistake:"Loses voicing and becomes / É/.",ipa:"/ í/ (measure)"},h:{tip:P.h.tip,mistake:"Gets dropped entirely at the start of words.",ipa:"/h/ (he)"},t É:{tip:P.t É.tip,mistake:"Missing the stop part; turns into / É/.",ipa:"/t É/ (chair)"},d í:{tip:P.d í.tip,mistake:"Missing the stop part; turns into / í/.",ipa:"/d í/ (judge)"},…π:{tip:P.…π.tip,mistake:"Tongue touches the roof (creates friction) or becomes a tap/trill.",ipa:"/…π/ (red)"},l:{tip:P.l.tip,mistake:"Tongue tip doesn‚Äôt lift; vowel takes over and /l/ disappears.",ipa:"/l/ (let)"},w:{tip:P.w.tip,mistake:"Lip rounding is missing; sounds like /v/ or a plain vowel.",ipa:"/w/ (we)"},j:{tip:P.j.tip,mistake:"Glide is too weak and disappears.",ipa:"/j/ (yes)"},…æ:{tip:P.…æ.tip,mistake:"Held too long and sounds like /d/.",ipa:"/…æ/ (water, AmE)"}, î:{tip:P. î.tip,mistake:"Used too often where a clear /t/ is expected.",ipa:"/ î/ (uh-oh)"}, ç:{tip:P. ç.tip,mistake:"Becomes voiced /w/ (many accents do this; it‚Äôs not always wrong).",ipa:"/ ç/ (which, some speakers)"},…≥:{tip:P.…≥.tip,mistake:"Tongue is not curled back enough; it becomes /n/.",ipa:"/…≥/ (non-English in many cases)"},i:{tip:P.i.tip,mistake:"Becomes too relaxed and shifts toward /…™/.",ipa:"/i/ (see)"},…™:{tip:P.…™.tip,mistake:"Too tense and becomes /i/.",ipa:"/…™/ (sit)"},e:{tip:P.e.tip,mistake:"Glide is missing; can sound flat or too open.",ipa:"/e/ (day-start)"},…õ:{tip:P.…õ.tip,mistake:"Jaw too open and drifts toward /√¶/.",ipa:"/…õ/ (bed)"},√¶:{tip:P.√¶.tip,mistake:"Too closed; drifts toward /…õ/.",ipa:"/√¶/ (cat)"},…ë:{tip:P.…ë.tip,mistake:"Lips round too much; drifts toward /…î/.",ipa:"/…ë/ (father)"},…î:{tip:P.…î.tip,mistake:"Often merges with /…ë/ depending on accent.",ipa:"/…î/ (thought)"},o:{tip:P.o.tip,mistake:"Glide is missing; can sound flat.",ipa:"/o/ (go-start)"}, ä:{tip:P. ä.tip,mistake:"Becomes too tense and turns into /u/.",ipa:"/ ä/ (book)"},u:{tip:P.u.tip,mistake:"Tongue too low; sounds like / ä/.",ipa:"/u/ (food)"}, å:{tip:P. å.tip,mistake:"Turns into schwa /…ô/ when stressed.",ipa:"/ å/ (cup)"},…ô:{tip:P.…ô.tip,mistake:"Made too long or too strong (schwa should be quick).",ipa:"/…ô/ (about)"},…ù:{tip:P.…ù.tip,mistake:"R-color is missing; sounds like a plain vowel.",ipa:"/…ù/ (bird)"},…ö:{tip:P.…ö.tip,mistake:"R-color is missing; becomes plain schwa.",ipa:"/…ö/ (teacher, end)"},e…™:{tip:P.e…™.tip,mistake:"Glide is missing; can sound too short.",ipa:"/e…™/ (day)"},a…™:{tip:P.a…™.tip,mistake:"Doesn‚Äôt rise enough; sounds too flat.",ipa:"/a…™/ (my)"},…î…™:{tip:P.…î…™.tip,mistake:"Glide is weak; sounds like a plain vowel.",ipa:"/…î…™/ (boy)"},a ä:{tip:P.a ä.tip,mistake:"Second part is too tense and becomes /u/.",ipa:"/a ä/ (now)"},o ä:{tip:P.o ä.tip,mistake:"Glide is missing; sounds too flat.",ipa:"/o ä/ (go)"}},Ln=Object.create(null);Object.entries(Fa).forEach(([t,e])=>{Ln[Ue(t)]=e});var bi,vi;if(typeof window<"u"){const e=new URLSearchParams(window.location.search).has("luxdebug")||window.localStorage.getItem("luxdebug")==="1";window.LUX_DEBUG=!!((vi=(bi=import.meta)==null?void 0:bi.env)!=null&&vi.DEV&&e),window.luxDbg=function(r,n){if(!window.LUX_DEBUG)return;const s=new Date().toISOString().split("T")[1].slice(0,8);console.log(`[LUX ${s}] ${r}`,n??"")}}const Ft=(t,e)=>typeof window<"u"&&typeof window.luxDbg=="function"&&window.luxDbg(t,e),Ha="custom";let Qe=Ha;var wi;let H=Qe==="custom"?[""]:((wi=Xe[Qe])==null?void 0:wi.parts)||[],Q=0,xi=[],be=Qe==="custom",Mr=null;const Wa=(t,e=document)=>e.querySelector(t);function za(t){be=!!t,Ft("state:setCustom",{isCustom:be})}function Va(t){Qe=t,Ft("state:setPassageKey",{currentPassageKey:Qe})}function br(t){H=t||[],Ft("state:setParts",{partsLen:H.length})}function sn(t){Q=t|0,Ft("state:setPartIdx",{currentPartIdx:Q})}function Ka(t,e){var r,n;xi[t]=e,Ft("state:pushPartResult",{idx:t,score:(n=(r=e==null?void 0:e.NBest)==null?void 0:r[0])==null?void 0:n.AccuracyScore})}function Ga(){const t=Wa("#l1Select"),e=((t==null?void 0:t.value)||"").trim();return e===""?"universal":e}function Ja(){return Mr||(Mr=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)),Mr}const jt="[LUX]";function Ya(t,e){console.log(`${jt} ${t}`)}function Si(t,e){e!==void 0?console.error(`${jt} error: ${t}`,e):console.error(`${jt} error: ${t}`)}function Nn(t,e){e!==void 0?console.debug(`${jt} ${t}`,e):console.debug(`${jt} ${t}`)}function ae(t){return document.querySelector(t)}function Bn(t,e){t&&(t.textContent=e)}function Tt(t,e){t&&(t.style.display=e?"":"none")}const A={get select(){return ae("#passageSelect")},get input(){return ae("#referenceText")},get suggested(){return ae("#suggestedSentence")},get progress(){return ae("#partProgress")},get label(){return ae("#passageLabel")},get nextBtn(){return ae("#nextPartBtn")},get nextMsg(){return ae("#nextPartMsg")},get summaryBtn(){return ae("#showSummaryBtn")},get tip(){return ae("#partsInfoTip")},get tipText(){return ae("#partsInfoTip .tooltiptext")},get pretty(){return ae("#prettyResult")},get status(){return ae("#status")},get aiBox(){return ae("#aiFeedback")},get showMore(){return ae("#showMoreBtn")}};function Xa(){var t;return((t=A.select)==null?void 0:t.value)||""}function Ei(){var t;return((t=A.input)==null?void 0:t.value)||""}function Qa(){var r,n,s,i;const t=((r=A.select)==null?void 0:r.value)||"",e=((i=(s=(n=A.select)==null?void 0:n.selectedOptions)==null?void 0:s[0])==null?void 0:i.textContent)||"";return t==="custom"||/write.*own/i.test(e)}function Za(){A.select&&(A.select.value="custom")}function el({visible:t,textHTML:e}){const r=A.tip;r&&(t?(r.classList.remove("hidden"),A.tipText&&(A.tipText.innerHTML=e)):r.classList.add("hidden"))}function on({text:t,progressText:e,labelText:r,showLabel:n,preserveInput:s}){A.suggested&&(A.suggested.textContent=t),A.input&&!s&&(A.input.value=t),A.progress&&(A.progress.textContent=e),A.label&&(Tt(A.label,n),Bn(A.label,r))}function At({showNext:t,enableNext:e,nextMsgText:r,nextMsgColor:n,showSummary:s,customMode:i}){A.nextBtn&&(Tt(A.nextBtn,t),A.nextBtn.disabled=!e,i?(A.nextBtn.textContent="‚ûï Add Another Section",A.nextBtn.style.backgroundColor="#0f766e"):(A.nextBtn.textContent="Next Part",A.nextBtn.style.backgroundColor="")),A.nextMsg&&(Bn(A.nextMsg,r),Tt(A.nextMsg,!!r),n&&(A.nextMsg.style.color=n),r&&(A.nextMsg.style.display="inline-block",A.nextMsg.style.marginLeft="10px")),A.summaryBtn&&s!==void 0&&(Tt(A.summaryBtn,s),A.summaryBtn.disabled=!s,i?A.summaryBtn.textContent="Finish & View Summary":A.summaryBtn.textContent="Show Summary")}function an(){A.pretty&&(A.pretty.innerHTML=""),A.status&&(A.status.textContent="Not recording"),A.aiBox&&(A.aiBox.style.display="none",A.aiBox.innerHTML=""),Tt(A.showMore,!1)}function tl({onChange:t,onClick:e}){A.select&&(A.select.addEventListener("change",r=>t(r.target.value)),A.select.addEventListener("click",e))}function rl({onInput:t}){A.input&&A.input.addEventListener("input",e=>t(e.target.value))}function nl(t){A.nextBtn&&A.nextBtn.addEventListener("click",t)}let ce=null,G=null,Ne=null,Be=null;function sl(){if(!ce){if(!document.querySelector('link[href*="balloon.css"]')){const t=document.createElement("link");t.rel="stylesheet",t.href="./features/balloon/balloon.css",document.head.appendChild(t)}ce=document.createElement("div"),ce.id="lux-balloon-wrapper",G=document.createElement("div"),G.id="lux-balloon",G.title="Click to Pop!",G.addEventListener("click",ki),Ne=document.createElement("div"),Ne.id="lux-balloon-core",G.appendChild(Ne),Be=document.createElement("div"),Be.id="lux-balloon-tip",ce.appendChild(G),ce.appendChild(Be),document.body.appendChild(ce)}}function il(t,e){sl(),ce.style.display="block";const r=e||1,n=Math.min(Math.max(t,0)/r,1),s=1+n*1.2,i=parseFloat(getComputedStyle(G).getPropertyValue("--scale"))||1,o=Math.abs(s-i),a=Math.min(1.4,Math.max(.65,.55+o*.9)),c=`${Math.min(1.8,a*1.3).toFixed(2)}s`;G.style.setProperty("--inflateDur",c),G.style.setProperty("--scale-prev",i.toFixed(3)),G.style.setProperty("--scale",s.toFixed(3)),G.classList.remove("lux-balloon-inflating"),G.offsetWidth,G.classList.add("lux-balloon-inflating"),ce.style.transitionDuration=c;const u=40+n*60;ce.style.bottom=`${u}px`,Ne&&(Ne.style.transitionDuration=c);const d=25+n*35;if(Ne&&(Ne.style.backgroundColor=`hsl(0, 90%, ${d}%)`),n>=1)Be.textContent="Full! Click to Pop üìå";else{const f=e===15;Be.textContent=f?`${t}/${e} parts`:`Part ${t+1} of ${e}`}}function ki(){if(!G||!ce)return;G.classList.remove("lux-balloon-inflating"),G.style.transition="transform 0.05s",G.style.transform="scale(1.5)",setTimeout(()=>{G.style.opacity="0",Be&&(Be.style.opacity="0")},50);const t=["#ef4444","#3b82f6","#10b981","#f59e0b","#8b5cf6"];for(let e=0;e<50;e++){const r=document.createElement("div");r.className="lux-confetti";const n=(Math.random()-.5)*300;r.style.setProperty("--x-mid",n*.5+"px"),r.style.setProperty("--x-end",n+"px");const s=-(80+Math.random()*150)+"px";r.style.setProperty("--y-up",s),r.style.backgroundColor=t[Math.floor(Math.random()*t.length)];const i=1+Math.random()*.8;r.style.animation=`confettiFall ${i}s forwards`,ce.appendChild(r)}setTimeout(()=>{ce&&ce.remove(),ce=null,G=null,Ne=null,Be=null},2500)}function Pt(t,e){il(t,e)}function ol(){ki()}const os={curated:`These built-in texts were designed to cover most English sounds. 
Practicing them gives a balanced baseline and helps reveal strengths & weaknesses.`,custom:`Type anything you want to practice. We‚Äôll score words & phonemes and add prosody feedback. 
Tip: shorter sentences (‚âà10‚Äì15 s) give the clearest results.`},Lt=15;function al(){return typeof be=="boolean"?be:Qa()}function ln(){const t=!!Ei().trim(),e=!!Xa(),r=al();el({visible:t||e,textHTML:r?os.custom:os.curated})}function cn(t){const e=Array.isArray(H)?H.length:0;if(!(t&&e>1)&&!be){At({showNext:!1,enableNext:!1,nextMsgText:"",showSummary:!0});return}const n=Q>=e-1;At({showNext:!n,enableNext:!n,nextMsgText:n?"":"Record to continue.",nextMsgColor:"#666",showSummary:!1})}function Nt({preserveExistingInput:t=!1}={}){var r;const e=Array.isArray(H)?H.length:0;if(be){const n=(H==null?void 0:H[Q])??"";on({text:n,progressText:`Custom Part ${Q+1}`,labelText:"Your text:",showLabel:!0,preserveInput:t}),Pt(H.length,Lt),cn(!1)}else{const n=H[Q],s=((r=Xe[Qe])==null?void 0:r.name)||"Passage";on({text:n,progressText:`Part ${Q+1} of ${e}`,labelText:`${s}:`,showLabel:Q===0,preserveInput:!1}),Pt(Q,e),cn(e>1)}}function as(t,{clearInputForCustom:e=!1}={}){var r;if(za(t==="custom"),Va(t),sn(0),be){const n=e?"":Ei();br([n]),Nt({preserveExistingInput:!e})}else{const n=((r=Xe[t])==null?void 0:r.parts)||[];br(n),Nt()}an()}function ll(){if(be){if(H.length>=Lt){alert(`Memory Full! You have reached the limit of ${Lt} recordings. Please view your summary now.`);return}const t=[...H,""];br(t),sn(Q+1),Nt({preserveExistingInput:!1}),an();const e=document.querySelector("#referenceText");e&&e.focus();return}Q<H.length-1&&(sn(Q+1),Nt(),an())}function cl(){const t=Array.isArray(H)?H.length:0;if(be){const r=H.length>=Lt;At({showNext:!r,enableNext:!r,nextMsgText:r?"Memory Full (Limit 15)":"",nextMsgColor:r?"#ef4444":"",showSummary:!0,customMode:!0}),Pt(H.length,Lt);return}if(t<=1)return;Q>=t-1?(At({showNext:!1,enableNext:!1,nextMsgText:"",showSummary:!0}),Pt(t,t)):(At({showNext:!0,enableNext:!0,nextMsgText:"Finished: Ready for your next one?",nextMsgColor:"#15803d",showSummary:!1}),Pt(Q+1,t))}function ul(){tl({onChange:e=>{as(e,{clearInputForCustom:e==="custom"}),ln()},onClick:()=>{var n;const e=document.querySelector("#suggestedSentence");!((n=e==null?void 0:e.textContent)!=null&&n.trim())&&!be&&Nt()}}),rl({onInput:e=>{be||(Za(),as("custom",{clearInputForCustom:!1}));const r=[...H];r[Q]=e,br(r),on({text:"",progressText:`Custom Part ${Q+1}`,labelText:"Your text:",showLabel:!0,preserveInput:!0}),ln()}});const t=document.getElementById("showSummaryBtn");t&&t.addEventListener("click",()=>{ol()})}function dl(){nl(ll);const t=Array.isArray(H)?H.length:0;cn(t>1),ln()}const lt={get textarea(){return document.querySelector("#referenceText")},get recordBtn(){return document.querySelector("#record")},get stopBtn(){return document.querySelector("#stop")},get status(){return document.querySelector("#status")}};function Oe(t){lt.status&&Bn(lt.status,t),Ya(t)}function Re(t){const{recordBtn:e,stopBtn:r}=lt;!e||!r||(t==="recording"?(e.disabled=!0,e.classList.add("record-intro","record-glow"),r.disabled=!1,r.classList.add("is-armed")):t==="processing"?(e.disabled=!1,e.classList.remove("record-intro","record-glow"),r.disabled=!0,r.classList.add("processing")):(e.disabled=!1,e.classList.remove("record-intro","record-glow"),r.disabled=!0,r.classList.remove("is-armed","processing")))}function hl({onRecord:t,onStop:e}){const{recordBtn:r,stopBtn:n}=lt;return!r||!n?(console.warn("[LUX] Recorder buttons missing from DOM"),!1):(r.addEventListener("click",s=>{s.preventDefault(),t()}),n.addEventListener("click",s=>{s.preventDefault(),e()}),!0)}let Je=null,qr=[];async function fl(t){try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});return Je=new MediaRecorder(e),qr=[],Je.ondataavailable=r=>{r.data.size>0&&qr.push(r.data)},Je.onstop=()=>{e.getTracks().forEach(n=>n.stop());const r=new Blob(qr,{type:"audio/webm"});t&&t(r)},Je.start(),!0}catch(e){return Si("Mic access failed",e),!1}}function ls(){Je&&Je.state==="recording"&&Je.stop()}const pl="https://luxury-language-api.vercel.app",ht=globalThis.API_BASE||void 0||pl;function ct(...t){(globalThis==null?void 0:globalThis.__DEBUG_AI)===!0&&console.log("[AI]",...t)}async function Ht(t){const e=await t.text();let r=null;try{r=e?JSON.parse(e):null}catch{const n=(e==null?void 0:e.slice(0,200))||"(empty)",s=new Error(`Bad JSON (${t.status}): ${n}`);throw s.status=t.status,s}if(!t.ok){const n=r&&(r.error||r.message)||t.statusText||"Request failed",s=new Error(n);throw s.status=t.status,s.body=r,s}return r}const Fr=`${ht}/api/assess`;async function gl({audioBlob:t,text:e,firstLang:r}){const n=(e??"").trim(),s=(t==null?void 0:t.size)??0;if(!t||s===0)return ct("SKIP",Fr,{reason:"no_audio",textLen:n.length}),null;const i=new FormData;i.append("audio",t,"recording.webm"),i.append("text",n),r&&i.append("firstLang",r),ct("POST",Fr,{audioBytes:s,textLen:n.length,firstLang:r});const o=await fetch(Fr,{method:"POST",body:i});return Ht(o)}const cs=`${ht}/api/pronunciation-gpt`;async function Ti({referenceText:t,azureResult:e,firstLang:r="universal",mode:n="detailed",chunk:s=1,persona:i="tutor"}){const o={referenceText:t,azureResult:e,firstLang:r,mode:n,chunk:s,persona:i};ct("POST",cs,{firstLang:r,mode:n,chunk:s,persona:i});const a=await fetch(cs,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return Ht(a)}const us=`${ht}/api/attempt`,ml=`${ht}/api/user-recent`,ds=`${ht}/api/update-attempt`;async function yl({uid:t,passageKey:e,partIndex:r,text:n,azureResult:s,l1:i,sessionId:o,localTime:a}){const l={uid:t,passageKey:e,partIndex:r,text:n,azureResult:s,l1:i,sessionId:o,localTime:a};ct("POST",us,{uid:t,passageKey:e,partIndex:r,l1:i});const c=await fetch(us,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});return Ht(c)}async function Un(t){if(!t)throw new Error("fetchHistory: UID is required");const e=`${ml}?uid=${encodeURIComponent(t)}`;ct("GET",e);const r=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}});return(await Ht(r)).rows||[]}async function bl(t,e){if(!t){console.warn("updateAttempt: No ID provided, cannot save.");return}const r={id:t,ai_feedback:e};ct("POST",ds,r);try{const n=await fetch(ds,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return Ht(n)}catch(n){console.error("Failed to update attempt:",n)}}const hs="LUX_USER_ID";function vl(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const t=[],e="0123456789abcdef";for(let r=0;r<36;r++)t[r]=e[Math.floor(Math.random()*16)];return t[14]="4",t[19]=e[parseInt(t[19],16)&3|8],t[8]=t[13]=t[18]=t[23]="-",t.join("")}function fs(t){return typeof t=="string"&&(/^[0-9a-f-]{18,}$/i.test(t)||t.length>=6)}function Ir(){if(typeof window>"u")return null;const e=(new URLSearchParams(location.search).get("uid")||"").trim(),r=window.LUX_USER_ID||localStorage.getItem(hs)||"",n=fs(e)?e:fs(r)?r:vl();window.LUX_USER_ID=n;try{localStorage.setItem(hs,n)}catch{}return document.documentElement.setAttribute("data-uid",n),n}function ps(){return typeof window<"u"&&window.LUX_USER_ID?window.LUX_USER_ID:Ir()}function wl(t){var l;const e=(l=t==null?void 0:t.NBest)==null?void 0:l[0];if(!e||!(t.DisplayText||e.Display||"").trim())return!1;const n=Array.isArray(e.Words)?e.Words:[];if(n.length===0)return!0;const s=n.some(c=>((c==null?void 0:c.AccuracyScore)??0)>0),i=n.some(c=>((c==null?void 0:c.Phonemes)||[]).some(u=>((u==null?void 0:u.AccuracyScore)??0)>0)),o=[e.PronScore,e.AccuracyScore,e.FluencyScore,e.CompletenessScore].some(c=>typeof c=="number"&&c>0);return s||i||o?!0:!n.every(c=>{const u=Number.isFinite(c==null?void 0:c.AccuracyScore)?c.AccuracyScore:0,d=c==null?void 0:c.ErrorType;return(d==="Omission"||d==null)&&u===0})}const gs="lux_user_id";function ms(){if(typeof crypto<"u"&&crypto.getRandomValues){const t=crypto.getRandomValues(new Uint8Array(16));t[6]=t[6]&15|64,t[8]=t[8]&63|128;const e=Array.from(t,r=>r.toString(16).padStart(2,"0")).join("");return`${e.slice(0,8)}-${e.slice(8,12)}-${e.slice(12,16)}-${e.slice(16,20)}-${e.slice(20)}`}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}let lr=null;try{lr=localStorage.getItem(gs)||ms(),localStorage.setItem(gs,lr)}catch{lr=ms()}typeof window<"u"&&(window.LUX_USER_ID=lr);const _l=t=>`https://youglish.com/pronounce/${encodeURIComponent(t)}/english`,un=t=>/[ÔøΩ‚Äò‚Äô‚Äú‚Äù‚Äî‚Äì‚Ä¶‚Ä¢\u0080-\uFFFF]/.test(String(t||""));function ys(){const t=["Great effort! Keep going‚Äîyour persistence is paying off.","Nice work! Every attempt brings you closer to perfect pronunciation.","You're improving with every try‚Äîkeep it up!","Excellent focus! Small adjustments make a big difference.","Keep practicing‚Äîyou're making real progress!"];return t[Math.floor(Math.random()*t.length)]}function Ce(t){if(t==null)return null;if(typeof t=="number"&&Number.isFinite(t))return t>=5e6?t/1e7:t>=1e3&&t<5e6?t/1e3:t;if(typeof t=="string"){var e=t.trim();if(!e)return null;if(/^-?\d+(\.\d+)?$/.test(e))return Ce(+e);var r=e.match(/^(-?\d+(?:\.\d+)?)(ms|msec|s|sec|secs|seconds)$/i);if(r){var n=parseFloat(r[1]),s=r[2].toLowerCase();return s==="ms"||s==="msec"?n/1e3:n}var i=e.match(/^(\d{1,2}):([0-5]?\d):([0-5]?\d)(?:\.(\d{1,9}))?$/);if(i){var o=+i[1],a=+i[2],l=+i[3],c=i[4]?parseFloat("0."+i[4]):0;return o*3600+a*60+l+c}var u=e.match(/^P(?:T(?:(\d+(?:\.\d+)?)H)?(?:(\d+(?:\.\d+)?)M)?(?:(\d+(?:\.\d+)?)S)?)$/i);if(u){var d=parseFloat(u[1]||"0"),f=parseFloat(u[2]||"0"),h=parseFloat(u[3]||"0");return d*3600+f*60+h}return null}if(typeof t=="object"){if("seconds"in t)return Ce(t.seconds);if("ms"in t)return Ce(t.ms);if("ticks"in t)return t.ticks/1e7;if("Offset"in t||"offset"in t)return Ce(t.Offset??t.offset);if("Duration"in t||"duration"in t)return Ce(t.Duration??t.duration)}return null}function bs(t){return Ce(t)}function xl(t){var e=(t||[]).filter(Number.isFinite).slice().sort(function(n,s){return n-s});if(!e.length)return null;var r=Math.floor(e.length/2);return e.length%2?e[r]:(e[r-1]+e[r])/2}function Sl(t){t=t||[];for(var e=new Array(t.length),r=0;r<t.length;r++){var n=t[r]||{},s=Ce(n.Offset??n.offset??n.Start??n.start??n.Begin??n.begin??n.Time??n.time)??null,i=Ce(n.Duration??n.duration??n.Length??n.length??n.Dur??n.dur)??null,o=Ce(n.End??n.end??n.Stop??n.stop??n.Finish??n.finish)??null;s!=null&&i!=null&&o==null&&(o=s+i),s!=null&&o!=null&&i==null&&(i=o-s),i!=null&&o!=null&&s==null&&(s=o-i),Number.isFinite(s)||(s=null),Number.isFinite(i)||(i=null),Number.isFinite(o)||(o=null),s!=null&&i!=null&&o==null&&(o=s+i),s!=null&&o!=null&&i==null&&(i=o-s),e[r]={start:s,end:o,durationSec:i}}return e}function cr(t,e){return Number.isFinite(t)?Number.isFinite(e)&&e>0?t>=e*1.45?"slow":t<=e*.6?"fast":"ok":t>.65?"slow":t<.3?"fast":"ok":"ok"}function ur(t,e){var r=bs(t)??(t==null?null:Number(t)),n=bs(e)??(e==null?null:Number(e));if(!Number.isFinite(r)||!Number.isFinite(n))return"ok";var s=n-r;return!Number.isFinite(s)||s<0?"ok":s>.6?"unexpected":s>=.35?"missing":"ok"}function vs(t,e,r,n){const s=r&&r[t]||{},i=r&&r[t-1]||{},o=cr(s.durationSec,n),a=Number.isFinite(i.end)&&Number.isFinite(s.start)?s.start-i.end:null,l=t>0?ur(i.end,s.start):"ok",c=Number.isFinite(n)?n:.45,u=Number.isFinite(s.durationSec)?s.durationSec/c:1,d=Math.min(150,Math.max(16,Math.round(110*u))),h=Number.isFinite(a)?a/.35:1,g=Math.min(160,Math.max(10,Math.round(100*h))),m=Number.isFinite(a)?`Pause before word: ${a.toFixed(2)}s (${l})`:"Pause before word: ‚Äî",p=Number.isFinite(s.durationSec)?`Word length: ${s.durationSec.toFixed(2)}s (${o})`:"Word length: ‚Äî",y=v=>String(v).replace(/"/g,"&quot;");return'<div class="prosody-ribbon" role="img" aria-label="'+y(m+"; "+p)+'"><span class="prosody-bar pr-seg pr-gap '+l+'" style="width:'+g+'px" data-tip="'+y(m)+'" aria-label="'+y(m)+'"></span><span class="prosody-bar pr-seg pr-tempo '+o+'" style="width:'+d+'px" data-tip="'+y(p)+'" aria-label="'+y(p)+'"></span></div>'}const yt=globalThis,El=yt.resolveYTLink||(t=>{try{if(typeof yt.ytLink=="function")return yt.ytLink(t);if(typeof yt.ytLink=="string")return yt.ytLink}catch{}return null});function ws(t){return t>=80?{color:"#2563eb",bg:"#dbeafe"}:t>=60?{color:"#d97706",bg:"#fef3c7"}:{color:"#dc2626",bg:"#fee2e2"}}function kl(t,e=5){let r="";const n=Object.entries(t).sort((s,i)=>i[1].count-s[1].count).slice(0,e);return n.length?(n.forEach(([s,i])=>{const o=Ue(s),a=Ln[o]??P[o]??{},l=_i(o)||{},c=El(l.ipa||s),u=ys?ys():"Keep practicing!",d=Math.min(...i.scores),f=ws(d).color,g=i.examples.filter(m=>!un(m.word)).slice(0,3).map(m=>{const{color:p,bg:y}=ws(m.score);return`<span style="white-space:nowrap; background:${y}; color:${p}; padding:2px 8px; border-radius:4px; font-weight:600; font-size:0.9em;">${m.word} (${m.score}%)</span>`}).join(" ");r+=`
        <div style="
            margin-bottom: 24px; 
            padding: 20px; 
            border: 1px solid #e2e8f0; 
            border-radius: 12px; 
            background: #fff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        ">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; border-bottom:1px solid #f1f5f9; padding-bottom:12px;">
             <div style="display:flex; align-items:center; gap:10px;">
                <span style="font-size:1.8em; font-weight:800; color:#0f172a;">/${l.ipa||s}/</span>
                <span style="font-size:0.9em; color:#64748b; background:#f8fafc; padding:2px 8px; border-radius:12px; border:1px solid #e2e8f0;">Sound</span>
             </div>
             <div style="text-align:right;">
                <div style="font-size:0.9em; color:#64748b;"><strong>${i.count}</strong> detections</div>
                <div style="font-size:0.9em; color:${f};">Lowest: <strong>${d}%</strong></div>
             </div>
          </div>

          <div style="margin-bottom:16px;">
             <div style="font-size:0.85em; text-transform:uppercase; color:#94a3b8; font-weight:700; margin-bottom:6px;">Problem Words</div>
             <div style="line-height:1.8; display:flex; flex-wrap:wrap; gap:6px;">
               ${g||"<span style='color:#94a3b8; font-style:italic;'>No specific words captured.</span>"}
             </div>
          </div>

          <div style="background:#f8fafc; padding:16px; border-radius:8px; border:1px solid #e2e8f0; margin-bottom:16px;">
             ${a.tip?`<div style="margin-bottom:8px;"><strong style="color:#0369a1;">üí° Tip:</strong> <span style="color:#334155;">${a.tip}</span></div>`:""}
             ${a.mistake?`<div><strong style="color:#b91c1c;">‚ö†Ô∏è Trap:</strong> <span style="color:#334155;">${a.mistake}</span></div>`:""}
          </div>

          <div style="display:flex; flex-wrap:wrap; gap:20px; align-items:flex-start;">
             
             ${l.video?`
               <div style="flex:0 0 auto; width:140px;">
                 <video src="${l.video}" controls playsinline preload="none" style="width:100%; border-radius:8px; background:#000; box-shadow:0 2px 5px rgba(0,0,0,0.1);"></video>
                 <div style="text-align:center; font-size:0.75em; color:#64748b; margin-top:4px;">Mouth Position</div>
               </div>
             `:""}

             <div style="flex:1; min-width:200px; display:flex; flex-direction:column; gap:10px;">
                
                ${c?`
                  <a href="${c}" target="_blank" rel="noopener noreferrer" style="
                      display:flex; align-items:center; gap:8px;
                      padding: 10px; background:#eff6ff; border:1px solid #bfdbfe;
                      border-radius:8px; text-decoration:none; transition:transform 0.1s;
                  ">
                    <span style="font-size:1.2em;">üì∫</span>
                    <div>
                        <div style="font-weight:700; color:#1d4ed8; font-size:0.95em;">Watch Deep Dive Lesson</div>
                        <div style="font-size:0.8em; color:#60a5fa;">Detailed walkthrough of /${l.ipa||s}/</div>
                    </div>
                  </a>
                `:""}

                <a href="https://calendly.com/mark-lux/pronunciation-coaching?note=focus_${s}" target="_blank" rel="noopener noreferrer" style="
                    display:flex; align-items:center; gap:8px;
                    padding: 10px; background:#f0fdf4; border:1px solid #bbf7d0;
                    border-radius:8px; text-decoration:none; transition:transform 0.1s;
                ">
                   <span style="font-size:1.2em;">üéì</span>
                   <div>
                        <div style="font-weight:700; color:#15803d; font-size:0.95em;">Book 1-on-1 Coaching</div>
                        <div style="font-size:0.8em; color:#4ade80;">Master this sound with an expert</div>
                   </div>
                </a>
             </div>
          </div>

          <div style="margin-top:16px; padding-top:12px; border-top:1px dashed #e2e8f0; font-size:0.9em; font-weight:600; color:#059669; text-align:center; font-style:italic;">
             "${u}"
          </div>

        </div>`}),r):"<div style='padding:10px; color:#2563eb; background:#eff6ff; border-radius:8px;'>No major recurring errors found‚Äîgreat job!</div>"}function Tl(t,e,r){const n=(e==null?void 0:e(t))||[],s=(r==null?void 0:r(n.map(i=>i.durationSec).filter(Number.isFinite)))??null;return{timings:n,med:s}}function Al(t){const e=document.getElementById("prettyResult");if(!e)return{$out:null,nbest:null,stop:!0};if(e.style.maxHeight="none",e.style.height="auto",e.style.overflowY="visible",!t||t.error)return e.innerHTML=`<span class="score-bad">Error: ${(t==null?void 0:t.error)||"Unknown"}</span>`,{$out:e,nbest:null,stop:!0};if(!wl(t))return e.innerHTML=`
      <div style="padding: 10px 0;">
        <h3 style="margin-top:0; color:#1f2937;">No speech detected.</h3>
        <p style="color:#b91c1c; font-weight:700; margin-bottom: 0;">
          Sorry, but we didn‚Äôt hear anything. Please check your mic and try again.
        </p>
      </div>
    `,{$out:e,nbest:null,stop:!0};const r=t.NBest&&t.NBest[0];return{$out:e,nbest:r,stop:!1}}const Pl=t=>{if(t==null||!Number.isFinite(+t))return"‚Äì";const e=+t;return Number.isInteger(e)?`${e}%`:`${e.toFixed(1)}%`},vr=t=>t==null?"":t>=80?"score-good":t>=60?"score-warn":"score-bad";function Ol(t){var i,o;const e=((i=t==null?void 0:t.NBest)==null?void 0:i[0])||{},r=(e==null?void 0:e.PronunciationAssessment)||(t==null?void 0:t.PronunciationAssessment)||{},n=(e==null?void 0:e.ContentAssessment)||(t==null?void 0:t.ContentAssessment)||{},s=a=>Number.isFinite(+a)?+a:null;return{accuracy:s((e==null?void 0:e.AccuracyScore)??(r==null?void 0:r.AccuracyScore)),fluency:s((e==null?void 0:e.FluencyScore)??(r==null?void 0:r.FluencyScore)),completeness:s((e==null?void 0:e.CompletenessScore)??(r==null?void 0:r.CompletenessScore)),overall:s((e==null?void 0:e.PronScore)??(r==null?void 0:r.PronunciationScore)??(r==null?void 0:r.PronScore)),prosody:s((e==null?void 0:e.ProsodyScore)??(r==null?void 0:r.ProsodyScore)??(t==null?void 0:t.ProsodyScore)??((o=t==null?void 0:t.PronunciationAssessment)==null?void 0:o.ProsodyScore)),content:{vocab:s((n==null?void 0:n.vocabularyScore)??(n==null?void 0:n.VocabularyScore)),grammar:s((n==null?void 0:n.grammarScore)??(n==null?void 0:n.GrammarScore)),topic:s((n==null?void 0:n.topicScore)??(n==null?void 0:n.TopicScore))},nbest:e}}function Rl(t){var g;const e=((g=t==null?void 0:t.NBest)==null?void 0:g[0])||{},r=(e==null?void 0:e.Words)||[],n=m=>Number.isFinite(+m)?+m:null,s=m=>m.length?m.reduce((p,y)=>p+y,0)/m.length:null,i=r.map(m=>n(m==null?void 0:m.AccuracyScore)).filter(Number.isFinite),o=s(i),a=r.filter(m=>!(m!=null&&m.ErrorType)||m.ErrorType==="None").length,l=r.length?Math.round(a/r.length*100):null,c=(e==null?void 0:e.PronunciationAssessment)||(t==null?void 0:t.PronunciationAssessment)||{},u=n((e==null?void 0:e.PronScore)??(c==null?void 0:c.PronunciationScore)??(c==null?void 0:c.PronScore))??(o!=null?Math.round(o):null),f=(globalThis.getSpeakingRate||function(){return{label:""}})(t),h=f.label?f.label==="ok"?85:65:null;return{accuracy:o!=null?Math.round(o):null,completeness:l,overall:u,fluency:h,rate:f}}const _s={Accuracy:"How close your pronunciation is to a native speaker.",Fluency:"How smooth and natural your speech was.",Completeness:"Did you say all the words in the reference?",Pronunciation:"Overall pronunciation quality.",Prosody:"Stress, intonation, rhythm, and pacing.",Phoneme:"The smallest possible sound in a language."};function xs(t){let e=Ol(t);if(e.accuracy==null){const g=Rl(t);e={...e,...g}}const{accuracy:r,fluency:n,completeness:s,overall:i,prosody:o,nbest:a}=e;let l="";if(typeof globalThis.getSpeakingRate=="function"){const g=globalThis.getSpeakingRate(t);g&&Number.isFinite(g.wps)&&(l=` ‚Ä¢ ~${g.wps.toFixed(1)} w/s`)}const c=(g,m,p,y="")=>`
        <span class="${vr(m)}" style="white-space:nowrap; margin-right:4px; display:inline-block;">
          ${g}
          <span class="tooltip result-tip tip-${p}">(?) 
            <span class="tooltiptext">${_s[p]||""}</span>
          </span>
          : ${Pl(m)}${y}
        </span>
      `,u=(t==null?void 0:t.DisplayText)||(a==null?void 0:a.Display)||"(No speech detected)",f=['id="scoreHeader"',`class="toggle-col ${i!=null?vr(i):""}"`,`data-overall-score="${i||0}"`].join(" ");return`
    <div id="resultHeader" style="margin-bottom: 20px;">
      <div style="margin-bottom: 12px; font-size: 1.1em;">
        <b>Your Results:</b><br>
        <div style="margin-top:8px; line-height: 2.2;">
            ${c("Prosody",o,"Prosody",l)} | 
            ${c("Accuracy",r,"Accuracy")} | 
            ${c("Fluency",n,"Fluency")} | 
            ${c("Completeness",s,"Completeness")} | 
            ${c("Pronunciation",i,"Pronunciation")}
        </div>
      </div>
  
      <div style="margin-bottom: 16px; color:#334155;">
        <b>What you said:</b>
        <span style="font-style:italic;">"${u}"</span>
      </div>
    </div>

    <div class="results-flex">
      
    <div id="prosodyLegend" class="prosody-legend prosody-legend--side hidden" role="note" aria-live="polite">
      <div class="legend-row">
        <div class="sample">
          <div class="prosody-ribbon">
            <span class="pr-seg pr-gap ok" style="width:12px"></span>
            <span class="pr-seg pr-tempo ok" style="width:28px"></span>
          </div>
          <span class="label">Normal</span>
        </div>
        <div class="sample">
          <div class="prosody-ribbon">
            <span class="pr-seg pr-gap missing" style="width:20px"></span>
            <span class="pr-seg pr-tempo ok" style="width:28px"></span>
          </div>
          <span class="label">Pause</span>
        </div>
      </div>
      <div class="note">Bars show pause (left) and tempo (right).</div>
    </div>
  

      <div class="table-scroll-container custom-scrollbar">
        <table class="score-table collapsed-score collapsed-error">
          <thead style="position: sticky; top: 0; z-index: 20; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);">
            <tr>
              <th id="wordHeader">
                <button class="lux-col-toggle" type="button" data-col="word" aria-label="Collapse/expand Word column" title="Collapse/expand Word column">‚ñ∏</button>
                <span class="word-chip clickable">Word</span>
              </th>
              <th ${f}>Score ‚ñ∏</th>
              <th id="errorHeader" class="toggle-col">Error ‚ñ∏</th>
              <th id="phonemeHeader">
                <button class="lux-col-toggle" type="button" data-col="phoneme" aria-label="Collapse/expand Phoneme column" title="Collapse/expand Phoneme column">‚ñ∏</button>
                <span class="word-chip phoneme-chip clickable" id="phonemeTitle">Phoneme</span>
                <span class="tooltip result-tip tip-Phoneme" style="margin-left: 8px;">(?)<span class="tooltiptext">${_s.Phoneme}</span></span>
              </th>
            </tr>
          </thead>
          <tbody id="resultBody"></tbody>
        </table>
      </div>
    </div>
  `}function Ai(t,e,r){var s,i,o;const n=window.safePlayVideo;if(typeof n=="function")return n(t,e,r||{});try{if(e&&t.src!==e&&(t.src=e),r&&"muted"in r&&(t.muted=!!r.muted),r&&r.restart)try{t.currentTime=0}catch{}return(o=(s=t.play)==null?void 0:(i=s.call(t)).catch)==null?void 0:o.call(i,()=>{})}catch{}}function Hr(){const t=document.getElementById("ygPreview"),e=document.getElementById("ygDemo"),r=document.getElementById("unmuteTip"),n=document.getElementById("wordHeader"),s=n&&n.querySelector(".word-chip");if(!t||!e||!n||!s||s._ygBound)return;s._ygBound=!0;function i(){const c=s.getBoundingClientRect();t.style.left=c.right+10+"px",t.style.top=c.top+"px",t.style.display="block",Ai(e,e.getAttribute("src"),{muted:!0,restart:!0})}function o(){t.style.display="none",e.pause(),e.currentTime=0,e.muted=!0,r&&(r.style.display="none"),s.classList.remove("is-playing")}function a(c){const u=c.relatedTarget;u&&(u===t||t.contains(u))||o()}function l(c){const u=c.relatedTarget;u&&(u===s||s.contains(u))||o()}s.addEventListener("mouseover",i),s.addEventListener("mouseout",a),t.addEventListener("mouseout",l),s.addEventListener("click",c=>{c.stopPropagation(),e.muted=!e.muted,e.paused&&e.play().catch(()=>{}),r&&(r.textContent=e.muted?"Muted":"Audio on",r.style.display="block",setTimeout(()=>{r.style.display="none"},1500)),s.classList.toggle("is-playing",!e.muted)})}let j=null,dr=null,Ot=null,Bt=null,Ss=!1,Es=!1;function hr(){if(Ss){console.warn("[LUX] Phoneme Hover System already active. Skipping re-init.");return}Cl(),$l(),jl(),Ss=!0,console.log("[LUX] Phoneme Hover System Active (Robust Mode)")}function Cl(){return j||(Il(),j=document.createElement("div"),j.id="lux-global-ph-tooltip",j.style.cssText=`
    position: fixed;
    z-index: var(--z-popover);
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.15s ease, transform 0.15s ease;
    background: #1e293b;
    color: #fff;
    padding: 0;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    width: 300px;
    pointer-events: auto;
    font-family: system-ui, sans-serif;
    font-size: 14px;
    line-height: 1.4;
    overflow: hidden;
  `,dr=document.createElement("div"),dr.id="lux-global-ph-tooltip-content",j.appendChild(dr),j.addEventListener("mouseenter",()=>clearTimeout(Bt)),j.addEventListener("mouseleave",()=>Pi()),document.body.appendChild(j),j)}function Il(){if(document.getElementById("lux-global-ph-tooltip-style"))return;const t=document.createElement("style");t.id="lux-global-ph-tooltip-style",t.textContent=`
    #lux-global-ph-tooltip video::-webkit-media-controls { display:none !important; }
    #lux-global-ph-tooltip video::-webkit-media-controls-enclosure { display:none !important; }
    #lux-global-ph-tooltip video::-webkit-media-controls-panel { display:none !important; }

    /* ---- Text carousel (Plain / Technical / Common mix-ups) ---- */
    #lux-global-ph-tooltip .lux-ph-text-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:8px 10px;
      background:#0f172a;
      border-bottom:1px solid #334155;
    }
    #lux-global-ph-tooltip .lux-ph-nav-btn{
      width:28px;
      height:28px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color:#e2e8f0;
      cursor:pointer;
      line-height: 1;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
    }
    #lux-global-ph-tooltip .lux-ph-nav-btn:disabled{
      opacity:0.35;
      cursor:default;
    }
    #lux-global-ph-tooltip .lux-ph-title{
      flex:1;
      text-align:center;
      font-size:12px;
      letter-spacing:0.02em;
      color:#cbd5e1;
      font-weight:800;
    }
    #lux-global-ph-tooltip .lux-ph-viewport{ overflow:hidden; }
    #lux-global-ph-tooltip .lux-ph-track{
      display:flex;
      width:300%;
      transition: transform 220ms ease;
    }
    #lux-global-ph-tooltip .lux-ph-panel{
      flex: 0 0 100%;
      padding: 10px 12px 12px;
      color:#e2e8f0;
    }
    #lux-global-ph-tooltip .lux-ph-panel.is-empty{
      color:#94a3b8;
      font-style:italic;
    }
    #lux-global-ph-tooltip .lux-ph-dots{
      display:flex;
      justify-content:center;
      gap:6px;
      padding: 8px 0 10px;
      background:#0f172a;
      border-bottom:1px solid #334155;
    }
    #lux-global-ph-tooltip .lux-ph-dot{
      width:6px;
      height:6px;
      border-radius:999px;
      background: rgba(255,255,255,0.55);
      opacity:0.55;
      transform: scale(1);
      transition: transform 180ms ease, opacity 180ms ease;
    }
    #lux-global-ph-tooltip .lux-ph-dot.is-active{
      opacity:1;
      transform: scale(1.25);
      background: rgba(255,255,255,0.9);
    }
    #lux-global-ph-tooltip .lux-ph-words{
      padding: 10px 12px 12px;
      font-size: 12px;
      color:#94a3b8;
      border-bottom:1px solid #334155;
    }
    #lux-global-ph-tooltip .lux-ph-words b{ color:#cbd5e1; }
  `,document.head.appendChild(t)}function Pi(){clearTimeout(Bt),Bt=setTimeout(()=>Nl(),200)}function $l(){const t=document.body;t.addEventListener("mouseover",e=>{const r=e.target.closest(".phoneme-chip[data-hydrated]");r&&r.id!=="phonemeTitle"&&(clearTimeout(Bt),Oi(r))}),t.addEventListener("mouseout",e=>{const r=e.target.closest(".phoneme-chip[data-hydrated]");if(!r||r.id==="phonemeTitle")return;const n=e.relatedTarget;n&&(n===j||j.contains(n))||Pi()}),t.addEventListener("click",e=>{const r=e.target.closest(".phoneme-chip[data-hydrated]");!r||r.id==="phonemeTitle"||!(r.getAttribute("data-video-src")||r.dataset.videoSrc)||(e.preventDefault(),e.stopPropagation(),clearTimeout(Bt),Bl(r))},{capture:!0})}function jl(){const t=document.getElementById("phPreview"),e=document.getElementById("phDemo"),r=document.getElementById("phonemeHeader"),n=r==null?void 0:r.querySelector(".phoneme-chip"),s=document.getElementById("phUnmuteTip");if(!t||!e||!r||!n||n._hoverBound)return;n._hoverBound=!0;function i(){const l=r.getBoundingClientRect();let c=l.left-560-10;c<10&&(c=10);let u=l.top;u+390>window.innerHeight&&(u=window.innerHeight-390-10),t.style.left=c+"px",t.style.top=u+"px"}function o(){t.style.display!=="block"&&(t.style.display="block",i(),e.muted=!Es,e.volume=1,Ai(e,e.getAttribute("src"),{muted:e.muted,restart:!0}),n.classList.toggle("is-playing",Es),s&&(s.style.display="none"))}function a(){t.style.display="none",e.pause(),e.currentTime=0,n.classList.remove("is-playing"),s&&(s.style.display="none")}n.addEventListener("mouseover",o),n.addEventListener("mouseout",l=>{const c=l.relatedTarget;c&&(c===t||t.contains(c))||a()}),t.addEventListener("mouseout",l=>{const c=l.relatedTarget;c&&(c===n||n.contains(c))||a()})}function Oi(t){if(Ot===t&&j.style.visibility==="visible")return;Ot=t;const e=t.getAttribute("data-ipa")||"?",r=t.getAttribute("data-tip-plain")||t.getAttribute("data-tip-text")||"",n=t.getAttribute("data-tip-tech")||"",s=t.getAttribute("data-tip-mistake")||"",i=t.getAttribute("data-video-src")||"",o=t.getAttribute("data-poster-src")||"",a=t.getAttribute("data-display-ipa")||"";let l=[];const c=t.getAttribute("data-tip-words")||"";if(c)try{const y=JSON.parse(c);Array.isArray(y)&&(l=y.filter(Boolean).slice(0,3))}catch{}const u=[{title:"Plain",text:r,empty:`No details available for /${e}/ yet.`},{title:"Technical",text:n,empty:"Technical note coming soon."},{title:"Common mix-ups",text:s,empty:"No common mistakes recorded yet."}];let d=`
    <div style="background:#0f172a; padding:10px 12px; border-bottom:1px solid #334155; display:flex; justify-content:space-between; align-items:center;">
      <div>
        <span style="font-weight:800; font-size:1.2em; color:#fff;">/${Yt(e)}/</span>
        ${a?`<span style="color:#94a3b8; font-size:0.95em; margin-left:8px;">${Yt(a)}</span>`:""}
      </div>
    </div>

    <div class="lux-ph-text-head">
      <button id="lux-ph-text-prev" class="lux-ph-nav-btn" type="button" aria-label="Previous panel">‚Äπ</button>
      <div id="lux-ph-text-title" class="lux-ph-title"></div>
      <button id="lux-ph-text-next" class="lux-ph-nav-btn" type="button" aria-label="Next panel">‚Ä∫</button>
    </div>

    <div class="lux-ph-viewport">
      <div id="lux-ph-text-track" class="lux-ph-track">
        ${u.map(y=>{const v=(y.text||"").trim().length>0,w=v?y.text:y.empty;return`<div class="lux-ph-panel${v?"":" is-empty"}">${Yt(w)}</div>`}).join("")}
      </div>
    </div>

    <div id="lux-ph-text-dots" class="lux-ph-dots">
      ${u.map((y,v)=>`<span class="lux-ph-dot${v===0?" is-active":""}"></span>`).join("")}
    </div>
  `;l.length&&(d+=`<div class="lux-ph-words"><b>Examples:</b> ${l.map(Yt).join(" ‚Ä¢ ")}</div>`),i&&(d+=`
      <div style="background:#000; width:100%; aspect-ratio:16/9; position:relative;">
        <video id="lux-global-video"
          src="${i}"
          poster="${o}"
          playsinline
          muted
          disablePictureInPicture
          style="width:100%; height:100%; object-fit:contain; display:block;"
          preload="metadata"></video>

        <div id="lux-vid-overlay"
          style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.2); pointer-events:none;">
          <span style="font-size:30px; opacity:0.8;">‚ñ∂</span>
        </div>
      </div>

      <div style="background:#0f172a; color:#94a3b8; font-size:11px; text-align:center; padding:6px;">
        Click chip to play with sound üîä
      </div>
    `),dr.innerHTML=d,Ll(u);const f=t.getBoundingClientRect(),h=j.offsetHeight||300,g=window.innerHeight;let m=f.bottom,p=f.left+f.width/2-150;m+h>g-10&&(m=f.top-h),p<10&&(p=10),p+300>window.innerWidth-10&&(p=window.innerWidth-310),j.style.top=`${m}px`,j.style.left=`${p}px`,j.style.visibility="visible",j.style.opacity="1"}function Ll(t){const e=j==null?void 0:j.querySelector("#lux-ph-text-track"),r=j==null?void 0:j.querySelector("#lux-ph-text-title"),n=j==null?void 0:j.querySelector("#lux-ph-text-prev"),s=j==null?void 0:j.querySelector("#lux-ph-text-next"),i=j==null?void 0:j.querySelector("#lux-ph-text-dots");if(!e||!r||!n||!s||!i)return;const o=[...i.querySelectorAll(".lux-ph-dot")],a=t.length;let l=0;function c(){var f;e.style.transform=`translateX(-${l*100}%)`,r.textContent=((f=t[l])==null?void 0:f.title)||"",o.forEach((h,g)=>h.classList.toggle("is-active",g===l));const d=a<=1;n.disabled=d,s.disabled=d}function u(d){a<=1||(l=(l+d+a)%a,c())}n.onclick=d=>{d.preventDefault(),d.stopPropagation(),u(-1)},s.onclick=d=>{d.preventDefault(),d.stopPropagation(),u(1)},c()}function Nl(){if(j){j.style.opacity="0",j.style.visibility="hidden";const t=j.querySelector("video");t&&(t.pause(),t.currentTime=0)}Ot&&Ot.classList.remove("lux-playing-lock"),Ot=null}function Bl(t){Oi(t);const e=j.querySelector("video"),r=j.querySelector("#lux-vid-overlay");e&&(t.classList.add("lux-playing-lock"),e.muted=!1,e.volume=1,e.currentTime=0,r&&(r.style.display="none"),e.play().catch(n=>console.warn("Auto-play blocked",n)),e.onended=()=>{t.classList.remove("lux-playing-lock"),r&&(r.style.display="flex")})}function Yt(t){return String(t).replace(/[&<>'"]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[e])}function Wr(){const t=document.getElementById("phonemeAudioBtn"),e=document.querySelector("#phonemeHeader .phoneme-chip"),r=document.getElementById("phDemo"),n=document.getElementById("phUnmuteTip");if(!r)return;function s(i){i.stopPropagation(),r.muted=!r.muted,r.paused&&r.play().catch(()=>{}),e&&e.classList.toggle("is-playing",!r.muted),n&&(n.textContent=r.muted?"Muted":"Audio on",n.style.display="block",setTimeout(()=>{n.style.display="none"},1500))}t&&!t._phA&&(t.addEventListener("click",s),t._phA=1),e&&!e._phA&&(e.addEventListener("click",s),e._phA=1)}function zr(){const t=document.getElementById("prettyResult");!t||t.dataset.collapseInit||(t.dataset.collapseInit="yes",t.addEventListener("click",e=>{const r=e.target.closest("button.lux-col-toggle");if(r){const i=r.closest("table"),o=r.dataset.col;if(!i||!o)return;o==="word"&&i.classList.toggle("collapsed-word"),o==="phoneme"&&i.classList.toggle("collapsed-phoneme");return}const n=e.target.closest("td,th"),s=n&&n.closest("table");!n||!s||!Number.isInteger(n.cellIndex)||(n.cellIndex===1?s.classList.toggle("collapsed-score"):n.cellIndex===2&&s.classList.toggle("collapsed-error"))}))}function Ae(){["Accuracy","Fluency","Completeness","Pronunciation","Phonemes","Prosody","ProsodyBars"].forEach((t,e)=>{const r=document.querySelector("#prettyResult .tip-"+t);r&&(r.classList.remove("hidden"),r.offsetWidth,r.classList.add("hidden"),setTimeout(()=>{r.classList.remove("hidden"),r.classList.add("pop-in"),setTimeout(()=>r.classList.remove("pop-in"),1200)},800+e*350))})}function Pe(){const t=document.getElementById("prosodyLegendToggle"),e=document.getElementById("prosodyLegend"),r=e&&e.closest(".results-flex")||document.querySelector(".results-flex");if(!t||!e||!r)return;e._legendReady||(e.classList.remove("hidden"),e.setAttribute("aria-hidden","true"),r.classList.remove("legend-open"),e._legendReady=1);let n=document.getElementById("legendPeek");n||(n=document.createElement("div"),n.id="legendPeek",r.appendChild(n));function s(){if(!n)return;const a=r.getBoundingClientRect(),l=r.querySelector("table.score-table")||r.querySelector("table");if(!l)return;const c=l.getBoundingClientRect(),u=l.querySelector("#wordHeader");let d=44;if(u){const h=u.getBoundingClientRect();d=Math.max(0,h.top-a.top+h.height/2-20)}const f=Math.max(0,c.left-a.left-(n.offsetWidth||12)+2);n.style.left=f+"px",n.style.top=d+"px"}const i=()=>{s(),r.classList.add("show-peek")},o=()=>r.classList.remove("show-peek");if(!t._legendBound){const a=l=>{l.preventDefault();const c=!r.classList.contains("legend-open");if(r.classList.toggle("legend-open",c),e.setAttribute("aria-hidden",String(!c)),c){t.classList.remove("cue-legend");try{localStorage.setItem("seenProsodyLegendCue","1")}catch{}o()}else s(),i(),setTimeout(o,800)};t.addEventListener("pointerenter",i),t.addEventListener("mouseenter",i),t.addEventListener("focusin",i),t.addEventListener("pointerleave",o),t.addEventListener("mouseleave",o),t.addEventListener("focusout",o),t.addEventListener("click",a),t.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&a(l)}),t._legendBound=1}n._legendBound||(n.addEventListener("click",()=>t.click()),n._legendBound=1);try{localStorage.getItem("seenProsodyLegendCue")||t.classList.add("cue-legend")}catch{}s(),window.addEventListener("resize",s,{passive:!0})}function Rt(t,...e){const r=globalThis==null?void 0:globalThis[t];if(typeof r=="function")return r(...e)}function Ul(t){const e=globalThis,r=document.getElementById("prettyResult");if(!r)return;if(document.getElementById("resultBody")){Rt("fillProsodyAndContentSlots",t),setTimeout(()=>Ae==null?void 0:Ae(),0),Pe==null||Pe();return}let n=null;try{typeof xs=="function"&&(n=xs(t))}catch(s){console.warn("[views/header] modern header failed, falling back:",s)}if(!n&&typeof e.renderResultsHeader=="function")try{n=e.renderResultsHeader(t)}catch(s){console.warn("[views/header] legacy renderResultsHeader failed:",s)}n||(n=`
      <div id="resultHeader"></div>
      <table class="score-table collapsed-score collapsed-error">
        <thead>
          <tr>
            <th id="wordHeader">
              <span class="word-chip clickable">Word</span>
            </th>
            <th id="scoreHeader" class="toggle-col">
              Score ‚ñ∏
            </th>
            <th id="errorHeader" class="toggle-col">
              Error ‚ñ∏
            </th>
            <th id="phonemeHeader">
              <span
                class="word-chip phoneme-chip clickable"
                id="phonemeTitle"
              >
                Phoneme
              </span>
            </th>
          </tr>
        </thead>
        <tbody id="resultBody"></tbody>
      </table>
    `),r.insertAdjacentHTML("afterbegin",n),Rt("fillProsodyAndContentSlots",t),setTimeout(()=>Ae==null?void 0:Ae(),0),Pe==null||Pe()}function Dl(t){try{Rt("fillProsodyAndContentSlots",t),Hr==null||Hr(),hr==null||hr(),Wr==null||Wr(),zr==null||zr(),Ae==null||Ae(),Pe==null||Pe(),Rt("initPhonemeClickPlay"),Rt("initProsodyBarsUX")}catch(e){console.warn("[views] post-DOM wiring error:",e)}}function Ml(t,e,r,n){const s=(r==null?void 0:r[e])||{},i=(r==null?void 0:r[e-1])||{},o=(cr==null?void 0:cr(s.durationSec,n))||"ok",a=e>0&&(ur==null?void 0:ur(i.end,s.start))||"ok",l=t.ErrorType&&t.ErrorType!=="None"?t.ErrorType:"",c=[];a==="missing"?c.push("missing phrase pause"):a==="unexpected"&&c.push("long pause"),o==="fast"?c.push("too fast"):o==="slow"&&c.push("too slow");const u=[l,...c].filter(Boolean).join("; "),d=(o==="fast"||o==="slow"?4:0)+(a==="missing"||a==="unexpected"?2:0),f=t.AccuracyScore??0,h=Math.max(0,Math.min(100,Math.round(f-d)));return{tempo:o,gapCls:a,errText:u,penalty:d,adjScore:h,rawScore:f}}function ql(t,e,r){return(t||[]).map((n,s)=>{const{penalty:i,adjScore:o,errText:a,rawScore:l}=Ml(n,s,e,r),c=typeof vs=="function"?vs(s,t,e,r):"",u=(n.Phonemes||[]).map(d=>{const f=d.Phoneme,h=Ue(f);return`
          <span 
            class="phoneme-chip ${vr(d.AccuracyScore)}" 
            data-ipa="${h}"
            data-score="${d.AccuracyScore}"
            style="cursor: pointer;"
          >
            ${f}
            <span style="font-size: 0.8em; opacity: 0.7; margin-left: 2px;">
                (${d.AccuracyScore}%)
            </span>
          </span>`}).join(" ");return`
        <tr>
          <td class="word-cell">
            ${c}
            <a href="${_l(n.Word)}" 
               target="_blank" 
               rel="noopener noreferrer"
               title="Hear '${n.Word}' on YouGlish" 
               class="${vr(l)}">
              ${n.Word}
            </a>
          </td>
          <td>${n.AccuracyScore!==void 0?`${l}%`+(i?` <span title="Prosody-adjusted">¬∑ adj ${o}%</span>`:""):"‚Äì"}</td>
          <td>${a||""}</td>
          <td>
            <div style="display:flex; flex-wrap:wrap; gap:6px; justify-content:center;">
              ${u}
            </div>
          </td>
        </tr>`}).join("")}function Fl({$out:t,data:e,nbest:r}){t.innerHTML="",Ul(e);const n=r.Words||[],{timings:s,med:i}=Tl(n,Sl,xl),o=document.getElementById("resultBody");o&&(o.innerHTML=ql(n,s,i)),requestAnimationFrame(()=>Dl(e))}function Hl(t){const{$out:e,nbest:r,stop:n}=Al(t);n||Fl({$out:e,data:t,nbest:r})}async function ks(t="#prettyResult"){const e=document.querySelector(t);if(!e)return;const r=[...e.querySelectorAll(".phoneme-chip:not([data-hydrated])")];if(r.length)for(const n of r){const s=n.getAttribute("data-ipa")||n.textContent.trim().split(" ")[0],i=Ue(s);n.setAttribute("data-hydrated","true"),n.setAttribute("data-ipa",i);const o=Ln[i],a=P[i],l=_i(i);let c="",u="",d="",f="",h=[];if(o){c=o.tip||"",u=o.tech||"",d=o.mistake||"",f=o.ipa||"";const g=o.words||o.examples;Array.isArray(g)&&(h=g)}else a&&(c=`${a.label}. ${a.tip}`,f=`/${i}/ (as in '${a.example}')`,a.example&&(h=[a.example]));c&&(n.setAttribute("data-tip-plain",c),n.setAttribute("data-tip-text",c)),u&&n.setAttribute("data-tip-tech",u),d&&n.setAttribute("data-tip-mistake",d),h.length&&n.setAttribute("data-tip-words",JSON.stringify(h.filter(Boolean).slice(0,3))),f&&n.setAttribute("data-display-ipa",f),l!=null&&l.video&&(n.setAttribute("data-video-src",l.video),l.poster&&n.setAttribute("data-poster-src",l.poster))}}function Wl(t){return t>=80?{color:"#2563eb",bg:"#dbeafe"}:t>=60?{color:"#d97706",bg:"#fef3c7"}:{color:"#dc2626",bg:"#fee2e2"}}function zl({allPartsResults:t,currentParts:e}){var u;const r=document.getElementById("prettyResult");if(!r)return;r.style.maxHeight="none",r.style.height="auto",r.style.overflowY="visible";const n=((u=t==null?void 0:t[0])==null?void 0:u.passage_key)||"rainbow",s=Xe[n],i=s==null?void 0:s.youtubeId,o={},a=[];(t||[]).forEach((d,f)=>{var g;const h=(g=d==null?void 0:d.NBest)==null?void 0:g[0];h&&(h.Words||[]).forEach(m=>{un(m.Word)||(m.AccuracyScore!=null&&m.AccuracyScore<60&&a.push({part:f+1,word:m.Word,score:m.AccuracyScore}),(m.Phonemes||[]).forEach(p=>{if(p.AccuracyScore!=null&&p.AccuracyScore<85){const y=Ue(p.Phoneme);o[y]||(o[y]={count:0,scores:[],examples:[]}),o[y].count++,o[y].scores.push(p.AccuracyScore),o[y].examples.push({word:m.Word,part:f+1,score:p.AccuracyScore})}}))})});const l=a.filter(d=>!un(d.word)).slice(0,5);let c=`
    <div style="text-align:center; margin-bottom:24px;">
      <h2 style="margin:0 0 8px 0; color:#1e293b; font-size: 2rem;">Passage Summary</h2>
      <div style="color:#64748b; font-size:1.1em;">Analysis of all ${(e||[]).length} parts</div>
    </div>
  `;if(i&&(c+=`
      <details style="
        margin-bottom: 32px;
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
      ">
        <summary style="
          padding: 16px 20px;
          cursor: pointer;
          font-weight: 700;
          color: #0f172a;
          list-style: none;
          display: flex;
          align-items: center;
          justify-content: space-between;
          background: #f8fafc;
        ">
          <span style="display:flex; align-items:center; gap:8px;">
            <span style="font-size:1.2em">üì∫</span> 
            Reference: Hear Native Speaker
          </span>
          <span style="font-size: 0.8em; opacity: 0.6;">‚ñº</span>
        </summary>
        <div style="padding: 0 16px 16px 16px; background:#fff;">
          <div style="margin-top:16px; position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; border:1px solid #e2e8f0;">
            <iframe 
              style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" 
              src="https://www.youtube.com/embed/${i}" 
              title="YouTube video player" 
              frameborder="0" 
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen>
            </iframe>
          </div>
          <div style="margin-top:12px; font-size: 0.9em; color: #64748b; text-align: center; font-style:italic;">
            Compare your rhythm, melody, and pacing to this reference.
          </div>
        </div>
      </details>
    `),c+='<h3 style="color:#334155; margin-bottom:16px; font-size:1.3em;">üéØ Priority Focus Areas (Phonemes)</h3>',c+=kl(o),c+='<h3 style="color:#334155; margin:32px 0 16px 0; font-size:1.3em;">‚ö†Ô∏è Words to Review</h3>',l.length){const d=l.map(f=>{const{color:h,bg:g}=Wl(f.score);return`
        <span style="
            background: ${g}; 
            color: ${h}; 
            padding: 6px 14px; 
            border-radius: 20px; 
            font-weight: 700; 
            font-size: 0.95em;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        ">
           ${f.word} 
           <span style="opacity:0.8; font-weight:400;">(${f.score}%)</span>
           <span style="font-size:0.75em; opacity:0.6; text-transform:uppercase; letter-spacing:0.5px;">Pt ${f.part}</span>
        </span>
      `}).join("");c+=`<div style="display:flex; flex-wrap:wrap; gap:8px;">${d}</div>`}else c+='<div style="color:#2563eb; font-style:italic; padding:10px; background:#dbeafe; border-radius:8px;">No word-level scores below 60%. Excellent accuracy!</div>';r.innerHTML=c}function Vl(){const t=window&&window.LUX_USER_ID||"",e=document.documentElement.getAttribute("data-uid")||"";return(t||e||"‚Äî").toString()}function Kl(){const t=document.getElementById("prettyResult");if(!t)return null;let e=document.getElementById("lux-db-summary");return e||(e=document.createElement("div"),e.id="lux-db-summary",e.style.cssText=["margin-top: 24px","padding: 20px","border-top: 1px solid #cce3f5","font-size: 1rem","color: #134e6f","background: #e7f2fb","border-radius: 0 0 12px 12px","text-align: center","line-height: 1.6"].join(";"),t.appendChild(e)),e}function Gl(t){const e="https://luxury-language-api.vercel.app/admin",r="grandfather,rainbow,sentences,wordList",n=c=>c.toISOString().slice(0,10),s=new Date,i=n(s),o=n(new Date(s.getTime()-336*60*60*1e3)),a=`uid=${encodeURIComponent(t)}`,l=`&from=${o}&to=${i}`;return{progress:`${e}/?${a}${l}&smooth=7&passages=${encodeURIComponent(r)}&limit=500`,attempts:`${e}/user.html?${a}${l}&passages=${encodeURIComponent(r)}&limit=500`,cohort:`${e}/overview.html?from=${o}&to=${i}&sort=last&limit=10000&passages=${encodeURIComponent(r)}&quick=14`}}function Jl({allPartsResults:t,currentParts:e}={}){zl({allPartsResults:t,currentParts:e});const r=Kl();if(!r)return;const n=Vl(),s=Gl(n);r.innerHTML=`
    <h3 style="margin: 0 0 12px 0; color: #0078d7; font-size: 1.3rem; font-weight: 800;">
      Long Term Analysis
    </h3>
    
    <div>
      The more recordings you make, the better the feedback will be ü§î üí≠ üí° üòÆ:
      
      <span class="lux-cta" tabindex="0" aria-haspopup="dialog" aria-expanded="false" style="margin-left: 4px;">
        database tracking
        
        <span class="lux-pop" role="dialog" aria-label="Database tracking details" style="text-align: left;">
          <strong style="display: block; margin-bottom: 6px">Your Practice History</strong>
          <p style="margin: 0 0 8px; color: #444; font-size: 13px">
            Jump to your long-term stats to see progress over time.
          </p>

          <div class="lux-uidrow">
            <span>UID:</span>
            <code style="font-family:monospace; background:#f1f5f9; padding:2px 6px; border-radius:4px;">${n.slice(0,8)}...</code>
            <button id="lux-copy-footer" class="lux-btn" type="button">Copy</button>
            <small id="lux-copied-footer" class="lux-copied" aria-live="polite"></small>
          </div>

          <div class="lux-links">
            <a href="${s.attempts}" target="_blank" rel="noopener">Attempts (admin)</a>
            <a href="${s.progress}" target="_blank" rel="noopener">User Progress (admin)</a>
            <a href="${s.cohort}" target="_blank" rel="noopener">Cohort (admin)</a>
          </div>

          <small class="lux-note">Admin token required for these dashboards.</small>
        </span>
      </span>
    </div>
  `;const i=document.getElementById("lux-copy-footer"),o=document.getElementById("lux-copied-footer");i&&(i.onclick=async l=>{l.stopPropagation();try{await navigator.clipboard.writeText(n),o&&(o.textContent="Copied!",setTimeout(()=>o.textContent="",1500))}catch(c){console.warn("Copy failed",c)}});const a=r.querySelector(".lux-cta");if(a){const l=c=>a.setAttribute("aria-expanded",c);a.addEventListener("mouseenter",()=>l("true")),a.addEventListener("mouseleave",()=>l("false")),a.addEventListener("focusin",()=>l("true")),a.addEventListener("focusout",()=>l("false"))}}let fr=null,Ts=!1;function Ri(){if(!Ts){Ts=!0;try{hr(),console.log("[LUX] phoneme hover booted")}catch(t){console.warn("[LUX] phoneme hover boot failed",t)}}}function Ci(){try{typeof ks=="function"?ks():console.warn("[LUX] ph-chips: initPhonemeChipBehavior not found")}catch(t){console.warn("[LUX] phoneme chip hydration failed",t)}}function dn(t){fr=t,Hl(t),Ci(),Ri()}function Yl({allPartsResults:t,currentParts:e}={}){if(Array.isArray(t)&&t.length){const r=t[t.length-1];r&&(fr=r),Jl({allPartsResults:t,currentParts:e||[]}),Ci(),Ri();return}fr&&dn(fr)}function As(t="#referenceText",e=0){const r=typeof t=="string"?document.querySelector(t):t;if(!r)return;const n=r.getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:n,behavior:"smooth"})}function ft(){const t=document.getElementById("aiFeedbackSection"),e=document.getElementById("aiFeedback");return{section:t,box:e}}function Wt(t,e){const r=t.querySelector(".ai-content");if(r)return e&&Ps(t,e),r;t.innerHTML="",t.classList.add("ai-grid-container");const n=document.createElement("div");n.className="ai-sidebar";const s=document.createElement("div");s.className="ai-sidebar-label",s.textContent="Coach Style",n.appendChild(s),[{id:"tutor",icon:"üßë‚Äçüè´",label:"Tutor"},{id:"drill",icon:"ü´°",label:"Sgt."},{id:"linguist",icon:"üßê",label:"Expert"}].forEach(a=>{const l=document.createElement("button");l.className=`ai-voice-btn ${a.id==="tutor"?"active":""}`,l.dataset.value=a.id,l.innerHTML=`<span>${a.icon}</span> <span>${a.label}</span>`,n.appendChild(l)});const o=document.createElement("div");return o.className="ai-content custom-scrollbar",o.style.cssText=`
    max-height: 450px; 
    overflow-y: auto; 
    padding: 20px; 
    background: #fff; 
    display: flex; 
    flex-direction: column;
  `,t.appendChild(n),t.appendChild(o),e&&Ps(t,e),o}function Ps(t,e){const r=t.querySelector(".ai-sidebar");if(!r)return;r.querySelectorAll(".ai-voice-btn").forEach(s=>{const i=s.cloneNode(!0);s.parentNode.replaceChild(i,s),i.onclick=()=>{r.querySelectorAll(".ai-voice-btn").forEach(o=>o.classList.remove("active")),i.classList.add("active"),e(i.dataset.value)}})}function hn(){const t=document.querySelector(".ai-voice-btn.active");return t?t.dataset.value:"tutor"}function Xl(){const{section:t}=ft();t&&(t.style.display="none")}function Dn({onQuick:t,onDeep:e,onPersonaChange:r}){const{section:n,box:s}=ft();if(n&&(n.style.display=""),!s)return;const i=Wt(s,r);i.innerHTML="",s.style.display="grid";const o=document.createElement("div");o.style.cssText="text-align:center; padding:10px 0;";const a=document.createElement("h3");a.textContent="AI Analysis",a.style.cssText="margin: 0 0 16px 0; color: #334155; font-size: 1.2rem;",o.appendChild(a);const l=document.createElement("div");l.style.cssText="display:flex; justify-content:center; gap:12px; flex-wrap:wrap;";const c=document.createElement("button");c.innerHTML="‚ö° Quick Tips",c.className="ai-action-btn secondary",c.onclick=()=>{const d=hn();t&&t(d)};const u=document.createElement("button");u.innerHTML="üéì Deep Dive",u.className="ai-action-btn primary",u.onclick=()=>{const d=hn();e&&e(d)},l.appendChild(c),l.appendChild(u),o.appendChild(l),i.appendChild(o)}function Ii(){const{section:t,box:e}=ft();t&&(t.style.display="");const r=Wt(e,null);r.innerHTML=`
      <div style="text-align:center; padding: 40px 15px;">
         <div class="ai-spinner" style="font-size: 2.5rem; display:inline-block; margin-bottom:12px;">ü§ñ</div>
         <div style="font-weight:600; color:#475569; margin-bottom:10px;">Analyzing...</div>
         <div class="ai-progress"></div>
      </div>
  `}function Mn(t,e){const{section:r,box:n}=ft();r&&(r.style.display="");const s=Wt(n,null),i=t.slice(0,e),o=i.map((l,c)=>{const u=l.title||l.emoji||"",d=l.en||l.content||"",f=l.titleL1||"",h=l.l1,g=!!h;let p=`${l.emoji?`<span style="margin-right:6px;">${l.emoji}</span>`:""} ${u}`;f&&f!==u&&(p+=` ‚Äî ${f}`);let y="";return g&&(y=`
          <button class="toggle-en-btn" style="margin-top:10px;" onclick="
            const el = document.getElementById('en-block-${c}');
            el.classList.toggle('hidden');
          ">Show/Hide English</button>
          <div id="en-block-${c}" class="en-text hidden" style="margin-top:10px; padding:10px; background:#f1f5f9; border-radius:6px; font-size:0.9em;">
            <div style="font-weight:700; margin-bottom:4px; color:#334155; font-style:normal;">${u}</div>
            ${Os(d)}
          </div>
        `),`
      <div style="margin-bottom:24px; padding-bottom:16px; border-bottom:1px solid #e2e8f0;">
        <div style="font-weight:800; color:#0f766e; margin-bottom:8px; font-size:1.15em;">
           ${p}
        </div>
        <div style="color:#334155; line-height:1.6;">
           ${Os(g?h:d)}
        </div>
        ${y}
      </div>
    `}).join("");s.innerHTML=o;const a=document.createElement("div");return a.id="ai-internal-footer",a.style.marginTop="20px",a.style.textAlign="center",s.appendChild(a),{shown:i.length}}function $i({onShowMore:t,onShowLess:e,canShowMore:r,canShowLess:n,isLoading:s,lessLabel:i="Back ‚¨Ü"}){const o=document.getElementById("ai-internal-footer");if(o){if(o.innerHTML="",o.style.display="flex",o.style.justifyContent="center",o.style.gap="10px",r){const a=document.createElement("button");a.textContent=s?"Loading...":"More ‚¨á",a.className="toggle-en-btn",s||(a.onclick=t),o.appendChild(a)}{const a=document.createElement("button");a.textContent=i,a.className="toggle-en-btn",a.onclick=e,o.appendChild(a)}}}function ji(t){const{box:e}=ft(),r=Wt(e,null);r.innerHTML=`<div style="color:#c00; padding:20px;">Error: ${t}</div>`}function qn(){const{box:t}=ft(),e=Wt(t,null);e.innerHTML=""}function Os(t=""){if(!t||!t.trim())return"";let e=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>");return e.includes("- ")&&(e=e.split(`
`).map(r=>r.trim().startsWith("- ")?`<li>${r.trim().substring(2)}</li>`:r).join("<br>")),e}let fe=[],Ie=null,Ct=!1,K={azureResult:null,referenceText:"",firstLang:"universal"};function Ql(t,e,r){var i;const n=(i=t==null?void 0:t.NBest)==null?void 0:i[0],s=((t==null?void 0:t.DisplayText)||(n==null?void 0:n.Display)||"").trim();if(!n||!s){Xl();return}K={azureResult:t,referenceText:e,firstLang:r},ec(),Dn({onQuick:o=>Ut(t,e,r,o),onDeep:o=>Dt(t,e,r,o),onPersonaChange:o=>Fn(o)})}function Fn(t){if(K.azureResult&&(console.log(`[AI Logic] Persona changed to ${t}. Refreshing...`),Ie)){const{referenceText:e,firstLang:r,mode:n}=Ie;fe=[],qn(),n==="simple"?Ut(K.azureResult,e,r,t):Dt(K.azureResult,e,r,t)}}function Zl(t){if(!K.azureResult)return;console.log(`[AI Logic] Language changed to ${t}. Refreshing...`),K.firstLang=t;const e=hn();if(Ie){const{mode:r}=Ie;fe=[],qn(),r==="simple"?Ut(K.azureResult,K.referenceText,t,e):Dt(K.azureResult,K.referenceText,t,e)}else Dn({onQuick:r=>Ut(K.azureResult,K.referenceText,t,r),onDeep:r=>Dt(K.azureResult,K.referenceText,t,r),onPersonaChange:r=>Fn(r)})}function ec(){fe=[],Ct=!1,Ie=null}function Li(t){window.lastAttemptId&&bl(window.lastAttemptId,{sections:t})}async function Ut(t,e,r,n){Ii();const s=Ui(r);Ie={azureResult:t,referenceText:e,firstLang:s,persona:n,mode:"simple"};try{const i=await Ti({azureResult:t,referenceText:e,firstLang:s,mode:"simple",persona:n}),o=i.sections||i.fallbackSections||[];fe.push(o),Mn(o,o.length),$i({canShowMore:!1,canShowLess:!0,onShowLess:Bi,lessLabel:"Back to Options ‚¨Ö"}),Li(o)}catch(i){console.error(i),ji("Could not load Quick Tips.")}}async function Dt(t,e,r,n){const s=Ui(r);Ie={azureResult:t,referenceText:e,firstLang:s,persona:n,mode:"detailed"},fe=[],await Ni()}async function Ni(){if(Ct)return;const t=fe.length+1;if(!(t>3)){Ct=!0,t===1?Ii():fn();try{const e=await Ti({...Ie,chunk:t}),r=e.sections||e.fallbackSections||[];fe.push(r);const n=fe.flat();Mn(n,n.length),Li(n)}catch(e){console.error(e),ji("Could not load next section.")}finally{Ct=!1,fn()}}}function Bi(){if(fe.length>0&&fe.pop(),fe.length===0)qn(),Ie=null,Dn({onQuick:t=>Ut(K.azureResult,K.referenceText,K.firstLang,t),onDeep:t=>Dt(K.azureResult,K.referenceText,K.firstLang,t),onPersonaChange:t=>Fn(t)});else{const t=fe.flat();Mn(t,t.length),fn()}}function fn(){const t=fe.length;$i({onShowMore:()=>Ni(),onShowLess:()=>Bi(),canShowMore:t<3,canShowLess:!0,isLoading:Ct})}function Ui(t){return!t||!String(t).trim()?"universal":String(t).trim()}let Rs=!1,Di=0;const tc=800,rc=1500,nc=10;async function sc(){Oe("Recording..."),Re("recording"),Di=Date.now(),await fl(oc)?Nn("Hybrid Recording Started"):(Oe("Microphone Error"),Re("idle"))}function ic(){Date.now()-Di<rc&&(Oe("Too short! Hold button longer."),ls()),Oe("Stopping..."),Re("processing"),setTimeout(()=>{ls()},tc)}async function oc(t){var e,r;try{if(t.size<1e3){Oe("Recording too short/empty."),Re("idle");return}Re("analyzing");const n=lt.textarea?lt.textarea.value.trim():"";As();const s=document.getElementById("playbackAudio");s&&(s.src&&URL.revokeObjectURL(s.src),s.src=URL.createObjectURL(t)),window.__attachLearnerBlob&&window.__attachLearnerBlob(t),Oe("Analyzing...");const i=Ga(),o=await gl({audioBlob:t,text:n,firstLang:i});Nn("AZURE RESULT RECEIVED",o);const a=((r=(e=o==null?void 0:o.NBest)==null?void 0:e[0])==null?void 0:r.PronScore)||0;if(a<nc){console.warn("[Lux] Score too low ("+a+"%). Not saving to history."),Oe("No clear speech detected. Try again!"),Re("idle");const c=dn||window.showPrettyResults;c&&c(o);return}H&&H.length>0&&Ka(Q,o),Oe("Not recording"),Re("idle");const l=dn||window.showPrettyResults;l&&l(o),As(),cl(),await ac(o,n,i),Ql(o,n,i)}catch(n){Si("handleRecordingComplete failed",n),Oe("Error: "+(n.message||"Analysis failed")),Re("idle")}}async function ac(t,e,r){try{window.lastAttemptId=null;const n=ps&&ps(),s=Ja(),i=new Date().toISOString();if(n){const o=await yl({uid:n,passageKey:Qe,partIndex:Q,text:e,azureResult:t,l1:r,sessionId:s,localTime:i});if(o&&o.id&&(window.lastAttemptId=o.id,console.log("[Lux] Saved Attempt ID:",window.lastAttemptId),window.refreshDashboard))try{await window.refreshDashboard()}catch{}}}catch(n){console.warn("DB Save Error",n)}}function Mi(){if(Rs)return;hl({onRecord:sc,onStop:ic})&&(Re("idle"),Rs=!0,Nn("Lux Recorder (Modular) Initialized"))}const lc=Mi;let It=null,$t=null,bt=null;function Yd({learnerContainer:t,refContainer:e,masterAudio:r}){if(!window.WaveSurfer){console.warn("[Waveform] WaveSurfer.js not loaded. Check index.html.");return}bt=r,It=WaveSurfer.create({container:t,waveColor:"#2d6cdf",progressColor:"#ef4444",cursorColor:"#ef4444",cursorWidth:2,height:50,barWidth:3,barGap:1,barRadius:3,normalize:!0,interact:!1,fillParent:!0}),$t=WaveSurfer.create({container:e,waveColor:"#9ca3af",progressColor:"#4b5563",cursorColor:"#ef4444",cursorWidth:2,height:50,barWidth:3,barGap:1,barRadius:3,normalize:!0,interact:!1,fillParent:!0}),bt&&bt.addEventListener("timeupdate",()=>{const n=bt.duration;if(n>0){const s=bt.currentTime/n;It&&It.seekTo(s),$t&&$t.seekTo(s)}}),console.log("[Waveform] WaveSurfer initialized.")}function Cs(t){It&&t&&(console.log("[Waveform] Loading Learner Blob..."),It.loadBlob(t))}function Xd(t){$t&&t&&(console.log("[Waveform] Loading Reference Blob..."),$t.loadBlob(t))}function cc(){const t="playbackAudio",e="__attachLearnerBlob",r=document.getElementById(t)||(()=>{const s=document.createElement("audio");return s.id=t,s.hidden=!0,document.body.appendChild(s),s})();if(r.__sinkV7)return;r.__sinkV7=!0,r.preload="auto";const n=async(s,i)=>{var o;try{if(r.pause(),r.src=s,r.load(),document.dispatchEvent(new CustomEvent("lux:new-learner-audio",{detail:{blob:i,url:s}})),i&&Cs&&Cs(i),(o=window.LuxSelfPB)!=null&&o.setLearnerArrayBuffer){const a=await i.arrayBuffer();await window.LuxSelfPB.setLearnerArrayBuffer(a)}}catch(a){console.warn("[learner] Audio load error:",a)}};window[e]=function(i){if(!(i instanceof Blob))return;r.__blobUrl&&URL.revokeObjectURL(r.__blobUrl);const o=URL.createObjectURL(i);r.__blobUrl=o,n(o,i)},console.log("[LUX] Audio Sink initialized")}const uc="modulepreload",dc=function(t,e){return new URL(t,e).href},Is={},Hn=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){let o=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=o(r.map(u=>{if(u=dc(u,n),u in Is)return;Is[u]=!0;const d=u.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(!!n)for(let m=a.length-1;m>=0;m--){const p=a[m];if(p.href===u&&(!d||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${f}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":uc,d||(g.as="script"),g.crossOrigin="",g.href=u,c&&g.setAttribute("nonce",c),document.head.appendChild(g),d)return new Promise((m,p)=>{g.addEventListener("load",m),g.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};(()=>{const t="lux-sp-open",e=".lux-sp-panel",r=".lux-sp-body",n="selfpb-lite",s="./features/features/selfpb-peekaboo.css";let i=!1,o=!1;(function(){if(![...document.styleSheets].some(h=>(h.href||"").includes("selfpb-peekaboo.css"))){const h=document.createElement("link");h.rel="stylesheet",h.href=s,document.head.appendChild(h)}})();function a(){if(document.querySelector(e))return;const d=document.createElement("aside");d.className="lux-sp-panel",d.setAttribute("role","complementary"),d.setAttribute("aria-label","Self Playback"),d.innerHTML=`
      <button class="lux-sp-tab" type="button" aria-expanded="false" aria-controls="${n}">
        <span class="lux-sp-tab-inner">
          <span class="lux-sp-tab-label">Self Playback</span>
          <span class="lux-sp-tab-icon">‚óÄ</span>
        </span>
      </button>
      <div class="lux-sp-body">
        <div id="sp-loading-placeholder" style="padding:20px; text-align:center; color:#666; display:none;">
           Loading Waveforms... üåä
        </div>
      </div>
    `,document.body.appendChild(d),d.querySelector(".lux-sp-tab").addEventListener("click",l)}async function l(){const d=document.querySelector(e),f=d.querySelector(".lux-sp-tab"),h=document.getElementById("sp-loading-placeholder");if(document.documentElement.classList.contains(t)){u();return}if(!i){if(o)return;o=!0,h&&(h.style.display="block"),f.style.opacity="0.7";try{console.log("[Lux] Lazy-loading Self Playback...");const g=await Hn(()=>import("./ui-BVfpdDiM.js"),[],import.meta.url);g&&g.mountSelfPlaybackLite&&g.mountSelfPlaybackLite();const m=document.getElementById(n),p=d.querySelector(r);m&&p&&(m.removeAttribute("style"),m.dataset.luxHidden="0",p.contains(m)||p.appendChild(m));const y=document.getElementById("playbackAudio");y&&y.src&&y.dispatchEvent(new Event("loadedmetadata")),i=!0}catch(g){console.error("Failed to load Self Playback:",g),alert("Could not load audio tools. Please refresh.")}finally{o=!1,h&&(h.style.display="none"),f.style.opacity="1"}}c()}function c(){document.documentElement.classList.add(t);const d=document.querySelector(".lux-sp-tab");d&&d.setAttribute("aria-expanded","true")}function u(){document.documentElement.classList.remove(t);const d=document.querySelector(".lux-sp-tab");d&&d.setAttribute("aria-expanded","false")}window.luxSP=Object.assign(window.luxSP||{},{open:c,close:u,toggle:l}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a()})();const Vr=window.ADMIN_BASE||"https://luxury-language-api.vercel.app",Kr="onboarding.v2.seen",Xt="onboarding.v2.step",se=(t,e=document)=>e.querySelector(t),$s=(t,e=document)=>Array.from(e.querySelectorAll(t));function hc(){var r,n,s,i;const t=window.LUX_USER_ID||"";(r=se("#lux-uid"))==null||r.replaceChildren(document.createTextNode(t||"‚Äî"));const e=t?`?uid=${encodeURIComponent(t)}`:"";(n=se("#lux-link-attempts"))==null||n.setAttribute("href",`${Vr}/admin/user.html${e}`),(s=se("#lux-link-progress"))==null||s.setAttribute("href",`${Vr}/admin/${e}`),(i=se("#lux-link-cohort"))==null||i.setAttribute("href",`${Vr}/admin/overview.html`)}function fc(){const t=document.getElementById("referenceText");if(!t||t._placeholderWired)return;t._placeholderWired=!0;const e=()=>{document.activeElement===t||t.value.trim()?t.classList.add("placeholder-fade"):t.classList.remove("placeholder-fade")};["focus","blur","input"].forEach(r=>t.addEventListener(r,e)),e()}function pc(t){const e=$s(".ob-slide",t),r=$s(".ob-dot",t),n=se("#obPrev",t),s=se("#obNext",t),i=se("#obCloseBtn",t),o=se("#obDone",t),a=se("#obStartRecording",t),l=se("#obEnableMic",t),c=se("#obFocusText",t),u=se("#obMicStatus",t),d=se("#referenceText"),f=se("#record"),h=v=>{var w,x;e.forEach($=>$.classList.add("ob-hidden")),r.forEach($=>$.setAttribute("aria-current","false")),(w=e[v-1])==null||w.classList.remove("ob-hidden"),(x=r[v-1])==null||x.setAttribute("aria-current","true");try{localStorage.setItem(Xt,String(v))}catch{}},g=(v=1)=>{t.classList.remove("ob-hidden"),document.body.style.overflow="hidden",h(v)},m=()=>{t.classList.add("ob-hidden"),document.body.style.overflow=""};if(!(()=>{try{return localStorage.getItem(Kr)==="true"}catch{return!1}})()){let v=1;try{v=parseInt(localStorage.getItem(Xt)||"1",10)||1}catch{}g(Math.max(1,Math.min(e.length,v)))}r.forEach(v=>v.addEventListener("click",()=>h(parseInt(v.dataset.go,10)))),n==null||n.addEventListener("click",()=>h(Math.max(1,(parseInt(localStorage.getItem(Xt)||"1",10)||1)-1))),s==null||s.addEventListener("click",()=>h(Math.min(e.length,(parseInt(localStorage.getItem(Xt)||"1",10)||1)+1)));const y=()=>{try{localStorage.setItem(Kr,"true")}catch{}m()};i==null||i.addEventListener("click",y),o==null||o.addEventListener("click",y),l==null||l.addEventListener("click",async()=>{var v;if(!((v=navigator.mediaDevices)!=null&&v.getUserMedia)){u&&(u.textContent="‚ùå Mic not supported.");return}u&&(u.textContent="Requesting mic‚Ä¶");try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(x=>x.stop()),u&&(u.textContent="‚úÖ Microphone ready"),s==null||s.click()}catch{u&&(u.textContent="‚ùå Please allow mic access.")}}),c==null||c.addEventListener("click",()=>{m(),setTimeout(()=>{d==null||d.focus(),d==null||d.scrollIntoView({behavior:"smooth",block:"center"})},50)}),a==null||a.addEventListener("click",()=>{f&&!f.disabled&&f.click(),h(4)}),window.addEventListener("keydown",v=>{if(!t.classList.contains("ob-hidden")){if(v.key==="Escape"){try{localStorage.setItem(Kr,"true")}catch{}m()}v.key==="ArrowLeft"&&(n==null||n.click()),v.key==="ArrowRight"&&(s==null||s.click())}})}let js=!1;function pn(){if(js)return;js=!0,hc(),fc();const t=se("#onboardingOverlay");t&&pc(t)}window.initOnboarding=pn;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",pn,{once:!0}):pn();function wr(t){const e=Number(t);return Number.isFinite(e)?e:null}function qi(t){return(t==null?void 0:t.azureResult)||(t==null?void 0:t.azure_result)||(t==null?void 0:t.azure)||(t==null?void 0:t.result)||null}function Fi(t){return(t==null?void 0:t.summary)||(t==null?void 0:t.summary_json)||(t==null?void 0:t.sum)||null}function gc(t){return(t==null?void 0:t.passage_key)||(t==null?void 0:t.passageKey)||(t==null?void 0:t.passage)||""}function mc(t){return(t==null?void 0:t.session_id)||(t==null?void 0:t.sessionId)||""}function yc(t){return(t==null?void 0:t.ts)||(t==null?void 0:t.created_at)||(t==null?void 0:t.createdAt)||(t==null?void 0:t.time)||Date.now()}function Ls(t){const e=new Date(t);try{return e.toLocaleDateString("en-CA")}catch{}const r=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${r}-${n}-${s}`}function bc(t){var s,i;const e=Fi(t);if(e&&e.pron!=null){const o=wr(e.pron);if(o!=null)return o}const r=qi(t),n=wr((i=(s=r==null?void 0:r.NBest)==null?void 0:s[0])==null?void 0:i.PronScore);return n??0}function _r(t=[],e={}){var m;const r=Number(e.windowDays||30),n=new Map,s=new Map,i=new Map,o=new Map;let a=0,l=0,c=0;for(const p of t){const y=yc(p);a=Math.max(a,+new Date(y));const v=bc(p);l+=v,c+=1;const w=Ls(y),x=i.get(w)||{count:0,sum:0};x.count+=1,x.sum+=v,i.set(w,x);const $=mc(p)||`nosess:${w}`,I=gc(p),b=Fi(p),k=!!(b&&b.ai_feedback&&b.ai_feedback.sections&&b.ai_feedback.sections.length),E=o.get($)||{sessionId:$,passageKey:I,count:0,sumScore:0,tsMin:+new Date(y),tsMax:+new Date(y),hasAI:!1};E.count+=1,E.sumScore+=v,E.tsMin=Math.min(E.tsMin,+new Date(y)),E.tsMax=Math.max(E.tsMax,+new Date(y)),E.passageKey=E.passageKey||I,E.hasAI=E.hasAI||k,o.set($,E);const M=qi(p),C=(m=M==null?void 0:M.NBest)==null?void 0:m[0],B=Array.isArray(C==null?void 0:C.Words)?C.Words:[];for(const U of B){const L=String((U==null?void 0:U.Word)||"").trim();if(!L)continue;const pe=wr(U==null?void 0:U.AccuracyScore);if(pe!=null){const W=s.get(L)||{word:L,count:0,sum:0};W.count+=1,W.sum+=pe,s.set(L,W)}const ve=Array.isArray(U==null?void 0:U.Phonemes)?U.Phonemes:[];for(const W of ve){const Se=String((W==null?void 0:W.Phoneme)||(W==null?void 0:W.phoneme)||"").trim();if(!Se)continue;const Ze=Ue(Se);if(!Ze)continue;const Gt=wr(W==null?void 0:W.AccuracyScore);if(Gt==null)continue;const De=n.get(Ze)||{ipa:Ze,count:0,sum:0,examples:new Set};De.count+=1,De.sum+=Gt,L&&De.examples.size<4&&De.examples.add(L),n.set(Ze,De)}}}const u=Array.from(n.values()).map(p=>({ipa:p.ipa,count:p.count,avg:p.count?p.sum/p.count:0,examples:Array.from(p.examples||[]).slice(0,3)})).filter(p=>p.count>=3).sort((p,y)=>p.avg-y.avg),d=Array.from(s.values()).map(p=>({word:p.word,count:p.count,avg:p.count?p.sum/p.count:0})).filter(p=>p.count>=2).sort((p,y)=>p.avg-y.avg),f=new Date,h=[];for(let p=r-1;p>=0;p--){const y=new Date(f.getTime()-p*24*60*60*1e3),v=Ls(y),w=i.get(v);h.push({day:v,avg:w?w.sum/w.count:null})}const g=Array.from(o.values()).map(p=>({...p,avgScore:p.count?p.sumScore/p.count:0})).sort((p,y)=>y.tsMax-p.tsMax);return{totals:{attempts:t.length,sessions:o.size,lastTS:a||null,avgScore:c?l/c:0},trouble:{phonemesAll:u,wordsAll:d},trend:h,sessions:g}}const vc=[{id:"coffee",title:"Order Coffee",desc:"Quick small talk + ordering under mild time pressure.",img:"/convo-img/coffee.webp",thumb:"/convo-img/coffee.webp",video:"/convo-vid/coffee.mp4"},{id:"doctor",title:"Doctor Visit",desc:"Explain symptoms, answer follow-ups, confirm instructions.",img:"/convo-img/doctor.webp",thumb:"/convo-img/doctor.webp",video:"/convo-vid/doctor.mp4"},{id:"job",title:"Job Interview",desc:"Tell your story, strengths, and handle tricky questions.",img:"/convo-img/job.webp",thumb:"/convo-img/job.webp"},{id:"landlord",title:"Call Your Landlord",desc:"Report an issue, ask for a repair schedule, be polite.",img:"/convo-img/landlord.webp",thumb:"/convo-img/landlord.webp"},{id:"airport",title:"Airport Problem",desc:"Gate changes, delays, rebooking, and clarity under stress.",img:"/convo-img/airport.webp",thumb:"/convo-img/airport.webp"},{id:"restaurant",title:"Restaurant Order",desc:"Order, modify politely, handle a mistake, pay.",img:"/convo-img/restaurant.webp",thumb:"/convo-img/restaurant.webp"},{id:"school",title:"School Meeting",desc:"Discuss goals and progress with an advisor or teacher.",img:"/convo-img/school.webp",thumb:"/convo-img/school.webp",video:"/convo-vid/parents.mp4"},{id:"network",title:"Networking Chat",desc:"Introduce yourself, keep it natural, ask good questions.",img:"/convo-img/networking.webp",thumb:"/convo-img/networking.webp"}];function Gr(t){return t>=80?"lux-pill--blue":t>=60?"lux-pill--yellow":"lux-pill--red"}function vt(t){return`${Math.round(t)}%`}function Qt(t){return t?new Date(t).toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric"}):"‚Äî"}function Ns(t=""){const e=String(t);if(e.startsWith("convo:")){const n=e.slice(6),s=vc.find(i=>i.id===n);return s?`AI Conversation ¬∑ ${s.title}`:`AI Conversation ¬∑ ${n}`}const r=Xe==null?void 0:Xe[e];return(r==null?void 0:r.name)||e||"Practice"}function wc(t=[]){const e=t.map(d=>d&&d.avg!=null?d.avg:null).filter(d=>d!=null);if(!e.length)return'<svg class="lux-spark" viewBox="0 0 120 34" preserveAspectRatio="none"></svg>';const r=Math.min(...e),n=Math.max(...e),s=Math.max(1,n-r),i=120,o=34,a=i/Math.max(1,t.length-1),l=t.map((d,f)=>{const h=d.avg==null?null:d.avg,g=f*a,m=h==null?null:o-4-(h-r)/s*(o-8);return{x:g,y:m}});let c=o/2;const u=l.map(d=>{const f=d.y==null?c:d.y;return c=f,`${d.x.toFixed(2)},${f.toFixed(2)}`}).join(" ");return`
    <svg class="lux-spark" viewBox="0 0 ${i} ${o}" preserveAspectRatio="none">
      <polyline points="${u}" fill="none" stroke="rgba(15,23,42,0.55)" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"></polyline>
    </svg>
  `}function Bs(t,e,r){const n=new Blob([e],{type:r}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=t,document.body.appendChild(i),i.click(),i.remove(),setTimeout(()=>URL.revokeObjectURL(s),5e3)}function xr(t,e,r,n={}){const s=(r==null?void 0:r.totals)||{},i=(r==null?void 0:r.trouble)||{},o=(r==null?void 0:r.trend)||[],a=(r==null?void 0:r.sessions)||[],l=n.title||"My Progress",c=n.subtitle||"All practice (Pronunciation + AI Conversations)",u=n.showActions!==!1,d=(i.phonemesAll||[]).slice(0,12),f=(i.wordsAll||[]).slice(0,12);function h(b){return String(b??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function g(b){return(b==null?void 0:b.azureResult)||(b==null?void 0:b.azure_result)||(b==null?void 0:b.azure)||(b==null?void 0:b.result)||null}function m(b){return(b==null?void 0:b.summary)||(b==null?void 0:b.summary_json)||(b==null?void 0:b.sum)||null}function p(b){return(b==null?void 0:b.session_id)||(b==null?void 0:b.sessionId)||""}function y(b){return(b==null?void 0:b.ts)||(b==null?void 0:b.created_at)||(b==null?void 0:b.createdAt)||(b==null?void 0:b.time)||(b==null?void 0:b.localTime)||null}const v=new Map;for(const b of e||[]){const k=p(b);if(!k)continue;const E=v.get(k)||[];E.push(b),v.set(k,E)}t.innerHTML=`
    <a id="lux-my-progress"></a>
    <section class="lux-progress-shell">
      <div class="lux-progress-head">
        <div>
          <h2 class="lux-progress-title">${h(l)}</h2>
          <div class="lux-progress-sub">${h(c)}</div>
        </div>
        ${u?`
          <div class="lux-progress-actions">
            <button class="lux-pbtn" id="luxDownloadReport">Download report</button>
            <button class="lux-pbtn lux-pbtn--ghost" id="luxDownloadTrouble">Download troubleshooting report</button>
          </div>
        `:""}
      </div>

      <div class="lux-progress-cards">
        <div class="lux-pcard">
          <div class="lux-pcard-label">Sessions</div>
          <div class="lux-pcard-value">${s.sessions??0}</div>
          <div class="lux-pcard-mini">Attempts: ${s.attempts??0}</div>
        </div>

        <div class="lux-pcard">
          <div class="lux-pcard-label">Average score</div>
          <div class="lux-pcard-value">${vt(s.avgScore??0)}</div>
          <div class="lux-pcard-mini">Last activity: ${Qt(s.lastTS)}</div>
        </div>

        <div class="lux-pcard">
          <div class="lux-pcard-label">Trend (last 30 days)</div>
          ${wc(o)}
          <div class="lux-pcard-mini">Tap sections below for details</div>
        </div>
      </div>

      <details class="lux-progress-sec" open>
        <summary>üéØ Snapshot</summary>
        <div class="lux-sec-body">
          <div class="lux-grid2">
            <div class="lux-kv">
              <div class="lux-k">Best day</div>
              <div class="lux-v">${Qt(s.bestDayTS)} ¬∑ ${vt(s.bestDayScore??0)}</div>
            </div>
            <div class="lux-kv">
              <div class="lux-k">Most practiced</div>
              <div class="lux-v">${h(s.topPassage||"‚Äî")}</div>
            </div>
          </div>
        </div>
      </details>

      <details class="lux-progress-sec">
        <summary>‚ö†Ô∏è Trouble Sounds <span style="color:#94a3b8; font-weight:800">${(i.phonemesAll||[]).length}</span></summary>
        <div class="lux-sec-body">
          <div class="lux-chiprow">
            ${d.length?d.map(b=>`
              <span class="lux-chip">
                <span>${h(b.ipa)}</span>
                <span class="lux-pill ${Gr(b.avg)}">${vt(b.avg)}</span>
              </span>
            `).join(""):'<span style="color:#64748b">Not enough data yet ‚Äî keep practicing.</span>'}
          </div>
        </div>
      </details>

      <details class="lux-progress-sec">
        <summary>‚ö†Ô∏è Trouble Words <span style="color:#94a3b8; font-weight:800">${(i.wordsAll||[]).length}</span></summary>
        <div class="lux-sec-body">
          <div class="lux-chiprow">
            ${f.length?f.map(b=>`
              <span class="lux-chip">
                <span>${h(b.word)}</span>
                <span class="lux-pill ${Gr(b.avg)}">${vt(b.avg)}</span>
              </span>
            `).join(""):'<span style="color:#64748b">Not enough data yet ‚Äî keep practicing.</span>'}
          </div>
        </div>
      </details>

      <details class="lux-progress-sec">
        <summary>üïò History</summary>
        <div class="lux-sec-body">
          <div class="lux-history">
            ${a.slice(0,12).map(b=>`
              <div class="lux-hblock">
                <div class="lux-hrow" data-sid="${h(b.sessionId)}">
                  <div class="lux-hleft">
                    <div class="lux-htitle">${h(Ns(b.passageKey))}</div>
                    <div class="lux-hmeta">${Qt(b.tsMax)} ¬∑ ${b.count} attempt${b.count===1?"":"s"}${b.hasAI?" ¬∑ ü§ñ AI coaching":""}</div>
                  </div>
                  <div class="lux-hright">
                    <button class="lux-hbtn" type="button" data-sid="${h(b.sessionId)}" aria-label="Show details">üëâ</button>
                    <div class="lux-pill ${Gr(b.avgScore)}">${vt(b.avgScore)}</div>
                  </div>
                </div>
                <div class="lux-hdetail" data-sid="${h(b.sessionId)}" hidden></div>
              </div>
            `).join("")}
          </div>

          <div style="margin-top:10px; color:#64748b; font-size:0.9rem;">
            Showing your most recent sessions. Tip: click üëâ to open a saved-detail card (including any saved AI feedback).
          </div>
        </div>
      </details>
    </section>
  `;const w=new Map;t.querySelectorAll(".lux-hdetail").forEach(b=>{var k;(k=b==null?void 0:b.dataset)!=null&&k.sid&&w.set(b.dataset.sid,b)});function x(b){var E,M,C;const k=((E=b==null?void 0:b.ai_feedback)==null?void 0:E.sections)||((M=b==null?void 0:b.ai_feedback)==null?void 0:M.Sections)||((C=b==null?void 0:b.aiFeedback)==null?void 0:C.sections)||(b==null?void 0:b.sections)||[];return!Array.isArray(k)||!k.length?"":`
      <details class="lux-hdetail-ai">
        <summary>ü§ñ Saved AI feedback (${k.length})</summary>
        <div class="lux-hdetail-ai-body">
          ${k.map(B=>{const U=(B==null?void 0:B.title)||(B==null?void 0:B.heading)||"",L=(B==null?void 0:B.bullets)||(B==null?void 0:B.items)||(B==null?void 0:B.points)||[];return`
              <div class="lux-ai-sec">
                ${U?`<div class="lux-ai-sec-title">${h(U)}</div>`:""}
                ${Array.isArray(L)&&L.length?`
                  <ul class="lux-ai-bullets">
                    ${L.map(pe=>`<li>${h(pe)}</li>`).join("")}
                  </ul>
                `:""}
              </div>
            `}).join("")}
        </div>
      </details>
    `}function $(b){var ve,W;const k=g(b),E=((ve=k==null?void 0:k.NBest)==null?void 0:ve[0])||((W=k==null?void 0:k.nBest)==null?void 0:W[0])||null,M=(E==null?void 0:E.PronunciationAssessment)||(E==null?void 0:E.pronunciationAssessment)||(k==null?void 0:k.PronunciationAssessment)||null,C=[],B=(E==null?void 0:E.PronScore)??(M==null?void 0:M.PronScore),U=M==null?void 0:M.AccuracyScore,L=M==null?void 0:M.FluencyScore,pe=M==null?void 0:M.ProsodyScore;return B!=null&&C.push(`Pron ${Math.round(Number(B))}`),U!=null&&C.push(`Acc ${Math.round(Number(U))}`),L!=null&&C.push(`Flu ${Math.round(Number(L))}`),pe!=null&&C.push(`Pro ${Math.round(Number(pe))}`),C.map(Se=>`<span class="lux-mini-pill">${h(Se)}</span>`).join("")}function I(b){const k=w.get(b);if(!k)return;if(!k.hasAttribute("hidden")){k.setAttribute("hidden",""),k.innerHTML="";return}const M=(v.get(b)||[]).slice().sort((C,B)=>{const U=new Date(y(C)||0).getTime();return new Date(y(B)||0).getTime()-U});k.innerHTML=M.map(C=>{const B=y(C),U=(C==null?void 0:C.passage_key)||(C==null?void 0:C.passageKey)||(C==null?void 0:C.passage)||"",L=String(U).startsWith("convo:"),pe=m(C),ve=(C==null?void 0:C.text)||"";return`
        <div class="lux-hdetail-card">
          <div class="lux-hdetail-head">
            <div>
              <div class="lux-hdetail-title">${h(L?"Conversation sample":"Practice attempt")} ¬∑ ${Qt(B)}</div>
              <div class="lux-hdetail-sub" style="color:#64748b; font-weight:800; font-size:0.9rem;">
                ${h(Ns(U))}
              </div>
            </div>
            <div class="lux-hdetail-pills">
              ${$(C)}
            </div>
          </div>

          ${ve?`
            <details class="lux-hdetail-textwrap">
              <summary style="cursor:pointer; font-weight:900; color:#334155;">üìù Text</summary>
              <div class="lux-hdetail-text">${h(ve)}</div>
            </details>
          `:""}

          ${x(pe)}
        </div>
      `}).join(""),k.removeAttribute("hidden")}if(t.querySelectorAll(".lux-hbtn").forEach(b=>{b.addEventListener("click",k=>{k.preventDefault(),k.stopPropagation();const E=b.getAttribute("data-sid")||"";E&&I(E)})}),u){const b=document.getElementById("luxDownloadReport");b&&b.addEventListener("click",()=>{const E=`lux-progress-${new Date().toISOString().slice(0,10)}.json`;Bs(E,JSON.stringify({model:r},null,2),"application/json")});const k=document.getElementById("luxDownloadTrouble");k&&k.addEventListener("click",()=>{const E=`lux-troubleshooting-${new Date().toISOString().slice(0,10)}.json`;Bs(E,JSON.stringify({attempts:e},null,2),"application/json")})}}function _c(t){const e=document.getElementById(t);e&&(e.innerHTML=`
    <section class="lux-progress-shell">
      <div style="color:#64748b; padding: 14px 0;">Loading progress‚Ä¶</div>
    </section>
  `)}function xc(t){const e=document.getElementById("dashboard-root");e&&(e.innerHTML=`
    <section class="lux-progress-shell">
      <div class="lux-pcard">
        <div class="lux-pcard-label">Progress</div>
        <div class="lux-pcard-value">‚Äî</div>
        <div class="lux-pcard-mini" style="color:#dc2626; font-weight:800">${t}</div>
      </div>
    </section>
  `)}const Wn="dashboard-root",Sc="./progress.html";let _e=null;function Ec(t){return(t==null?void 0:t.passage_key)||(t==null?void 0:t.passageKey)||(t==null?void 0:t.passage)||""}function Hi(t){return String(Ec(t)).startsWith("convo:")}function Wi(t={}){const e=Math.round(Number(t.avgScore||0)),r=t.attempts??0,n=t.lastTS?new Date(t.lastTS):null,s=n?n.toLocaleDateString(void 0,{month:"short",day:"numeric"}):"‚Äî";return`Avg ${e}% ¬∑ Attempts ${r} ¬∑ Last ${s}`}async function zi(){const t=document.getElementById(Wn);if(!t)return;if(location.pathname.endsWith("/progress.html")||location.pathname.endsWith("progress.html"))return await Vi(t);if(_e)try{const r=Ir(),s=(await Un(r)).filter(o=>!Hi(o)),i=_r(s);_e.miniEl&&(_e.miniEl.textContent=Wi(i.totals)),_e.detailsEl&&_e.detailsEl.open&&_e.mountEl&&xr(_e.mountEl,s,i,{title:"My Progress",subtitle:"Practice Results (word + phoneme practice)",showActions:!1})}catch(r){console.error("[Dashboard] refreshHistory failed:",r),_e.miniEl&&(_e.miniEl.textContent="History unavailable")}}async function Vi(t){_c(Wn);try{const e=Ir(),r=await Un(e),n=_r(r);xr(t,r,n,{title:"My Progress",subtitle:"All practice (Pronunciation + AI Conversations)",showActions:!0})}catch(e){console.error("[Dashboard] Hub load failed:",e),String(e).includes("404")?xr(t,[],_r([]),{showActions:!0}):xc("History unavailable.")}}async function Ki(){const t=document.getElementById(Wn);if(!t)return;if(window.refreshDashboard=zi,location.pathname.endsWith("/progress.html")||location.pathname.endsWith("progress.html")){await Vi(t);return}t.innerHTML=`
    <details class="lux-progress-drawer">
      <summary class="lux-progress-drawer-summary">
        <div class="lux-progress-drawer-left">
          <div class="lux-progress-drawer-title">My Progress ¬∑ Practice Results</div>
          <div class="lux-progress-drawer-mini" data-role="mini">Tap to load</div>
        </div>
        <a class="lux-progress-drawer-link" href="${Sc}">All Data</a>
      </summary>
      <div class="lux-progress-drawer-body">
        <div class="lux-progress-drawer-mount" data-role="mount">
          <div style="color:#64748b; padding: 14px 16px;">Open to load your history.</div>
        </div>
      </div>
    </details>
  `;const r=t.querySelector("details.lux-progress-drawer"),n=t.querySelector('[data-role="mini"]'),s=t.querySelector('[data-role="mount"]');_e={detailsEl:r,miniEl:n,mountEl:s};let i=!1;async function o(){if(!i){i=!0,s&&(s.innerHTML='<div style="color:#64748b; padding: 14px 16px;">Loading‚Ä¶</div>');try{const a=Ir(),c=(await Un(a)).filter(d=>!Hi(d)),u=_r(c);n&&(n.textContent=Wi(u.totals)),s&&xr(s,c,u,{title:"My Progress",subtitle:"Practice Results (word + phoneme practice)",showActions:!1})}catch(a){console.error("[Dashboard] Drawer load failed:",a),i=!1,n&&(n.textContent="History unavailable"),s&&(s.innerHTML='<div style="color:#ef4444; padding: 14px 16px;">History unavailable.</div>')}}}r&&r.addEventListener("toggle",()=>{r.open&&o()})}const kc=Object.freeze(Object.defineProperty({__proto__:null,initDashboard:Ki,refreshHistory:zi},Symbol.toStringTag,{value:"Module"}));function Tc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function zt(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var s=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return t[n]}})}),r}var ke={},Zt={},gn=function(t,e){return gn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},gn(t,e)};function Gi(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");gn(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Sr=function(){return Sr=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Sr.apply(this,arguments)};function pt(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function Ji(t,e,r,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(s<3?o(i):s>3?o(e,r,i):o(e,r))||i);return s>3&&i&&Object.defineProperty(e,r,i),i}function Yi(t,e){return function(r,n){e(r,n,t)}}function Xi(t,e,r,n,s,i){function o(y){if(y!==void 0&&typeof y!="function")throw new TypeError("Function expected");return y}for(var a=n.kind,l=a==="getter"?"get":a==="setter"?"set":"value",c=!e&&t?n.static?t:t.prototype:null,u=e||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),d,f=!1,h=r.length-1;h>=0;h--){var g={};for(var m in n)g[m]=m==="access"?{}:n[m];for(var m in n.access)g.access[m]=n.access[m];g.addInitializer=function(y){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(y||null))};var p=(0,r[h])(a==="accessor"?{get:u.get,set:u.set}:u[l],g);if(a==="accessor"){if(p===void 0)continue;if(p===null||typeof p!="object")throw new TypeError("Object expected");(d=o(p.get))&&(u.get=d),(d=o(p.set))&&(u.set=d),(d=o(p.init))&&s.unshift(d)}else(d=o(p))&&(a==="field"?s.unshift(d):u[l]=d)}c&&Object.defineProperty(c,n.name,u),f=!0}function Qi(t,e,r){for(var n=arguments.length>2,s=0;s<e.length;s++)r=n?e[s].call(t,r):e[s].call(t);return n?r:void 0}function Zi(t){return typeof t=="symbol"?t:"".concat(t)}function eo(t,e,r){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:r?"".concat(r," ",e):e})}function to(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function _(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})}function ro(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(r=0)),r;)try{if(n=1,s&&(i=c[0]&2?s.return:c[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,c[1])).done)return i;switch(s=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,s=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){r.label=c[1];break}if(c[0]===6&&r.label<i[1]){r.label=i[1],i=c;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(c);break}i[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(u){c=[6,u],s=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var $r=Object.create?(function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]});function no(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&$r(e,t,r)}function Er(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zn(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function so(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(zn(arguments[e]));return t}function io(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),s=0,e=0;e<r;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function oo(t,e,r){if(r||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}function ut(t){return this instanceof ut?(this.v=t,this):new ut(t)}function ao(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(h){return function(g){return Promise.resolve(g).then(h,d)}}function a(h,g){n[h]&&(s[h]=function(m){return new Promise(function(p,y){i.push([h,m,p,y])>1||l(h,m)})},g&&(s[h]=g(s[h])))}function l(h,g){try{c(n[h](g))}catch(m){f(i[0][3],m)}}function c(h){h.value instanceof ut?Promise.resolve(h.value.v).then(u,d):f(i[0][2],h)}function u(h){l("next",h)}function d(h){l("throw",h)}function f(h,g){h(g),i.shift(),i.length&&l(i[0][0],i[0][1])}}function lo(t){var e,r;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=t[s]?function(o){return(r=!r)?{value:ut(t[s](o)),done:!1}:i?i(o):o}:i}}function co(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Er=="function"?Er(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(o){return new Promise(function(a,l){o=t[i](o),s(a,l,o.done,o.value)})}}function s(i,o,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},o)}}function uo(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var Ac=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},mn=function(t){return mn=Object.getOwnPropertyNames||function(e){var r=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[r.length]=n);return r},mn(t)};function ho(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r=mn(t),n=0;n<r.length;n++)r[n]!=="default"&&$r(e,t,r[n]);return Ac(e,t),e}function fo(t){return t&&t.__esModule?t:{default:t}}function po(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function go(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r}function mo(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function yo(t,e,r){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],r&&(s=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),t.stack.push({value:e,dispose:n,async:r})}else r&&t.stack.push({async:!0});return e}var Pc=typeof SuppressedError=="function"?SuppressedError:function(t,e,r){var n=new Error(r);return n.name="SuppressedError",n.error=t,n.suppressed=e,n};function bo(t){function e(i){t.error=t.hasError?new Pc(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}var r,n=0;function s(){for(;r=t.stack.pop();)try{if(!r.async&&n===1)return n=0,t.stack.push(r),Promise.resolve().then(s);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(s,function(o){return e(o),s()})}else n|=1}catch(o){e(o)}if(n===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}function vo(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,s,i,o){return n?e?".jsx":".js":s&&(!i||!o)?r:s+i+"."+o.toLowerCase()+"js"}):t}const Oc={__extends:Gi,__assign:Sr,__rest:pt,__decorate:Ji,__param:Yi,__esDecorate:Xi,__runInitializers:Qi,__propKey:Zi,__setFunctionName:eo,__metadata:to,__awaiter:_,__generator:ro,__createBinding:$r,__exportStar:no,__values:Er,__read:zn,__spread:so,__spreadArrays:io,__spreadArray:oo,__await:ut,__asyncGenerator:ao,__asyncDelegator:lo,__asyncValues:co,__makeTemplateObject:uo,__importStar:ho,__importDefault:fo,__classPrivateFieldGet:po,__classPrivateFieldSet:go,__classPrivateFieldIn:mo,__addDisposableResource:yo,__disposeResources:bo,__rewriteRelativeImportExtension:vo},Rc=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:yo,get __assign(){return Sr},__asyncDelegator:lo,__asyncGenerator:ao,__asyncValues:co,__await:ut,__awaiter:_,__classPrivateFieldGet:po,__classPrivateFieldIn:mo,__classPrivateFieldSet:go,__createBinding:$r,__decorate:Ji,__disposeResources:bo,__esDecorate:Xi,__exportStar:no,__extends:Gi,__generator:ro,__importDefault:fo,__importStar:ho,__makeTemplateObject:uo,__metadata:to,__param:Yi,__propKey:Zi,__read:zn,__rest:pt,__rewriteRelativeImportExtension:vo,__runInitializers:Qi,__setFunctionName:eo,__spread:so,__spreadArray:oo,__spreadArrays:io,__values:Er,default:Oc},Symbol.toStringTag,{value:"Module"})),Cc=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);let jr=class extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}},wo=class extends jr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}},yn=class extends jr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}},bn=class extends jr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}};var kr;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(kr||(kr={}));class Ic{constructor(e,{headers:r={},customFetch:n,region:s=kr.Any}={}){this.url=e,this.headers=r,this.region=s,this.fetch=Cc(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return _(this,arguments,void 0,function*(r,n={}){var s;let i,o;try{const{headers:a,method:l,body:c,signal:u,timeout:d}=n;let f={},{region:h}=n;h||(h=this.region);const g=new URL(`${this.url}/${r}`);h&&h!=="any"&&(f["x-region"]=h,g.searchParams.set("forceFunctionRegion",h));let m;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",m=c):typeof c=="string"?(f["Content-Type"]="text/plain",m=c):typeof FormData<"u"&&c instanceof FormData?m=c:(f["Content-Type"]="application/json",m=JSON.stringify(c)):m=c;let p=u;d&&(o=new AbortController,i=setTimeout(()=>o.abort(),d),u?(p=o.signal,u.addEventListener("abort",()=>o.abort())):p=o.signal);const y=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),a),body:m,signal:p}).catch($=>{throw new wo($)}),v=y.headers.get("x-relay-error");if(v&&v==="true")throw new yn(y);if(!y.ok)throw new bn(y);let w=((s=y.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),x;return w==="application/json"?x=yield y.json():w==="application/octet-stream"||w==="application/pdf"?x=yield y.blob():w==="text/event-stream"?x=y:w==="multipart/form-data"?x=yield y.formData():x=yield y.text(),{data:x,error:null,response:y}}catch(a){return{data:null,error:a,response:a instanceof bn||a instanceof yn?a.context:void 0}}finally{i&&clearTimeout(i)}})}}const $c=Object.freeze(Object.defineProperty({__proto__:null,get FunctionRegion(){return kr},FunctionsClient:Ic,FunctionsError:jr,FunctionsFetchError:wo,FunctionsHttpError:bn,FunctionsRelayError:yn},Symbol.toStringTag,{value:"Module"})),_o=zt($c);var te={};const gt=zt(Rc);var er={},tr={},rr={},nr={},sr={},ir={},Us;function xo(){if(Us)return ir;Us=1,Object.defineProperty(ir,"__esModule",{value:!0});class t extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return ir.default=t,ir}var Ds;function So(){if(Ds)return sr;Ds=1,Object.defineProperty(sr,"__esModule",{value:!0});const e=gt.__importDefault(xo());let r=class{constructor(s){var i,o;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(i=s.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=s.signal,this.isMaybeSingle=(o=s.isMaybeSingle)!==null&&o!==void 0?o:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=new Headers(this.headers),this.headers.set(s,i),this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let a=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var c,u,d,f;let h=null,g=null,m=null,p=l.status,y=l.statusText;if(l.ok){if(this.method!=="HEAD"){const $=await l.text();$===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((c=this.headers.get("Accept"))===null||c===void 0)&&c.includes("application/vnd.pgrst.plan+text"))?g=$:g=JSON.parse($))}const w=(u=this.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(d=l.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");w&&x&&x.length>1&&(m=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(h={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,m=null,p=406,y="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const w=await l.text();try{h=JSON.parse(w),Array.isArray(h)&&l.status===404&&(g=[],h=null,p=200,y="OK")}catch{l.status===404&&w===""?(p=204,y="No Content"):h={message:w}}if(h&&this.isMaybeSingle&&(!((f=h==null?void 0:h.details)===null||f===void 0)&&f.includes("0 rows"))&&(h=null,p=200,y="OK"),h&&this.shouldThrowOnError)throw new e.default(h)}return{error:h,data:g,count:m,status:p,statusText:y}});return this.shouldThrowOnError||(a=a.catch(l=>{var c,u,d,f,h,g;let m="";const p=l==null?void 0:l.cause;if(p){const y=(c=p==null?void 0:p.message)!==null&&c!==void 0?c:"",v=(u=p==null?void 0:p.code)!==null&&u!==void 0?u:"";m=`${(d=l==null?void 0:l.name)!==null&&d!==void 0?d:"FetchError"}: ${l==null?void 0:l.message}`,m+=`

Caused by: ${(f=p==null?void 0:p.name)!==null&&f!==void 0?f:"Error"}: ${y}`,v&&(m+=` (${v})`),p!=null&&p.stack&&(m+=`
${p.stack}`)}else m=(h=l==null?void 0:l.stack)!==null&&h!==void 0?h:"";return{error:{message:`${(g=l==null?void 0:l.name)!==null&&g!==void 0?g:"FetchError"}: ${l==null?void 0:l.message}`,details:m,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),a.then(s,i)}returns(){return this}overrideTypes(){return this}};return sr.default=r,sr}var Ms;function Eo(){if(Ms)return nr;Ms=1,Object.defineProperty(nr,"__esModule",{value:!0});const e=gt.__importDefault(So());let r=class extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${f}"; options=${d};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}};return nr.default=r,nr}var qs;function Vn(){if(qs)return rr;qs=1,Object.defineProperty(rr,"__esModule",{value:!0});const e=gt.__importDefault(Eo()),r=new RegExp("[,()]");let n=class extends e.default{eq(i,o){return this.url.searchParams.append(i,`eq.${o}`),this}neq(i,o){return this.url.searchParams.append(i,`neq.${o}`),this}gt(i,o){return this.url.searchParams.append(i,`gt.${o}`),this}gte(i,o){return this.url.searchParams.append(i,`gte.${o}`),this}lt(i,o){return this.url.searchParams.append(i,`lt.${o}`),this}lte(i,o){return this.url.searchParams.append(i,`lte.${o}`),this}like(i,o){return this.url.searchParams.append(i,`like.${o}`),this}likeAllOf(i,o){return this.url.searchParams.append(i,`like(all).{${o.join(",")}}`),this}likeAnyOf(i,o){return this.url.searchParams.append(i,`like(any).{${o.join(",")}}`),this}ilike(i,o){return this.url.searchParams.append(i,`ilike.${o}`),this}ilikeAllOf(i,o){return this.url.searchParams.append(i,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(i,o){return this.url.searchParams.append(i,`ilike(any).{${o.join(",")}}`),this}regexMatch(i,o){return this.url.searchParams.append(i,`match.${o}`),this}regexIMatch(i,o){return this.url.searchParams.append(i,`imatch.${o}`),this}is(i,o){return this.url.searchParams.append(i,`is.${o}`),this}isDistinct(i,o){return this.url.searchParams.append(i,`isdistinct.${o}`),this}in(i,o){const a=Array.from(new Set(o)).map(l=>typeof l=="string"&&r.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(i,`in.(${a})`),this}contains(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cs.{${o.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(o)}`),this}containedBy(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cd.{${o.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(o)}`),this}rangeGt(i,o){return this.url.searchParams.append(i,`sr.${o}`),this}rangeGte(i,o){return this.url.searchParams.append(i,`nxl.${o}`),this}rangeLt(i,o){return this.url.searchParams.append(i,`sl.${o}`),this}rangeLte(i,o){return this.url.searchParams.append(i,`nxr.${o}`),this}rangeAdjacent(i,o){return this.url.searchParams.append(i,`adj.${o}`),this}overlaps(i,o){return typeof o=="string"?this.url.searchParams.append(i,`ov.${o}`):this.url.searchParams.append(i,`ov.{${o.join(",")}}`),this}textSearch(i,o,{config:a,type:l}={}){let c="";l==="plain"?c="pl":l==="phrase"?c="ph":l==="websearch"&&(c="w");const u=a===void 0?"":`(${a})`;return this.url.searchParams.append(i,`${c}fts${u}.${o}`),this}match(i){return Object.entries(i).forEach(([o,a])=>{this.url.searchParams.append(o,`eq.${a}`)}),this}not(i,o,a){return this.url.searchParams.append(i,`not.${o}.${a}`),this}or(i,{foreignTable:o,referencedTable:a=o}={}){const l=a?`${a}.or`:"or";return this.url.searchParams.append(l,`(${i})`),this}filter(i,o,a){return this.url.searchParams.append(i,`${o}.${a}`),this}};return rr.default=n,rr}var Fs;function ko(){if(Fs)return tr;Fs=1,Object.defineProperty(tr,"__esModule",{value:!0});const e=gt.__importDefault(Vn());let r=class{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=new Headers(i),this.schema=o,this.fetch=a}select(s,i){const{head:o=!1,count:a}=i??{},l=o?"HEAD":"GET";let c=!1;const u=(s??"*").split("").map(d=>/\s/.test(d)&&!c?"":(d==='"'&&(c=!c),d)).join("");return this.url.searchParams.set("select",u),a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:i,defaultToNull:o=!0}={}){var a;const l="POST";if(i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){var c;const u="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),a&&this.headers.append("Prefer",`count=${a}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const d=s.reduce((f,h)=>f.concat(Object.keys(h)),[]);if(d.length>0){const f=[...new Set(d)].map(h=>`"${h}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(s,{count:i}={}){var o;const a="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:s}={}){var i;const o="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};return tr.default=r,tr}var Hs;function jc(){if(Hs)return er;Hs=1,Object.defineProperty(er,"__esModule",{value:!0});const t=gt,e=t.__importDefault(ko()),r=t.__importDefault(Vn());let n=class To{constructor(i,{headers:o={},schema:a,fetch:l}={}){this.url=i,this.headers=new Headers(o),this.schemaName=a,this.fetch=l}from(i){if(!i||typeof i!="string"||i.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const o=new URL(`${this.url}/${i}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new To(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,o={},{head:a=!1,get:l=!1,count:c}={}){var u;let d;const f=new URL(`${this.url}/rpc/${i}`);let h;a||l?(d=a?"HEAD":"GET",Object.entries(o).filter(([m,p])=>p!==void 0).map(([m,p])=>[m,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([m,p])=>{f.searchParams.append(m,p)})):(d="POST",h=o);const g=new Headers(this.headers);return c&&g.set("Prefer",`count=${c}`),new r.default({method:d,url:f,headers:g,schema:this.schemaName,body:h,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}};return er.default=n,er}var Ws;function Ao(){if(Ws)return te;Ws=1,Object.defineProperty(te,"__esModule",{value:!0}),te.PostgrestError=te.PostgrestBuilder=te.PostgrestTransformBuilder=te.PostgrestFilterBuilder=te.PostgrestQueryBuilder=te.PostgrestClient=void 0;const t=gt,e=t.__importDefault(jc());te.PostgrestClient=e.default;const r=t.__importDefault(ko());te.PostgrestQueryBuilder=r.default;const n=t.__importDefault(Vn());te.PostgrestFilterBuilder=n.default;const s=t.__importDefault(Eo());te.PostgrestTransformBuilder=s.default;const i=t.__importDefault(So());te.PostgrestBuilder=i.default;const o=t.__importDefault(xo());return te.PostgrestError=o.default,te.default={PostgrestClient:e.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},te}class Po{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const n=this.getWebSocketConstructor();return new n(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Lc="2.87.1",Nc=`realtime-js/${Lc}`,Oo="1.0.0",Bc="2.0.0",zs=Oo,vn=1e4,Uc=1e3,Dc=100;var ze;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(ze||(ze={}));var z;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(z||(z={}));var ye;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ye||(ye={}));var wn;(function(t){t.websocket="websocket"})(wn||(wn={}));var Ve;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Ve||(Ve={}));class Mc{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,n;const s=(n=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var r,n;const s=(n=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,r,n){var s,i;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",c=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},d=Object.keys(u).length===0?"":JSON.stringify(u);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`metadata length ${d.length} exceeds maximum of 255`);const f=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+d.length,h=new ArrayBuffer(this.HEADER_LENGTH+f);let g=new DataView(h),m=0;g.setUint8(m++,this.KINDS.userBroadcastPush),g.setUint8(m++,l.length),g.setUint8(m++,a.length),g.setUint8(m++,o.length),g.setUint8(m++,c.length),g.setUint8(m++,d.length),g.setUint8(m++,r),Array.from(l,y=>g.setUint8(m++,y.charCodeAt(0))),Array.from(a,y=>g.setUint8(m++,y.charCodeAt(0))),Array.from(o,y=>g.setUint8(m++,y.charCodeAt(0))),Array.from(c,y=>g.setUint8(m++,y.charCodeAt(0))),Array.from(d,y=>g.setUint8(m++,y.charCodeAt(0)));var p=new Uint8Array(h.byteLength+n.byteLength);return p.set(new Uint8Array(h),0),p.set(new Uint8Array(n),h.byteLength),p.buffer}decode(e,r){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return r(n)}if(typeof e=="string"){const n=JSON.parse(e),[s,i,o,a,l]=n;return r({join_ref:s,ref:i,topic:o,event:a,payload:l})}return r({})}_binaryDecode(e){const r=new DataView(e),n=r.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,r,s)}}_decodeUserBroadcast(e,r,n){const s=r.getUint8(1),i=r.getUint8(2),o=r.getUint8(3),a=r.getUint8(4);let l=this.HEADER_LENGTH+4;const c=n.decode(e.slice(l,l+s));l=l+s;const u=n.decode(e.slice(l,l+i));l=l+i;const d=n.decode(e.slice(l,l+o));l=l+o;const f=e.slice(l,e.byteLength),h=a===this.JSON_ENCODING?JSON.parse(n.decode(f)):f,g={type:this.BROADCAST_EVENT,event:u,payload:h};return o>0&&(g.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e==null?void 0:e.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>r.includes(n)))}}class Ro{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var D;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(D||(D={}));const Vs=(t,e,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=qc(o,t,e,s),i),{}):{}},qc=(t,e,r,n)=>{const s=e.find(a=>a.name===t),i=s==null?void 0:s.type,o=r[t];return i&&!n.includes(i)?Co(i,o):_n(o)},Co=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return zc(e,r)}switch(t){case D.bool:return Fc(e);case D.float4:case D.float8:case D.int2:case D.int4:case D.int8:case D.numeric:case D.oid:return Hc(e);case D.json:case D.jsonb:return Wc(e);case D.timestamp:return Vc(e);case D.abstime:case D.date:case D.daterange:case D.int4range:case D.int8range:case D.money:case D.reltime:case D.text:case D.time:case D.timestamptz:case D.timetz:case D.tsrange:case D.tstzrange:return _n(e);default:return _n(e)}},_n=t=>t,Fc=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Hc=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Wc=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},zc=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let i;const o=t.slice(1,r);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Co(e,a))}return t},Vc=t=>typeof t=="string"?t.replace(" ","T"):t,Io=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Jr{constructor(e,r,n={},s=vn){this.channel=e,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var xn;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(xn||(xn={}));let $o=class pr{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=pr.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=pr.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=pr.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,s){const i=this.cloneDeep(e),o=this.transformState(r),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=i[c];if(d){const f=u.map(p=>p.presence_ref),h=d.map(p=>p.presence_ref),g=u.filter(p=>h.indexOf(p.presence_ref)<0),m=d.filter(p=>f.indexOf(p.presence_ref)<0);g.length>0&&(a[c]=g),m.length>0&&(l[c]=m)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},n,s)}static syncDiff(e,r,n,s){const{joins:i,leaves:o}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(h=>h.presence_ref),f=u.filter(h=>d.indexOf(h.presence_ref)<0);e[a].unshift(...f)}n(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const s=e[n];return"metas"in s?r[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):r[n]=s,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var Sn;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Sn||(Sn={}));var ot;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(ot||(ot={}));var xe;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(xe||(xe={}));const Kc=z;let jo=class St{constructor(e,r={config:{}},n){var s,i;if(this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=z.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Jr(this,ye.join,this.params,this.timeout),this.rejoinTimer=new Ro(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=z.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=z.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ye.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new $o(this),this.broadcastEndpointURL=Io(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==z.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(h=>h.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[ot.PRESENCE]&&this.bindings[ot.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,d={},f={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(h=>e==null?void 0:e(xe.CHANNEL_ERROR,h)),this._onClose(()=>e==null?void 0:e(xe.CLOSED)),this.updateJoinPayload(Object.assign({config:f},d)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:h})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),h===void 0){e==null||e(xe.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,p=(g=m==null?void 0:m.length)!==null&&g!==void 0?g:0,y=[];for(let v=0;v<p;v++){const w=m[v],{filter:{event:x,schema:$,table:I,filter:b}}=w,k=h&&h[v];if(k&&k.event===x&&St.isFilterValueEqual(k.schema,$)&&St.isFilterValueEqual(k.table,I)&&St.isFilterValueEqual(k.filter,b))y.push(Object.assign(Object.assign({},w),{id:k.id}));else{this.unsubscribe(),this.state=z.errored,e==null||e(xe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(xe.SUBSCRIBED);return}}).receive("error",h=>{this.state=z.errored,e==null||e(xe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(xe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this.state===z.joined&&e===ot.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,n)}async httpSend(e,r,n={}){var s;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,r={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=z.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ye.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Jr(this,ye.leave,{},e),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=z.closed,this.bindings={}}async _fetchWithTimeout(e,r,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(i),o}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Jr(this,e,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Dc){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=ye;if(n&&[a,l,c,u].indexOf(o)>=0&&n!==this._joinRef())return;let f=this._onMessage(o,r,n);if(r&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(h=>{var g,m,p;return((g=h.filter)===null||g===void 0?void 0:g.event)==="*"||((p=(m=h.filter)===null||m===void 0?void 0:m.event)===null||p===void 0?void 0:p.toLocaleLowerCase())===o}).map(h=>h.callback(f,n)):(i=this.bindings[o])===null||i===void 0||i.filter(h=>{var g,m,p,y,v,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in h){const x=h.id,$=(g=h.filter)===null||g===void 0?void 0:g.event;return x&&((m=r.ids)===null||m===void 0?void 0:m.includes(x))&&($==="*"||($==null?void 0:$.toLocaleLowerCase())===((p=r.data)===null||p===void 0?void 0:p.type.toLocaleLowerCase()))}else{const x=(v=(y=h==null?void 0:h.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return x==="*"||x===((w=r==null?void 0:r.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===o}).map(h=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:m,table:p,commit_timestamp:y,type:v,errors:w}=g;f=Object.assign(Object.assign({},{schema:m,table:p,commit_timestamp:y,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(g))}h.callback(f,n)})}_isClosed(){return this.state===z.closed}_isJoined(){return this.state===z.joined}_isJoining(){return this.state===z.joining}_isLeaving(){return this.state===z.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const s=e.toLocaleLowerCase(),i={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&St.isEqual(s.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ye.close,{},e)}_onError(e){this._on(ye.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=z.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=Vs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=Vs(e.columns,e.old_record)),r}};const Yr=()=>{},or={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Gc=[1e3,2e3,5e3,1e4],Jc=1e4,Yc=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;let Xc=class{constructor(e,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=vn,this.transport=null,this.heartbeatIntervalMs=or.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Yr,this.ref=0,this.reconnectTimer=null,this.vsn=zs,this.logger=Yr,this.conn=null,this.sendBuffer=[],this.serializer=new Mc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${wn.websocket}`,this.httpEndpoint=Io(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Po.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case ze.connecting:return Ve.Connecting;case ze.open:return Ve.Open;case ze.closing:return Ve.Closing;default:return Ve.Closed}}isConnected(){return this.connectionState()===Ve.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new jo(`realtime:${e}`,r,this);return this.channels.push(i),i}}push(e){const{topic:r,event:n,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Uc,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},or.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:i,ref:o}=r,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${s} ${a}`.trim(),i),this.channels.filter(c=>c._isMember(n)).forEach(c=>c._trigger(s,i,o)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===ze.open||this.conn.readyState===ze.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ye.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${e}${n}${s}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([Yc],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,n=!1;if(e)r=e,n=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),r=this.accessTokenValue}else r=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(s=>{const i={access_token:r,version:Nc};r&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(ye.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Ro(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},or.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,n,s,i,o,a,l,c,u,d,f,h;switch(this.transport=(r=e==null?void 0:e.transport)!==null&&r!==void 0?r:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:vn,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:or.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:Yr,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:zs,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:(g=>Gc[g-1]||Jc),this.vsn){case Oo:this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:((g,m)=>m(JSON.stringify(g))),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:((g,m)=>m(JSON.parse(g)));break;case Bc:this.encode=(f=e==null?void 0:e.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}};const Qc=Object.freeze(Object.defineProperty({__proto__:null,REALTIME_CHANNEL_STATES:Kc,get REALTIME_LISTEN_TYPES(){return ot},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return Sn},get REALTIME_PRESENCE_LISTEN_EVENTS(){return xn},get REALTIME_SUBSCRIBE_STATES(){return xe},RealtimeChannel:jo,RealtimeClient:Xc,RealtimePresence:$o,WebSocketFactory:Po},Symbol.toStringTag,{value:"Module"})),Lo=zt(Qc);class Vt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function F(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class No extends Vt{constructor(e,r,n){super(e),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Tr extends Vt{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}const Kn=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Zc=()=>Response,En=t=>{if(Array.isArray(t))return t.map(r=>En(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=En(n)}),e},eu=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},tu=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t),Xr=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},ru=(t,e,r)=>_(void 0,void 0,void 0,function*(){const n=yield Zc();t instanceof n&&!(r!=null&&r.noResolveJson)?t.json().then(s=>{const i=t.status||500,o=(s==null?void 0:s.statusCode)||i+"";e(new No(Xr(s),i,o))}).catch(s=>{e(new Tr(Xr(s),s))}):e(new Tr(Xr(t),t))}),nu=(t,e,r,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!n?s:(eu(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,e!=null&&e.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),r))};function Kt(t,e,r,n,s,i){return _(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(r,nu(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>ru(l,a,n))})})}function Mt(t,e,r,n){return _(this,void 0,void 0,function*(){return Kt(t,"GET",e,r,n)})}function me(t,e,r,n,s){return _(this,void 0,void 0,function*(){return Kt(t,"POST",e,n,s,r)})}function kn(t,e,r,n,s){return _(this,void 0,void 0,function*(){return Kt(t,"PUT",e,n,s,r)})}function su(t,e,r,n){return _(this,void 0,void 0,function*(){return Kt(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function Gn(t,e,r,n,s){return _(this,void 0,void 0,function*(){return Kt(t,"DELETE",e,n,s,r)})}class iu{constructor(e,r){this.downloadFn=e,this.shouldThrowOnError=r}then(e,r){return this.execute().then(e,r)}execute(){return _(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(F(e))return{data:null,error:e};throw e}})}}var Bo;class ou{constructor(e,r){this.downloadFn=e,this.shouldThrowOnError=r,this[Bo]="BlobDownloadBuilder",this.promise=null}asStream(){return new iu(this.downloadFn,this.shouldThrowOnError)}then(e,r){return this.getPromise().then(e,r)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return _(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(F(e))return{data:null,error:e};throw e}})}}Bo=Symbol.toStringTag;const au={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ks={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class lu{constructor(e,r={},n,s){this.shouldThrowOnError=!1,this.url=e,this.headers=r,this.bucketId=n,this.fetch=Kn(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,r,n,s){return _(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ks),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),s!=null&&s.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(r),u=this._getFinalPath(c),d=yield(e=="PUT"?kn:me)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(F(i))return{data:null,error:i};throw i}})}upload(e,r,n){return _(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,s){return _(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",r);try{let l;const c=Object.assign({upsert:Ks.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield kn(this.fetch,a.toString(),l,{headers:u});return{data:{path:i,fullPath:d.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(F(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,r){return _(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);r!=null&&r.upsert&&(s["x-upsert"]="true");const i=yield me(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Vt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(F(n))return{data:null,error:n};throw n}})}update(e,r,n){return _(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return _(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(F(s))return{data:null,error:s};throw s}})}copy(e,r,n){return _(this,void 0,void 0,function*(){try{return{data:{path:(yield me(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(F(s))return{data:null,error:s};throw s}})}createSignedUrl(e,r,n){return _(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield me(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(F(s))return{data:null,error:s};throw s}})}createSignedUrls(e,r,n){return _(this,void 0,void 0,function*(){try{const s=yield me(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(F(s))return{data:null,error:s};throw s}})}download(e,r){const s=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),o=i?`?${i}`:"",a=this._getFinalPath(e),l=()=>Mt(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new ou(l,this.shouldThrowOnError)}info(e){return _(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield Mt(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:En(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(F(n))return{data:null,error:n};throw n}})}exists(e){return _(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield su(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(F(n)&&n instanceof Tr){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),s=[],i=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";i!==""&&s.push(i);const a=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return _(this,void 0,void 0,function*(){try{return{data:yield Gn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(F(r))return{data:null,error:r};throw r}})}list(e,r,n){return _(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},au),r),{prefix:e||""});return{data:yield me(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(F(s))return{data:null,error:s};throw s}})}listV2(e,r){return _(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield me(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(F(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const Uo="2.87.1",Do={"X-Client-Info":`storage-js/${Uo}`};class cu{constructor(e,r={},n,s){this.shouldThrowOnError=!1;const i=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Do),r),this.fetch=Kn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return _(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(e);return{data:yield Mt(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(F(r))return{data:null,error:r};throw r}})}getBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield Mt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(F(r))return{data:null,error:r};throw r}})}createBucket(e){return _(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield me(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(F(s))return{data:null,error:s};throw s}})}updateBucket(e,r){return _(this,void 0,void 0,function*(){try{return{data:yield kn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(F(n))return{data:null,error:n};throw n}})}emptyBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(F(r))return{data:null,error:r};throw r}})}deleteBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield Gn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(F(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(e){const r={};return e&&("limit"in e&&(r.limit=String(e.limit)),"offset"in e&&(r.offset=String(e.offset)),e.search&&(r.search=e.search),e.sortColumn&&(r.sortColumn=e.sortColumn),e.sortOrder&&(r.sortOrder=e.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}var qt=class extends Error{constructor(t,e){var r;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((r=e.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function uu(t,e,r){const n=new URL(e,t);if(r)for(const[s,i]of Object.entries(r))i!==void 0&&n.searchParams.set(s,i);return n.toString()}async function du(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function hu(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:s,body:i,headers:o}){const a=uu(t.baseUrl,n,s),l=await du(t.auth),c=await e(a,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),u=await c.text(),d=(c.headers.get("content-type")||"").includes("application/json"),f=d&&u?JSON.parse(u):u;if(!c.ok){const h=d?f:void 0,g=h==null?void 0:h.error;throw new qt((g==null?void 0:g.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:g==null?void 0:g.type,icebergCode:g==null?void 0:g.code,details:h})}return{status:c.status,headers:c.headers,data:f}}}}function ar(t){return t.join("")}var fu=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:ar(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ar(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ar(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ar(t.namespace)}`}),!0}catch(e){if(e instanceof qt&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof qt&&r.status===409)return;throw r}}};function et(t){return t.join("")}var pu=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${et(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${et(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${et(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${et(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${et(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${et(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof qt&&r.status===404)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof qt&&r.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},gu=class{constructor(t){var n;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const r=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=hu({baseUrl:r,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(n=t.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new fu(this.client,e),this.tableOps=new pu(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}};class Mo{constructor(e,r={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Do),r),this.fetch=Kn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(F(r))return{data:null,error:r};throw r}})}listBuckets(e){return _(this,void 0,void 0,function*(){try{const r=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&r.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&r.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&r.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&r.set("sortOrder",e.sortOrder),e!=null&&e.search&&r.set("search",e.search);const n=r.toString(),s=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield Mt(this.fetch,s,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(F(r))return{data:null,error:r};throw r}})}deleteBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield Gn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(F(r))return{data:null,error:r};throw r}})}from(e){if(!tu(e))throw new Vt("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new gu({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:()=>_(this,void 0,void 0,function*(){return this.headers})},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(i,o){const a=i[o];return typeof a!="function"?a:(...l)=>_(this,void 0,void 0,function*(){try{return{data:yield a.apply(i,l),error:null}}catch(c){if(n)throw c;return{data:null,error:c}}})}})}}const Jn={"X-Client-Info":`storage-js/${Uo}`,"Content-Type":"application/json"};class Yn extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function ue(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class gr extends Yn{constructor(e,r,n){super(e),this.name="StorageVectorsApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class qo extends Yn{constructor(e,r){super(e),this.name="StorageVectorsUnknownError",this.originalError=r}}var Tn;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(Tn||(Tn={}));const Lr=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),mu=()=>Response,Fo=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},yu=t=>Array.from(new Float32Array(t)),bu=(t,e)=>{if(e!==void 0&&t.float32.length!==e)throw new Error(`Vector dimension mismatch: expected ${e}, got ${t.float32.length}`)},Gs=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),vu=(t,e,r)=>_(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(r!=null&&r.noResolveJson)){const s=t.status||500,i=t;if(typeof i.json=="function")i.json().then(o=>{const a=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||s+"";e(new gr(Gs(o),s,a))}).catch(()=>{const o=s+"",a=i.statusText||`HTTP ${s} error`;e(new gr(a,s,o))});else{const o=s+"",a=i.statusText||`HTTP ${s} error`;e(new gr(a,s,o))}}else e(new qo(Gs(t),t))}),wu=(t,e,r,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return n?(Fo(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,Object.assign(Object.assign({},s),r)):s};function _u(t,e,r,n,s,i){return _(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(r,wu(e,n,s,i)).then(l=>{if(!l.ok)throw l;if(n!=null&&n.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>vu(l,a,n))})})}function he(t,e,r,n,s){return _(this,void 0,void 0,function*(){return _u(t,"POST",e,n,s,r)})}class Ho{constructor(e,r={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Jn),r),this.fetch=Lr(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return _(this,void 0,void 0,function*(){try{return{data:(yield he(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}getIndex(e,r){return _(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:r},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ue(n))return{data:null,error:n};throw n}})}listIndexes(e){return _(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}deleteIndex(e,r){return _(this,void 0,void 0,function*(){try{return{data:(yield he(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:r},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ue(n))return{data:null,error:n};throw n}})}}class Wo{constructor(e,r={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Jn),r),this.fetch=Lr(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return _(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield he(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}getVectors(e){return _(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}listVectors(e){return _(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield he(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}queryVectors(e){return _(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}deleteVectors(e){return _(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield he(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}}class zo{constructor(e,r={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Jn),r),this.fetch=Lr(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return _(this,void 0,void 0,function*(){try{return{data:(yield he(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}getBucket(e){return _(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}listBuckets(){return _(this,arguments,void 0,function*(e={}){try{return{data:yield he(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}deleteBucket(e){return _(this,void 0,void 0,function*(){try{return{data:(yield he(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ue(r))return{data:null,error:r};throw r}})}}class Vo extends zo{constructor(e,r={}){super(e,r.headers||{},r.fetch)}from(e){return new Ko(this.url,this.headers,e,this.fetch)}createBucket(e){const r=Object.create(null,{createBucket:{get:()=>super.createBucket}});return _(this,void 0,void 0,function*(){return r.createBucket.call(this,e)})}getBucket(e){const r=Object.create(null,{getBucket:{get:()=>super.getBucket}});return _(this,void 0,void 0,function*(){return r.getBucket.call(this,e)})}listBuckets(){const e=Object.create(null,{listBuckets:{get:()=>super.listBuckets}});return _(this,arguments,void 0,function*(r={}){return e.listBuckets.call(this,r)})}deleteBucket(e){const r=Object.create(null,{deleteBucket:{get:()=>super.deleteBucket}});return _(this,void 0,void 0,function*(){return r.deleteBucket.call(this,e)})}}class Ko extends Ho{constructor(e,r,n,s){super(e,r,s),this.vectorBucketName=n}createIndex(e){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return _(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return _(this,arguments,void 0,function*(r={}){return e.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return _(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return _(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Go(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Go extends Wo{constructor(e,r,n,s,i){super(e,r,i),this.vectorBucketName=n,this.indexName=s}putVectors(e){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return _(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return _(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return _(this,arguments,void 0,function*(r={}){return e.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return _(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return _(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class xu extends cu{constructor(e,r={},n,s){super(e,r,n,s)}from(e){return new lu(this.url,this.headers,e,this.fetch)}get vectors(){return new Vo(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Mo(this.url+"/iceberg",this.headers,this.fetch)}}const Su=Object.freeze(Object.defineProperty({__proto__:null,StorageAnalyticsClient:Mo,StorageApiError:No,StorageClient:xu,StorageError:Vt,StorageUnknownError:Tr,StorageVectorsApiError:gr,StorageVectorsClient:Vo,StorageVectorsError:Yn,get StorageVectorsErrorCode(){return Tn},StorageVectorsUnknownError:qo,VectorBucketApi:zo,VectorBucketScope:Ko,VectorDataApi:Wo,VectorIndexApi:Ho,VectorIndexScope:Go,isPlainObject:Fo,isStorageError:F,isStorageVectorsError:ue,normalizeToFloat32:yu,resolveFetch:Lr,resolveResponse:mu,validateVectorDimension:bu},Symbol.toStringTag,{value:"Module"})),Eu=zt(Su);var Qr={},wt={},Js;function ku(){return Js||(Js=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.version=void 0,wt.version="2.87.1"),wt}var Ys;function Tu(){return Ys||(Ys=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_REALTIME_OPTIONS=t.DEFAULT_AUTH_OPTIONS=t.DEFAULT_DB_OPTIONS=t.DEFAULT_GLOBAL_OPTIONS=t.DEFAULT_HEADERS=void 0;const e=ku();let r="";typeof Deno<"u"?r="deno":typeof document<"u"?r="web":typeof navigator<"u"&&navigator.product==="ReactNative"?r="react-native":r="node",t.DEFAULT_HEADERS={"X-Client-Info":`supabase-js-${r}/${e.version}`},t.DEFAULT_GLOBAL_OPTIONS={headers:t.DEFAULT_HEADERS},t.DEFAULT_DB_OPTIONS={schema:"public"},t.DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},t.DEFAULT_REALTIME_OPTIONS={}})(Qr)),Qr}var Zr={},Xs;function Au(){return Xs||(Xs=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.fetchWithAuth=t.resolveHeadersConstructor=t.resolveFetch=void 0;const e=s=>s?(...i)=>s(...i):(...i)=>fetch(...i);t.resolveFetch=e;const r=()=>Headers;t.resolveHeadersConstructor=r;const n=(s,i,o)=>{const a=(0,t.resolveFetch)(o),l=(0,t.resolveHeadersConstructor)();return async(c,u)=>{var d;const f=(d=await i())!==null&&d!==void 0?d:s;let h=new l(u==null?void 0:u.headers);return h.has("apikey")||h.set("apikey",s),h.has("Authorization")||h.set("Authorization",`Bearer ${f}`),a(c,Object.assign(Object.assign({},u),{headers:h}))}};t.fetchWithAuth=n})(Zr)),Zr}var Te={},Qs;function Pu(){if(Qs)return Te;Qs=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.isBrowser=void 0,Te.uuid=t,Te.ensureTrailingSlash=e,Te.applySettingDefaults=n,Te.validateSupabaseUrl=s;function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var o=Math.random()*16|0,a=i=="x"?o:o&3|8;return a.toString(16)})}function e(i){return i.endsWith("/")?i:i+"/"}const r=()=>typeof window<"u";Te.isBrowser=r;function n(i,o){var a,l;const{db:c,auth:u,realtime:d,global:f}=i,{db:h,auth:g,realtime:m,global:p}=o,y={db:Object.assign(Object.assign({},h),c),auth:Object.assign(Object.assign({},g),u),realtime:Object.assign(Object.assign({},m),d),storage:{},global:Object.assign(Object.assign(Object.assign({},p),f),{headers:Object.assign(Object.assign({},(a=p==null?void 0:p.headers)!==null&&a!==void 0?a:{}),(l=f==null?void 0:f.headers)!==null&&l!==void 0?l:{})}),accessToken:async()=>""};return i.accessToken?y.accessToken=i.accessToken:delete y.accessToken,y}function s(i){const o=i==null?void 0:i.trim();if(!o)throw new Error("supabaseUrl is required.");if(!o.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(e(o))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}return Te}var _t={};const Jo="2.87.1",st=30*1e3,An=3,en=An*st,Ou="http://localhost:9999",Ru="supabase.auth.token",Cu={"X-Client-Info":`gotrue-js/${Jo}`},Pn="X-Supabase-Api-Version",Yo={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Iu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,$u=600*1e3;let dt=class extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}};function S(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}let Xo=class extends dt{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}};function Qo(t){return S(t)&&t.name==="AuthApiError"}let je=class extends dt{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}},$e=class extends dt{constructor(e,r,n,s){super(e,n,s),this.name=r,this.status=n}},le=class extends $e{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function Zo(t){return S(t)&&t.name==="AuthSessionMissingError"}let Fe=class extends $e{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Et=class extends $e{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}},kt=class extends $e{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function ea(t){return S(t)&&t.name==="AuthImplicitGrantRedirectError"}let On=class extends $e{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Ar=class extends $e{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}};function mr(t){return S(t)&&t.name==="AuthRetryableFetchError"}let Rn=class extends $e{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}};function ju(t){return S(t)&&t.name==="AuthWeakPasswordError"}let Pr=class extends $e{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}};const Or="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Zs=` 	
\r=`.split(""),Lu=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Zs.length;e+=1)t[Zs[e].charCodeAt(0)]=-2;for(let e=0;e<Or.length;e+=1)t[Or[e].charCodeAt(0)]=e;return t})();function ei(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Or[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Or[n]),e.queuedBits-=6}}function ta(t,e,r){const n=Lu[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function ti(t){const e=[],r=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Uu(o,n,r)};for(let o=0;o<t.length;o+=1)ta(t.charCodeAt(o),s,i);return e.join("")}function Nu(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Bu(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}Nu(n,e)}}function Uu(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if((t>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function at(t){const e=[],r={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)ta(t.charCodeAt(s),r,n);return new Uint8Array(e)}function Du(t){const e=[];return Bu(t,r=>e.push(r)),new Uint8Array(e)}function Ye(t){const e=[],r={queue:0,queuedBits:0},n=s=>{e.push(s)};return t.forEach(s=>ei(s,r,n)),ei(null,r,n),e.join("")}function Mu(t){return Math.round(Date.now()/1e3)+t}function qu(){return Symbol("auth-callback")}const ee=()=>typeof window<"u"&&typeof document<"u",Me={tested:!1,writable:!1},ra=()=>{if(!ee())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Me.tested)return Me.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Me.tested=!0,Me.writable=!0}catch{Me.tested=!0,Me.writable=!1}return Me.writable};function Fu(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return r.searchParams.forEach((n,s)=>{e[s]=n}),e}const na=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Hu=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",it=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},qe=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Z=async(t,e)=>{await t.removeItem(e)};class Nr{constructor(){this.promise=new Nr.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}Nr.promiseConstructor=Promise;function tn(t){const e=t.split(".");if(e.length!==3)throw new Pr("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Iu.test(e[n]))throw new Pr("JWT not in base64url format");return{header:JSON.parse(ti(e[0])),payload:JSON.parse(ti(e[1])),signature:at(e[2]),raw:{header:e[0],payload:e[1]}}}async function Wu(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function zu(t,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){n(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function Vu(t){return("0"+t.toString(16)).substr(-2)}function Ku(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let i=0;i<56;i++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Vu).join("")}async function Gu(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function Ju(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await Gu(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function tt(t,e,r=!1){const n=Ku();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await it(t,`${e}-code-verifier`,s);const i=await Ju(n);return[i,n===i?"plain":"s256"]}const Yu=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Xu(t){const e=t.headers.get(Pn);if(!e||!e.match(Yu))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Qu(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Zu(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ed=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function rt(t){if(!ed.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function rn(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function td(t,e){return new Proxy(t,{get:(r,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,s)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,n,s)}})}function ri(t){return JSON.parse(JSON.stringify(t))}const He=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),rd=[502,503,504];async function ni(t){var e;if(!Hu(t))throw new Ar(He(t),0);if(rd.includes(t.status))throw new Ar(He(t),t.status);let r;try{r=await t.json()}catch(i){throw new je(He(i),i)}let n;const s=Xu(t);if(s&&s.getTime()>=Yo["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Rn(He(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new le}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Rn(He(r),t.status,r.weak_password.reasons);throw new Xo(He(r),t.status||500,n)}const nd=(t,e,r,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function O(t,e,r,n){var s;const i=Object.assign({},n==null?void 0:n.headers);i[Pn]||(i[Pn]=Yo["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const o=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await sd(t,e,r+a,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function sd(t,e,r,n,s,i){const o=nd(e,n,s,i);let a;try{a=await t(r,Object.assign({},o))}catch(l){throw console.error(l),new Ar(He(l),0)}if(a.ok||await ni(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(l){await ni(l)}}function ge(t){var e;let r=null;ad(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=Mu(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function si(t){const e=ge(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Le(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function id(t){return{data:t,error:null}}function od(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i}=t,o=pt(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function ii(t){return t}function ad(t){return t.access_token&&t.refresh_token&&t.expires_in}const yr=["global","local","others"];let Xn=class{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=na(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=yr[0]){if(yr.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${yr.join(", ")}`);try{return await O(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(S(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await O(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Le})}catch(n){if(S(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=pt(e,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await O(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:od,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(S(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await O(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Le})}catch(r){if(S(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await O(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:ii});if(u.error)throw u.error;const d=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,h=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(g=>{const m=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(g.split(";")[1].split("=")[1]);c[`${p}Page`]=m}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(S(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){rt(e);try{return await O(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Le})}catch(r){if(S(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){rt(e);try{return await O(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Le})}catch(n){if(S(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){rt(e);try{return await O(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Le})}catch(n){if(S(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){rt(e.userId);try{const{data:r,error:n}=await O(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(S(r))return{data:null,error:r};throw r}}async _deleteFactor(e){rt(e.userId),rt(e.id);try{return{data:await O(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(S(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await O(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:ii});if(u.error)throw u.error;const d=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,h=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(g=>{const m=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(g.split(";")[1].split("=")[1]);c[`${p}Page`]=m}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(S(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await O(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(S(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await O(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(S(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await O(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(S(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await O(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(S(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await O(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(S(r))return{data:null,error:r};throw r}}};function oi(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const We={debug:!!(globalThis&&ra()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Qn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}let sa=class extends Qn{};class ld extends Qn{}async function ia(t,e,r){We.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),We.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){We.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await r()}finally{We.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw We.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new sa(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(We.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}const ai={};async function cd(t,e,r){var n;const s=(n=ai[t])!==null&&n!==void 0?n:Promise.resolve(),i=Promise.race([s.catch(()=>null),e>=0?new Promise((o,a)=>{setTimeout(()=>{a(new ld(`Acquring process lock with name "${t}" timed out`))},e)}):null].filter(o=>o)).catch(o=>{if(o&&o.isAcquireTimeout)throw o;return null}).then(async()=>await r());return ai[t]=i.catch(async o=>{if(o&&o.isAcquireTimeout)return await s,null;throw o}),await i}function ud(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function oa(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function dd(t){return parseInt(t,16)}function hd(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function fd(t){var e;const{chainId:r,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:d,version:f}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const h=oa(t.address),g=u?`${u}://${n}`:n,m=t.statement?`${t.statement}
`:"",p=`${g} wants you to sign in with your Ethereum account:
${h}

${m}`;let y=`URI: ${d}
Version: ${f}
Chain ID: ${r}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(y+=`
Expiration Time: ${s.toISOString()}`),a&&(y+=`
Not Before: ${a.toISOString()}`),l&&(y+=`
Request ID: ${l}`),c){let v=`
Resources:`;for(const w of c){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);v+=`
- ${w}`}y+=v}return`${p}
${y}`}class V extends Error{constructor({message:e,code:r,cause:n,name:s}){var i;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=s??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=r}}class Rr extends V{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function pd({error:t,options:e}){var r,n,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new V({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new V({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new V({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new V({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new V({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new V({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new V({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new V({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(aa(o)){if(i.rp.id!==o)return new V({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new V({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new V({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new V({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new V({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function gd({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new V({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new V({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const n=window.location.hostname;if(aa(n)){if(r.rpId!==n)return new V({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new V({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new V({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new V({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class md{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const yd=new md;function bd(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:n}=t,s=pt(t,["challenge","user","excludeCredentials"]),i=at(e).buffer,o=Object.assign(Object.assign({},r),{id:at(r.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const c=n[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:at(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function vd(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,n=pt(t,["challenge","allowCredentials"]),s=at(e).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let o=0;o<r.length;o++){const a=r[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:at(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function wd(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:Ye(new Uint8Array(t.response.attestationObject)),clientDataJSON:Ye(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function _d(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,n=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Ye(new Uint8Array(s.authenticatorData)),clientDataJSON:Ye(new Uint8Array(s.clientDataJSON)),signature:Ye(new Uint8Array(s.signature)),userHandle:s.userHandle?Ye(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function aa(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function li(){var t,e;return!!(ee()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function xd(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Rr("Browser returned unexpected credential type",e)}:{data:null,error:new Rr("Empty credential response",e)}}catch(e){return{data:null,error:pd({error:e,options:t})}}}async function Sd(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Rr("Browser returned unexpected credential type",e)}:{data:null,error:new Rr("Empty credential response",e)}}catch(e){return{data:null,error:gd({error:e,options:t})}}}const Ed={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},kd={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Cr(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of t)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))n[i]=o;else if(r(o))n[i]=o;else if(e(o)){const a=n[i];e(a)?n[i]=Cr(a,o):n[i]=Cr(o)}else n[i]=o}return n}function Td(t,e){return Cr(Ed,t,e||{})}function Ad(t,e){return Cr(kd,t,e||{})}class Pd{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:n,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!o)return{data:null,error:a};const l=s??yd.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${n}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=Td(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:d}=await xd({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}case"request":{const c=Ad(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:d}=await Sd(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}}}catch(o){return S(o)?{data:null,error:o}:{data:null,error:new je("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!r)return{data:null,error:new dt("rpId is required for WebAuthn authentication")};try{if(!li())return{data:null,error:new je("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:r,rpOrigins:n,credential_response:l.credential_response}})}catch(o){return S(o)?{data:null,error:o}:{data:null,error:new je("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!r)return{data:null,error:new dt("rpId is required for WebAuthn registration")};try{if(!li())return{data:null,error:new je("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var d;return(d=u.data)===null||d===void 0?void 0:d.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:r,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return S(o)?{data:null,error:o}:{data:null,error:new je("Unexpected error in register",o)}}}}ud();const Od={url:Ou,storageKey:Ru,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Cu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function ci(t,e,r){return await r()}const nt={};let Zn=class Cn{get jwks(){var e,r;return(r=(e=nt[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){nt[this.storageKey]=Object.assign(Object.assign({},nt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=nt[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){nt[this.storageKey]=Object.assign(Object.assign({},nt[this.storageKey]),{cachedAt:e})}constructor(e){var r,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},Od),e);if(this.storageKey=i.storageKey,this.instanceID=(r=Cn.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Cn.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&ee()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Xn({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=na(i.fetch),this.lock=i.lock||ci,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&ee()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=ia:this.lock=ci,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Pd(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:ra()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=oi(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=oi(this.memoryStorage)),ee()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Jo}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},n="none";if(ee()&&(r=Fu(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),ee()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(r,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),ea(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return S(r)?this._returnResult({error:r}):this._returnResult({error:new je("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,s;try{const i=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:ge}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(S(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var r,n,s;try{let i;if("email"in e){const{email:u,password:d,options:f}=e;let h=null,g=null;this.flowType==="pkce"&&([h,g]=await tt(this.storage,this.storageKey)),i=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:d,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:h,code_challenge_method:g},xform:ge})}else if("phone"in e){const{phone:u,password:d,options:f}=e;i=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=f==null?void 0:f.data)!==null&&n!==void 0?n:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:ge})}else throw new Et("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Z(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(await Z(this.storage,`${this.storageKey}-code-verifier`),S(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let r;if("email"in e){const{email:i,password:o,options:a}=e;r=await O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:si})}else if("phone"in e){const{phone:i,password:o,options:a}=e;r=await O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:si})}else throw new Et("You must provide either an email or phone number and a password");const{data:n,error:s}=r;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const i=new Fe;return this._returnResult({data:{user:null,session:null},error:i})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,n,s,i,o,a,l,c,u,d,f;let h,g;if("message"in e)h=e.message,g=e.signature;else{const{chain:m,wallet:p,statement:y,options:v}=e;let w;if(ee())if(typeof p=="object")w=p;else{const E=window;if("ethereum"in E&&typeof E.ethereum=="object"&&"request"in E.ethereum&&typeof E.ethereum.request=="function")w=E.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof p!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=p}const x=new URL((r=v==null?void 0:v.url)!==null&&r!==void 0?r:window.location.href),$=await w.request({method:"eth_requestAccounts"}).then(E=>E).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!$||$.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const I=oa($[0]);let b=(n=v==null?void 0:v.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!b){const E=await w.request({method:"eth_chainId"});b=dd(E)}const k={domain:x.host,address:I,statement:y,uri:x.href,version:"1",chainId:b,nonce:(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=v==null?void 0:v.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.resources};h=fd(k),g=await w.request({method:"personal_sign",params:[hd(h),I]})}try{const{data:m,error:p}=await O(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:g},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:ge});if(p)throw p;if(!m||!m.session||!m.user){const y=new Fe;return this._returnResult({data:{user:null,session:null},error:y})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:p})}catch(m){if(S(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async signInWithSolana(e){var r,n,s,i,o,a,l,c,u,d,f,h;let g,m;if("message"in e)g=e.message,m=e.signature;else{const{chain:p,wallet:y,statement:v,options:w}=e;let x;if(ee())if(typeof y=="object")x=y;else{const I=window;if("solana"in I&&typeof I.solana=="object"&&("signIn"in I.solana&&typeof I.solana.signIn=="function"||"signMessage"in I.solana&&typeof I.solana.signMessage=="function"))x=I.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=y}const $=new URL((r=w==null?void 0:w.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in x&&x.signIn){const I=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),v?{statement:v}:null));let b;if(Array.isArray(I)&&I[0]&&typeof I[0]=="object")b=I[0];else if(I&&typeof I=="object"&&"signedMessage"in I&&"signature"in I)b=I;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in b&&"signature"in b&&(typeof b.signedMessage=="string"||b.signedMessage instanceof Uint8Array)&&b.signature instanceof Uint8Array)g=typeof b.signedMessage=="string"?b.signedMessage:new TextDecoder().decode(b.signedMessage),m=b.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${$.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(s=(n=w==null?void 0:w.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((d=(u=w==null?void 0:w.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...w.signInWithSolana.resources.map(b=>`- ${b}`)]:[]].join(`
`);const I=await x.signMessage(new TextEncoder().encode(g),"utf8");if(!I||!(I instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=I}}try{const{data:p,error:y}=await O(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Ye(m)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:ge});if(y)throw y;if(!p||!p.session||!p.user){const v=new Fe;return this._returnResult({data:{user:null,session:null},error:v})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:y})}catch(p){if(S(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async _exchangeCodeForSession(e){const r=await qe(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:i,error:o}=await O(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:ge});if(await Z(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new Fe;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(await Z(this.storage,`${this.storageKey}-code-verifier`),S(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:r,provider:n,token:s,access_token:i,nonce:o}=e,a=await O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:ge}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new Fe;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,n,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await tt(this.storage,this.storageKey));const{error:d}=await O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u})}throw new Et("You must provide either an email or phone number.")}catch(a){if(await Z(this.storage,`${this.storageKey}-code-verifier`),S(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var r,n;try{let s,i;"options"in e&&(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await O(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:ge});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(S(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var r,n,s,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await tt(this.storage,this.storageKey));const c=await O(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:id});return!((i=c.data)===null||i===void 0)&&i.url&&ee()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await Z(this.storage,`${this.storageKey}-code-verifier`),S(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new le;const{error:s}=await O(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(S(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:o}=await O(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:o,error:a}=await O(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Et("You must provide either an email or phone number and a type")}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await qe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<en:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await qe(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=rn()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=td(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(-1,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Le}):await this._useSession(async r=>{var n,s,i;const{data:o,error:a}=r;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new le}:await O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Le})})}catch(r){if(S(r))return Zo(r)&&(await this._removeSession(),await Z(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new le;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await tt(this.storage,this.storageKey));const{data:c,error:u}=await O(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Le});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(await Z(this.storage,`${this.storageKey}-code-verifier`),S(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new le;const r=Date.now()/1e3;let n=r,s=!0,i=null;const{payload:o}=tn(e.access_token);if(o.exp&&(n=o.exp,s=n<=r),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(r){if(S(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:o,error:a}=r;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new le;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!ee())throw new kt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new kt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new On("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new kt("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new On("No code detected.");const{data:v,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new kt("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let f=u+d;l&&(f=parseInt(l));const h=f-u;h*1e3<=st&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const g=f-d;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:m,error:p}=await this._getUser(i);if(p)throw p;const y={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:f,refresh_token:o,token_type:c,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:y,redirectType:e.type},error:null})}catch(n){if(S(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await qe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({error:i});const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Qo(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Z(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=qu(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,s;try{const{data:{session:i},error:o}=r;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await tt(this.storage,this.storageKey,!0));try{return await O(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(i){if(await Z(this.storage,`${this.storageKey}-code-verifier`),S(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:n,error:s}=await this._useSession(async i=>{var o,a,l,c,u;const{data:d,error:f}=i;if(f)throw f;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await O(this.fetch,"GET",h,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return ee()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:e.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(S(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:i}}=r;if(s)throw s;const{options:o,provider:a,token:l,access_token:c,nonce:u}=e,d=await O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i==null?void 0:i.access_token)!==null&&n!==void 0?n:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ge}),{data:f,error:h}=d;return h?this._returnResult({data:{user:null,session:null},error:h}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new Fe}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:h}))}catch(s){if(await Z(this.storage,`${this.storageKey}-code-verifier`),S(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,s;const{data:i,error:o}=r;if(o)throw o;return await O(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await zu(async s=>(s>0&&await Wu(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await O(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ge})),(s,i)=>{const o=200*Math.pow(2,s);return i&&mr(i)&&Date.now()+o-n<st})}catch(n){if(this._debug(r,"error",n),S(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),ee()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await qe(this.storage,this.storageKey);if(s&&this.userStorage){let o=await qe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await it(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:rn()}else if(s&&!s.user&&!s.user){const o=await qe(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await Z(this.storage,this.storageKey+"-user"),await it(this.storage,this.storageKey,s)):s.user=rn()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<en;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${en}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),mr(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new le;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Nr;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new le;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),S(i)){const o={data:null,error:i};return mr(i)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,r,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Z(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await it(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const i=ri(s);await it(this.storage,this.storageKey,i)}else{const s=ri(r);await it(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Z(this.storage,this.storageKey),await Z(this.storage,this.storageKey+"-code-verifier"),await Z(this.storage,this.storageKey+"-user"),this.userStorage&&await Z(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ee()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),st);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/st);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${st}ms, refresh threshold is ${An} ticks`),s<=An&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Qn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ee()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,o]=await tt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;return i?this._returnResult({data:null,error:i}):await O(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,s;const{data:i,error:o}=r;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await O(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?wd(e.webauthn.credential_response):_d(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await O(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=await O(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:bd(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:vd(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=r==null?void 0:r.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,r;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=tn(n.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((r=(e=n.user.factors)===null||e===void 0?void 0:e.filter(u=>u.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(a="aal2");const c=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await O(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new le})})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new le});const o=await O(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ee()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,r){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new le});const o=await O(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ee()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;return n?this._returnResult({data:null,error:n}):r?await O(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new le})})}catch(e){if(S(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?(await O(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new le})})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(a=>a.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+$u>s)return n;const{data:i,error:o}=await O(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:h,error:g}=await this.getSession();if(g||!h.session)return this._returnResult({data:null,error:g});n=h.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=tn(n);r!=null&&r.allowExpired||Qu(i.exp);const c=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!c){const{error:h}=await this.getUser(n);if(h)throw h;return{data:{claims:i,header:s,signature:o},error:null}}const u=Zu(s.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,Du(`${a}.${l}`)))throw new Pr("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}};Zn.nextInstanceID={};const Rd=Xn,Cd=Zn,Id=Object.freeze(Object.defineProperty({__proto__:null,AuthAdminApi:Rd,AuthApiError:Xo,AuthClient:Cd,AuthError:dt,AuthImplicitGrantRedirectError:kt,AuthInvalidCredentialsError:Et,AuthInvalidJwtError:Pr,AuthInvalidTokenResponseError:Fe,AuthPKCEGrantCodeExchangeError:On,AuthRetryableFetchError:Ar,AuthSessionMissingError:le,AuthUnknownError:je,AuthWeakPasswordError:Rn,CustomAuthError:$e,GoTrueAdminApi:Xn,GoTrueClient:Zn,NavigatorLockAcquireTimeoutError:sa,SIGN_OUT_SCOPES:yr,isAuthApiError:Qo,isAuthError:S,isAuthImplicitGrantRedirectError:ea,isAuthRetryableFetchError:mr,isAuthSessionMissingError:Zo,isAuthWeakPasswordError:ju,lockInternals:We,navigatorLock:ia,processLock:cd},Symbol.toStringTag,{value:"Module"})),la=zt(Id);var ui;function $d(){if(ui)return _t;ui=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.SupabaseAuthClient=void 0;const t=la;let e=class extends t.AuthClient{constructor(n){super(n)}};return _t.SupabaseAuthClient=e,_t}var di;function hi(){if(di)return Zt;di=1,Object.defineProperty(Zt,"__esModule",{value:!0});const t=_o,e=Ao(),r=Lo,n=Eu,s=Tu(),i=Au(),o=Pu(),a=$d();class l{constructor(u,d,f){var h,g,m;this.supabaseUrl=u,this.supabaseKey=d;const p=(0,o.validateSupabaseUrl)(u);if(!d)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",p),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",p),this.storageUrl=new URL("storage/v1",p),this.functionsUrl=new URL("functions/v1",p);const y=`sb-${p.hostname.split(".")[0]}-auth-token`,v={db:s.DEFAULT_DB_OPTIONS,realtime:s.DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},s.DEFAULT_AUTH_OPTIONS),{storageKey:y}),global:s.DEFAULT_GLOBAL_OPTIONS},w=(0,o.applySettingDefaults)(f??{},v);this.storageKey=(h=w.auth.storageKey)!==null&&h!==void 0?h:"",this.headers=(g=w.global.headers)!==null&&g!==void 0?g:{},w.accessToken?(this.accessToken=w.accessToken,this.auth=new Proxy({},{get:(x,$)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String($)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((m=w.auth)!==null&&m!==void 0?m:{},this.headers,w.global.fetch),this.fetch=(0,i.fetchWithAuth)(d,this._getAccessToken.bind(this),w.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},w.realtime)),this.accessToken&&this.accessToken().then(x=>this.realtime.setAuth(x)).catch(x=>console.warn("Failed to set initial Realtime auth token:",x)),this.rest=new e.PostgrestClient(new URL("rest/v1",p).href,{headers:this.headers,schema:w.db.schema,fetch:this.fetch}),this.storage=new n.StorageClient(this.storageUrl.href,this.headers,this.fetch,f==null?void 0:f.storage),w.accessToken||this._listenForAuthEvents()}get functions(){return new t.FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(u){return this.rest.from(u)}schema(u){return this.rest.schema(u)}rpc(u,d={},f={head:!1,get:!1,count:void 0}){return this.rest.rpc(u,d,f)}channel(u,d={config:{}}){return this.realtime.channel(u,d)}getChannels(){return this.realtime.getChannels()}removeChannel(u){return this.realtime.removeChannel(u)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var u,d;if(this.accessToken)return await this.accessToken();const{data:f}=await this.auth.getSession();return(d=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:u,persistSession:d,detectSessionInUrl:f,storage:h,userStorage:g,storageKey:m,flowType:p,lock:y,debug:v,throwOnError:w},x,$){const I={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new a.SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},I),x),storageKey:m,autoRefreshToken:u,persistSession:d,detectSessionInUrl:f,storage:h,userStorage:g,flowType:p,lock:y,debug:v,throwOnError:w,fetch:$,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(u){return new r.RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},u),{params:Object.assign({apikey:this.supabaseKey},u==null?void 0:u.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((d,f)=>{this._handleTokenChanged(d,"CLIENT",f==null?void 0:f.access_token)})}_handleTokenChanged(u,d,f){(u==="TOKEN_REFRESHED"||u==="SIGNED_IN")&&this.changedAccessToken!==f?(this.changedAccessToken=f,this.realtime.setAuth(f)):u==="SIGNED_OUT"&&(this.realtime.setAuth(),d=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}return Zt.default=l,Zt}var fi;function jd(){return fi||(fi=1,(function(t){var e=ke&&ke.__createBinding||(Object.create?(function(u,d,f,h){h===void 0&&(h=f);var g=Object.getOwnPropertyDescriptor(d,f);(!g||("get"in g?!d.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return d[f]}}),Object.defineProperty(u,h,g)}):(function(u,d,f,h){h===void 0&&(h=f),u[h]=d[f]})),r=ke&&ke.__exportStar||function(u,d){for(var f in u)f!=="default"&&!Object.prototype.hasOwnProperty.call(d,f)&&e(d,u,f)},n=ke&&ke.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(t,"__esModule",{value:!0}),t.createClient=t.SupabaseClient=t.FunctionRegion=t.FunctionsError=t.FunctionsRelayError=t.FunctionsFetchError=t.FunctionsHttpError=t.PostgrestError=void 0;const s=n(hi());r(la,t);var i=Ao();Object.defineProperty(t,"PostgrestError",{enumerable:!0,get:function(){return i.PostgrestError}});var o=_o;Object.defineProperty(t,"FunctionsHttpError",{enumerable:!0,get:function(){return o.FunctionsHttpError}}),Object.defineProperty(t,"FunctionsFetchError",{enumerable:!0,get:function(){return o.FunctionsFetchError}}),Object.defineProperty(t,"FunctionsRelayError",{enumerable:!0,get:function(){return o.FunctionsRelayError}}),Object.defineProperty(t,"FunctionsError",{enumerable:!0,get:function(){return o.FunctionsError}}),Object.defineProperty(t,"FunctionRegion",{enumerable:!0,get:function(){return o.FunctionRegion}}),r(Lo,t);var a=hi();Object.defineProperty(t,"SupabaseClient",{enumerable:!0,get:function(){return n(a).default}});const l=(u,d,f)=>new s.default(u,d,f);t.createClient=l;function c(){if(typeof window<"u"||typeof process>"u")return!1;const u=process.version;if(u==null)return!1;const d=u.match(/^v(\d+)\./);return d?parseInt(d[1],10)<=18:!1}c()&&console.warn("‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217")})(ke)),ke}var ca=jd();const ua=Tc(ca),Ld=Ca({__proto__:null,default:ua},[ca]),{PostgrestError:xh,FunctionsHttpError:Sh,FunctionsFetchError:Eh,FunctionsRelayError:kh,FunctionsError:Th,FunctionRegion:Ah,SupabaseClient:Ph,createClient:Nd,GoTrueAdminApi:Oh,GoTrueClient:Rh,AuthAdminApi:Ch,AuthClient:Ih,navigatorLock:$h,NavigatorLockAcquireTimeoutError:jh,lockInternals:Lh,processLock:Nh,SIGN_OUT_SCOPES:Bh,AuthError:Uh,AuthApiError:Dh,AuthUnknownError:Mh,CustomAuthError:qh,AuthSessionMissingError:Fh,AuthInvalidTokenResponseError:Hh,AuthInvalidCredentialsError:Wh,AuthImplicitGrantRedirectError:zh,AuthPKCEGrantCodeExchangeError:Vh,AuthRetryableFetchError:Kh,AuthWeakPasswordError:Gh,AuthInvalidJwtError:Jh,isAuthError:Yh,isAuthApiError:Xh,isAuthSessionMissingError:Qh,isAuthImplicitGrantRedirectError:Zh,isAuthRetryableFetchError:ef,isAuthWeakPasswordError:tf,RealtimePresence:rf,RealtimeChannel:nf,RealtimeClient:sf,REALTIME_LISTEN_TYPES:of,REALTIME_POSTGRES_CHANGES_LISTEN_EVENT:af,REALTIME_PRESENCE_LISTEN_EVENTS:lf,REALTIME_SUBSCRIBE_STATES:cf,REALTIME_CHANNEL_STATES:uf}=ua||Ld,Bd="https://pvggfemqtlsicreynfxz.supabase.co",Ud="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Z2dmZW1xdGxzaWNyZXluZnh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MzQxNDIsImV4cCI6MjA3MzExMDE0Mn0.hbdpGDGrdADIbZS5W-ByHxEItzeSOXbNS7OvJoVOo-I",In=Nd(Bd,Ud);function Dd(){Md(),qd()}function Md(){if(document.getElementById("lux-auth-btn"))return;const t=document.createElement("button");t.id="lux-auth-btn",t.style.cssText=`
  position: fixed; top: 16px; right: 16px;
  z-index: 900; padding: 8px 16px;
  background: #fff; border: 1px solid #cbd5e1; border-radius: 20px;
  color: #475569; font-size: 0.85rem; font-weight: 700;
  cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  transition: all 0.2s; display: flex; align-items: center; gap: 6px;
`,t.onmouseover=()=>{t.style.transform="translateY(-1px)",t.style.boxShadow="0 4px 8px rgba(0,0,0,0.1)"},t.onmouseout=()=>{t.style.transform="translateY(0)",t.style.boxShadow="0 2px 5px rgba(0,0,0,0.05)"},t.textContent="üíæ Save Progress",t.onclick=da,document.body.appendChild(t)}function da(){if(document.getElementById("lux-auth-modal"))return;const t=document.createElement("div");if(t.id="lux-auth-modal",t.style.cssText=`
    position: fixed; inset: 0; z-index: 1000;
    background: rgba(0,0,0,0.5); backdrop-filter: blur(3px);
    display: flex; align-items: center; justify-content: center;
    animation: fadeIn 0.2s ease-out;
  `,!document.getElementById("auth-anim")){const e=document.createElement("style");e.id="auth-anim",e.textContent="@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }",document.head.appendChild(e)}t.innerHTML=`
    <div style="background:#fff; padding:24px; border-radius:16px; width:90%; max-width:340px; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,0.2); position:relative;">
      <button id="lux-auth-close" style="position:absolute; top:12px; right:12px; border:none; background:none; font-size:1.2rem; cursor:pointer; color:#94a3b8;">&times;</button>
      
      <h3 style="margin:0 0 8px 0; color:#1e293b; font-size:1.4rem;">Save Your Progress</h3>
      <p style="font-size:0.95em; color:#64748b; margin-bottom:24px; line-height:1.5;">
        Sign in to keep your history safe and access it from any device.
      </p>
      
      <input type="email" id="lux-auth-email" placeholder="name@email.com" 
        style="width:100%; padding:12px; border:1px solid #cbd5e1; border-radius:8px; margin-bottom:16px; font-size:1rem; box-sizing:border-box;">
        
      <button id="lux-auth-submit" style="width:100%; padding:12px; background:#0078d7; color:#fff; border:none; border-radius:8px; font-weight:700; font-size:1rem; cursor:pointer; transition:background 0.2s;">
        Send Magic Link ü™Ñ
      </button>
      
      <div style="margin-top:16px; font-size:0.8rem; color:#94a3b8;">
        We'll email you a login link. No password needed.
      </div>
    </div>
  `,document.body.appendChild(t),document.getElementById("lux-auth-close").onclick=()=>t.remove(),document.getElementById("lux-auth-submit").onclick=async()=>{const e=document.getElementById("lux-auth-email").value.trim(),r=document.getElementById("lux-auth-submit");if(!e||!e.includes("@"))return alert("Please enter a valid email address.");r.textContent="Sending...",r.disabled=!0,r.style.opacity="0.7";const{error:n}=await In.auth.signInWithOtp({email:e,options:{emailRedirectTo:window.location.origin}});n?(alert("Login Error: "+n.message),r.textContent="Try Again",r.disabled=!1,r.style.opacity="1"):t.querySelector("div").innerHTML=`
        <div style="padding:20px;">
          <div style="font-size:3rem; margin-bottom:16px;">üìß</div>
          <h3 style="color:#10b981; margin:0 0 12px 0;">Check your email!</h3>
          <p style="color:#475569; margin-bottom:20px; line-height:1.5;">
            We sent a magic link to <strong>${e}</strong>.<br>
            Click it to log in.
          </p>
          <button onclick="document.getElementById('lux-auth-modal').remove()" 
            style="padding:10px 24px; background:#f1f5f9; border:none; border-radius:8px; color:#475569; font-weight:600; cursor:pointer;">
            Close
          </button>
        </div>
      `}}function qd(){In.auth.onAuthStateChange(async(t,e)=>{const r=document.getElementById("lux-auth-btn");if(r)if(e!=null&&e.user){const n=e.user.email,s=n.split("@")[0],i=e.user.id;r.textContent=`üë§ ${s}`,r.style.borderColor="#bbf7d0",r.style.background="#f0fdf4",r.style.color="#166534",r.onclick=()=>{confirm(`Signed in as ${n}.

Do you want to log out?`)&&(In.auth.signOut(),window.location.reload())};const o=localStorage.getItem("LUX_USER_ID");o&&o!==i&&(console.log("[Auth] Migrating guest history...",o,"->",i),await Fd(o,i)),window.LUX_USER_ID=i,localStorage.setItem("LUX_USER_ID",i),window.refreshDashboard?window.refreshDashboard():Hn(()=>Promise.resolve().then(()=>kc),void 0,import.meta.url).then(a=>{a.refreshHistory&&a.refreshHistory()})}else r.textContent="üíæ Save Progress",r.style.borderColor="#cbd5e1",r.style.background="#fff",r.style.color="#475569",r.onclick=da})}async function Fd(t,e){try{const n=await(await fetch(`${ht}/api/migrate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guestUid:t,userUid:e})})).json();console.log("[Auth] Migration result:",n)}catch(r){console.error("[Auth] Migration failed:",r)}}function Hd(t={}){const e=document.querySelector('[data-arrow-trail="tts"]');if(!e||e.dataset.init==="yes")return;e.dataset.init="yes";const r=Number.isFinite(t.count)?t.count:14,n=Number.isFinite(t.durationSec)?t.durationSec:2.8,s=Number.isFinite(t.waveDurationSec)?t.waveDurationSec:1.4,i=Number.isFinite(t.flyMsBase)?t.flyMsBase:1400,o=Number.isFinite(t.flyMsPerPx)?t.flyMsPerPx:1.1,a=Number.isFinite(t.flyMsMin)?t.flyMsMin:1800,l=Number.isFinite(t.flyMsMax)?t.flyMsMax:3600,c=Number.isFinite(t.landHoldMs)?t.landHoldMs:900,u=t.targetSelector||null,d=t.ttsClosedSelector||null,f=t.ttsOpenSelector||null,h=Number.isFinite(t.targetOffsetX)?t.targetOffsetX:0,g=Number.isFinite(t.targetOffsetY)?t.targetOffsetY:0,m=!!t.debug,p=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;e.innerHTML="";for(let R=0;R<r;R++){const T=document.createElement("span");T.className="lux-arrow";const N=document.createElement("span");N.className="lux-arrow-glyph",N.textContent="‚Üí",T.appendChild(N),e.appendChild(T)}const y=Array.from(e.querySelectorAll(".lux-arrow")),v=y.length||1;e.style.setProperty("--luxTrailDur",`${n}s`);const w=n/v;e.style.setProperty("--luxWaveDur",`${s}s`);const x=s/v;y.forEach((R,T)=>{R.style.setProperty("--luxDelay",`${T*w}s`);const N=R.querySelector(".lux-arrow-glyph");N&&N.style.setProperty("--luxWaveDelay",`${T*x}s`);const q=.22+T/Math.max(1,v-1)*.16;R.style.opacity=String(q)});const $=y[y.length-1];$&&$.classList.add("is-last"),e.classList.add("is-animating");let I=null,b=!1,k=!1,E=null,M=!1,C=null,B=null,U=null,L=null;if(e.addEventListener("mouseenter",()=>{if(p||k)return;b=!1,clearTimeout(I);const R=e.querySelector(".lux-arrow.is-last");if(!R)return;const T=(v-1)*x+s*.5;I=window.setTimeout(()=>{e.matches(":hover")&&(b||(b=!0,Ur(R)))},Math.max(0,T*1e3))}),e.addEventListener("mouseleave",()=>{clearTimeout(I),I=null,b=!1,E&&(clearTimeout(E),E=null),pe()}),e.addEventListener("click",R=>{if(p||k||!(R.target&&R.target.closest?R.target.closest(".lux-arrow"):null))return;R.preventDefault(),R.stopPropagation(),clearTimeout(I),I=null,b=!0,E&&(clearTimeout(E),E=null),M=!0;const N=e.querySelector(".lux-arrow.is-last");N&&Ur(N)}),!p){const R=Number.isFinite(t.autoRunMs)?t.autoRunMs:7e3;t.autoRunOnce!==!1&&!M&&(E=window.setTimeout(()=>{if(k)return;const N=e.querySelector(".lux-arrow.is-last");N&&(M=!0,Ur(N))},R))}function pe(){if(k=!1,E&&(clearTimeout(E),E=null),B){try{B.cancel()}catch{}B=null}C&&C.parentNode&&(C.parentNode.removeChild(C),C=null),U&&(U.classList.remove("is-launched"),U=null),L&&L.parentNode&&(L.parentNode.removeChild(L),L=null)}function ve(R){if(!R)return!1;const T=R.getClientRects();if(!T||T.length===0)return!1;const N=window.getComputedStyle(R);return!(N.display==="none"||N.visibility==="hidden"||Number(N.opacity)===0)}function W(R){if(!R)return null;const T=document.querySelector(R);return ve(T)?T:null}function Se(R,T,N){return Math.max(T,Math.min(N,R))}function Ze(R){const T=R&&R.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return T?{r:Number(T[1]),g:Number(T[2]),b:Number(T[3])}:null}function Gt(R,T,N){if(!ve(R))return-1/0;const q=R.getBoundingClientRect();if(q.width<10||q.height<10)return-1/0;const Y=window.getComputedStyle(R);let X=0;Y.position==="fixed"&&(X+=40),Y.position==="sticky"&&(X+=20);const we=Math.abs(window.innerWidth-q.right);X+=Math.max(0,60-we);const de=q.top+q.height/2;X+=Math.max(0,30-Math.abs(de-N)*.08);const re=`${R.id||""} ${R.className&&String(R.className)||""}`.toLowerCase();re.includes("tts")&&(X+=30),(re.includes("tab")||re.includes("peek")||re.includes("handle")||re.includes("drawer"))&&(X+=18);const ne=Y.backgroundColor,ie=Ze(ne);ie&&ie.b>140&&ie.b>ie.r+20&&ie.b>ie.g+20&&(X+=22);const Jt=q.width*q.height;return Jt>1200&&Jt<6e4&&(X+=10),X}function De(R,T){const N=W(u);if(N)return N;const q=W(f);if(q)return q;const Y=W(d);if(Y)return Y;const X=new Set,we=document.querySelector("#tts-controls");we&&we.querySelectorAll("*").forEach(ne=>X.add(ne)),document.querySelectorAll('[id*="tts"], [class*="tts"], [data-tts], [aria-label*="TTS"], [aria-label*="text"], [title*="TTS"], [class*="peek"], [class*="tab"], [class*="handle"]').forEach(ne=>X.add(ne));let de=null,re=-1/0;for(const ne of X){const ie=Gt(ne,R,T);ie>re&&(re=ie,de=ne)}return de}function ga(R){const T=R.getBoundingClientRect();if(R.matches&&R.matches("button.lux-tts-tab")){let re=T.left+1+h,ne=T.top+T.height/2+g;return{x:re,y:ne}}const N=70;let q=T.left+T.width/2,Y=T.top+T.height/2;const X=Math.abs(window.innerWidth-T.right),we=Math.abs(T.left);X<N?(q=T.left+Math.min(8,T.width*.12),Y=T.top+T.height/2):we<N?(q=T.right-Math.min(8,T.width*.12),Y=T.top+T.height/2):(q=T.left+T.width/2,Y=T.top+T.height/2),q+=h,Y+=g;const de=8;return q=Se(q,de,window.innerWidth-de),Y=Se(Y,de,window.innerHeight-de),{x:q,y:Y}}function ma(R,T){m&&(L&&L.parentNode&&L.parentNode.removeChild(L),L=document.createElement("div"),L.style.position="fixed",L.style.left=`${R}px`,L.style.top=`${T}px`,L.style.width="8px",L.style.height="8px",L.style.borderRadius="999px",L.style.transform="translate(-50%, -50%)",L.style.background="rgba(255, 0, 0, 0.55)",L.style.zIndex="9999",L.style.pointerEvents="none",document.body.appendChild(L))}function Ur(R){if(k)return;const N=(R.querySelector(".lux-arrow-glyph")||R).getBoundingClientRect(),q=N.left+N.width/2,Y=N.top+N.height/2,X=De(q,Y);if(!X)return;const{x:we,y:de}=ga(X);ma(we,de),R.classList.add("is-launched"),U=R,C=document.createElement("span"),C.className="lux-arrow-fly",C.textContent="‚Üí",C.style.left=`${q}px`,C.style.top=`${Y}px`,document.body.appendChild(C),k=!0;const re=we-q,ne=de-Y,ie=Math.max(1,Math.hypot(re,ne)),Jt=-ne/ie,ya=re/ie,ba=Se(ie*.14,22,64),va=Math.atan2(ne,re)*180/Math.PI,es=[],ts=16,wa=2.1,mt=(oe,Ee)=>oe+Math.random()*(Ee-oe),rs=wa+mt(-.35,.35),_a=ba*mt(.85,1.15),ns=mt(0,Math.PI*2),xa=mt(6,14),Sa=mt(.85,1.15),Ea=Se((i+ie*o)*Sa,a,l);for(let oe=0;oe<=ts;oe++){const Ee=oe/ts,Dr=1-Ee,ss=Math.sin(Ee*Math.PI*2*rs+ns)*_a*Dr,ka=Math.cos(Ee*Math.PI*2*(rs*.8)+ns*.6)*xa*Dr,Ta=re*Ee+Jt*ss,Aa=ne*Ee+ya*ss+ka,Pa=va*Ee,Oa=1+.06*Dr,Ra=.95-.1*Ee;es.push({transform:`translate(-50%, -50%) translate(${Ta}px, ${Aa}px) rotate(${Pa}deg) scale(${Oa})`,opacity:Ra})}B=C.animate(es,{duration:Ea,easing:"ease-in-out",fill:"forwards"}),B.onfinish=()=>{window.setTimeout(()=>{if(!C)return;const oe=document.createElement("div");oe.className="lux-arrow-pop",oe.style.left=`${we}px`,oe.style.top=`${de}px`,document.body.appendChild(oe),C.animate([{opacity:.85},{opacity:0}],{duration:280,easing:"ease-out",fill:"forwards"}),window.setTimeout(()=>{oe.parentNode&&oe.parentNode.removeChild(oe),pe()},560)},c)}}}let $n;function nn(){const t=document.getElementById("referenceText");if(!t)return;const e=["Paste or type everything you‚Äôll read here...","Try the Rainbow Passage to test all phonemes (sounds)...","Focus on difficult words you struggle with...","Select a passage from the menu above...","Practice your elevator pitch...","Rehearse your upcoming presentation script...","Tricky phrase: ‚Äúthird thorough thought‚Äù","Read an email draft out loud to check the tone...","Prepare for a job interview answer...","Practice your Zoom meeting introduction...","Interview intro: ‚ÄúThanks for having me...‚Äù","Read your favorite poem aloud...","Practice a movie monologue...","Phone message: ‚ÄúHi, this is Mark ‚Äî please call me back‚Äù","Try a difficult tongue twister...","Read a recipe instruction clearly...","Tell a short story...","Practice ordering coffee clearly...","Read a news headline...","Audio note: ‚ÄúSchedule a sales demo for 10am‚Äù","Practice explaining a complex idea simple...","Work on your 'R' and 'L' sounds...","Slow down and enunciate every syllable...","Go over exactly what you'll say when you propose...","Speech closer: ‚ÄúIn short, here‚Äôs why...‚Äù"];let r=0,n=0,s=!1,i="";function o(){if(document.activeElement===t||t.value.length>0)return;const a=e[r];s?(i=a.substring(0,n-1),n--):(i=a.substring(0,n+1),n++),t.setAttribute("placeholder",i);let l=40;s&&(l=20),!s&&n===a.length?(l=2e3,s=!0):s&&n===0&&(s=!1,r=(r+1)%e.length,l=500),$n=setTimeout(o,l)}o()}async function pi(){console.log("[Lux] Booting features..."),cc(),ul(),dl();const t=document.getElementById("passageSelect"),e=document.getElementById("referenceText"),r=document.getElementById("l1Select");r&&r.addEventListener("change",s=>{Zl(s.target.value)}),t&&e&&(t.addEventListener("change",s=>{const i=s.target.value;i==="write-own"?(e.value="",e.focus()):i==="clear"&&(e.value="",t.value="",e.blur(),nn())}),e.addEventListener("focus",()=>{$n&&clearTimeout($n),e.setAttribute("placeholder","Type whatever you like here...")}),e.addEventListener("blur",()=>{e.value.trim()===""&&nn()})),await Mi(),lc();const n=document.getElementById("showSummaryBtn");n&&n.addEventListener("click",()=>{Yl({allPartsResults:xi,currentParts:H})}),nn(),Hd({targetSelector:"aside.lux-tts-panel > button.lux-tts-tab",autoRunMs:7e3,autoRunOnce:!0}),setTimeout(()=>{const s=document.getElementById("lux-top-banner"),i=document.getElementById("userMsg");s&&s.classList.add("is-revealed"),i&&i.classList.add("show"),requestAnimationFrame(()=>{Ke(),setTimeout(Ke,460)})},2500),await Ki(),Dd(),console.log("[Lux] App fully initialized.")}function Ke(){const t=document.getElementById("lux-top-banner");if(!t)return;const e=t.querySelector(".lux-top-banner-panel"),r=t.querySelector(".lux-banner-handle");if(!e||!r)return;const n=t.classList.contains("is-collapsed"),s=t.classList.contains("is-revealed"),i=s||n;r.style.opacity=i?"1":"0",r.style.pointerEvents=i?"auto":"none";let o=16;if(!n&&s){const u=e.getBoundingClientRect();o=Math.max(16,Math.ceil(u.bottom))}if(document.documentElement.style.setProperty("--lux-banner-handle-top",o+"px"),r.textContent=n?"Tips ‚ñæ":"Tips ‚ñ¥",r.setAttribute("aria-label",n?"Show tips":"Hide tips"),r.title=n?"Show tips":"Hide tips",!s&&!n){document.documentElement.style.setProperty("--lux-top-banner-offset","0px");return}const a=e.getBoundingClientRect(),l=r.getBoundingClientRect(),c=n?l.bottom:Math.max(a.bottom,l.bottom);document.documentElement.style.setProperty("--lux-top-banner-offset",Math.ceil(c)+"px")}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("lux-top-banner");if(!t)return;const e=t.querySelector(".lux-top-banner-panel"),r=t.querySelector(".lux-banner-handle");if(!e||!r)return;let n=!1;try{n=localStorage.getItem("bannerCollapsed")==="true"}catch{}t.classList.toggle("is-collapsed",n),n&&t.classList.add("is-revealed");const s=i=>{t.classList.toggle("is-collapsed",!!i);try{localStorage.setItem("bannerCollapsed",i?"true":"false")}catch{}requestAnimationFrame(()=>{Ke(),setTimeout(Ke,460)})};r.addEventListener("click",i=>{i.preventDefault(),s(!t.classList.contains("is-collapsed"))}),e.addEventListener("transitionend",()=>Ke()),window.addEventListener("resize",()=>Ke(),{passive:!0}),Ke()});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",pi):pi();const Wd="lux-tts-guard-style";function zd(){var n;const t=document.getElementById("tts-controls");if(!t)return!1;let e=document.querySelector(".lux-tts-panel");e||(e=document.createElement("aside"),e.className="lux-tts-panel",document.body.appendChild(e));let r=e.querySelector(".lux-tts-tab");if(r||(r=document.createElement("button"),r.className="lux-tts-tab",r.innerHTML=`
      <span class="lux-tts-tab-inner">
        <span class="lux-tts-tab-icon">‚óÄ</span>
        <span class="lux-tts-tab-label">Text-to-Speech</span>
      </span>
    `,r.setAttribute("aria-expanded","false"),r.setAttribute("aria-controls","tts-controls"),e.prepend(r),r.addEventListener("click",()=>{const s=!document.documentElement.classList.contains("lux-tts-open");document.documentElement.classList.toggle("lux-tts-open",s),r.setAttribute("aria-expanded",String(s))})),e.contains(t)||e.appendChild(t),(n=document.getElementById(Wd))==null||n.remove(),t.dataset.luxHidden="0",!t.firstElementChild){const s=document.createElement("div");s.className="lux-tts-loading",s.textContent="Loading Text-to-Speech‚Ä¶",t.appendChild(s)}return window.__ttsHost=t,window.luxTTS=Object.assign(window.luxTTS||{},{nudge(){r&&(r.classList.remove("lux-tts-nudge"),r.offsetWidth,r.classList.add("lux-tts-nudge"),setTimeout(()=>r.classList.remove("lux-tts-nudge"),1400))}}),console.info("[Lux] TTS Peekaboo panel initialized."),!0}async function ha(){if(!zd())return setTimeout(ha,120);try{const t=await Hn(()=>import("./player-ui-C04Xddjs.js"),[],import.meta.url),e=window.__ttsHost||document.getElementById("tts-controls");t!=null&&t.mountTTSPlayer&&(t.mountTTSPlayer(e),console.info("[Lux] TTS Player logic mounted."))}catch(t){console.warn("[Lux] TTS late mount failed:",t)}}function gi(){ha()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",gi):gi();const jn="luxWarpNext";function fa(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}function Br(){if(document.getElementById("lux-warp"))return;const t=document.createElement("div");t.id="lux-warp",document.body.appendChild(t)}function pa(t){const e=document.getElementById("lux-warp");e.classList.remove("is-in","is-out"),e.classList.add("is-on",t),e.style.opacity="",e.style.display="block"}function mi(){const t=document.getElementById("lux-warp");t.classList.remove("is-on","is-in","is-out"),t.style.display="none",t.style.opacity="0"}function Vd(t=220){return Br(),fa()?Promise.resolve():(pa("is-out"),new Promise(e=>setTimeout(e,t)))}function Kd(t=260){return Br(),fa()?(mi(),Promise.resolve()):(pa("is-in"),new Promise(e=>setTimeout(()=>{mi(),e()},t)))}async function Gd(t,{outMs:e=220}={}){sessionStorage.setItem(jn,"1"),await Vd(e),window.location.href=t}function Jd({inMs:t=260}={}){Br();const e=sessionStorage.getItem(jn)==="1";e&&sessionStorage.removeItem(jn),e&&Kd(t)}Br();Jd();document.addEventListener("click",t=>{const e=t.target.closest&&t.target.closest("a[href]");if(!e||t.defaultPrevented||t.button!==0||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||e.target&&e.target!=="_self"||e.hasAttribute("download"))return;let r;try{r=new URL(e.href,window.location.href)}catch{return}r.origin===window.location.origin&&(r.pathname===location.pathname&&r.search===location.search&&r.hash||(t.preventDefault(),Gd(r.href)))},!0);export{Yd as i,Xd as l};
//# sourceMappingURL=index-B4IlvQTO.js.map
