<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lux Teacher Dashboard</title>
  <style>
    :root { --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --blue: #0284c7; }
    body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; }
    
    h1 { margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; }
    .refresh-btn { background: var(--blue); color: white; border: 0; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 700; }
    .refresh-btn:hover { opacity: 0.9; }

    /* Cards */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    .card h3 { margin-top: 0; color: #64748b; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; }
    .big-num { font-size: 2.5rem; font-weight: 800; color: var(--text); }
    .trend { font-size: 0.9rem; font-weight: 600; }
    .trend.up { color: #16a34a; }
    .trend.down { color: #dc2626; }

    /* Table */
    .table-wrap { margin-top: 30px; background: var(--card); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; text-align: left; }
    th, td { padding: 12px 20px; border-bottom: 1px solid #e2e8f0; }
    th { background: #f1f5f9; font-weight: 600; font-size: 0.9rem; color: #475569; }
    tr:last-child td { border-bottom: none; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 99px; font-size: 0.75rem; font-weight: 700; }
    .badge-l1 { background: #e0f2fe; color: #0369a1; }
    .score-good { color: #16a34a; }
    .score-warn { color: #ca8a04; }
    .score-bad { color: #dc2626; }
  </style>
</head>
<body>

  <div class="container">
    <h1>
      <span>ðŸŽ“ Teacher Dashboard</span>
      <button class="refresh-btn" onclick="loadData()">Refresh</button>
    </h1>

    <div class="grid">
      <div class="card">
        <h3>Total Attempts (24h)</h3>
        <div class="big-num" id="stat-count">0</div>
        <div class="trend">Latest: <span id="stat-last-time">â€”</span></div>
      </div>
      <div class="card">
        <h3>Active Students</h3>
        <div class="big-num" id="stat-students">0</div>
        <div class="trend" id="stat-l1s">Languages: â€”</div>
      </div>
      <div class="card">
        <h3>Avg Accuracy</h3>
        <div class="big-num" id="stat-score">0%</div>
        <div class="trend" id="stat-score-color">Global Average</div>
      </div>
    </div>

    <h2 style="margin-top: 40px;">Recent Activity</h2>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>L1</th>
            <th>Passage</th>
            <th>Score</th>
            <th>UID (Student)</th>
          </tr>
        </thead>
        <tbody id="table-body">
          <tr><td colspan="5" style="text-align:center; color:#999;">Loading data...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script type="module">
    // Minimal script to fetch data from your API
    const API_URL = "https://luxury-language-api.vercel.app/api/attempts-list?limit=50"; // We will likely need to create this endpoint or use an existing one

    // MOCK DATA GENERATOR (Until backend endpoint is ready)
    // This proves the UI works immediately.
    function getMockData() {
      return [
        { ts: new Date().toISOString(), l1: "zh", passage: "rainbow", score: 85, uid: "a1b2..." },
        { ts: new Date(Date.now() - 1000*60*5).toISOString(), l1: "es", passage: "grandfather", score: 72, uid: "c3d4..." },
        { ts: new Date(Date.now() - 1000*60*15).toISOString(), l1: "fr", passage: "custom", score: 91, uid: "e5f6..." },
      ];
    }

    window.loadData = async function() {
      const tbody = document.getElementById("table-body");
      
      // 1. Try real fetch (will likely fail 404/403 until backend is updated)
      // For now, we simulate the "Success" state so you see the UI.
      const data = getMockData(); 

      // 2. Render Metrics
      document.getElementById("stat-count").textContent = data.length;
      document.getElementById("stat-students").textContent = new Set(data.map(d => d.uid)).size;
      
      const avg = Math.round(data.reduce((a,b) => a + b.score, 0) / data.length);
      document.getElementById("stat-score").textContent = avg + "%";

      // 3. Render Table
      tbody.innerHTML = data.map(row => {
        const time = new Date(row.ts).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const scoreColor = row.score >= 80 ? 'score-good' : row.score >= 60 ? 'score-warn' : 'score-bad';
        
        return `
          <tr>
            <td style="color:#64748b; font-size:0.9em;">${time}</td>
            <td><span class="badge badge-l1">${row.l1.toUpperCase()}</span></td>
            <td style="font-weight:600; text-transform:capitalize;">${row.passage}</td>
            <td class="${scoreColor}" style="font-weight:800;">${row.score}%</td>
            <td style="font-family:monospace; color:#94a3b8;">${row.uid.slice(0,6)}...</td>
          </tr>
        `;
      }).join("");
    };

    // Boot
    loadData();
  </script>
</body>
</html>